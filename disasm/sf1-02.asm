
; GAME SECTION 02 :
; 
; FREE SPACE : 680 bytes.



; =============== S U B R O U T I N E =======================================

j_BattleLoop:
		jmp     BattleLoop(pc)

    ; End of function j_BattleLoop


; =============== S U B R O U T I N E =======================================

sub_8004:
		jmp     sub_80E2(pc)

    ; End of function sub_8004


; =============== S U B R O U T I N E =======================================

j_nullsub_8DDE:
		
		jmp     nullsub_8DDE(pc)

    ; End of function j_nullsub_8DDE


; =============== S U B R O U T I N E =======================================

sub_800C:
		jmp     sub_9A8A(pc)

    ; End of function sub_800C


; =============== S U B R O U T I N E =======================================

sub_8010:
		jmp     sub_B092(pc)

    ; End of function sub_8010


; =============== S U B R O U T I N E =======================================

sub_8014:
		jmp     sub_CF66(pc)

    ; End of function sub_8014


; =============== S U B R O U T I N E =======================================

sub_8018:
		jmp     sub_CF8C(pc)

    ; End of function sub_8018


; =============== S U B R O U T I N E =======================================

j_CreateWindow:
		
		jmp     CreateWindow(pc)

    ; End of function j_CreateWindow


; =============== S U B R O U T I N E =======================================

j_MoveWindowWithSfx:
		
		jmp     MoveWindowWithSfx(pc)

    ; End of function j_MoveWindowWithSfx


; =============== S U B R O U T I N E =======================================

sub_8024:
		jmp     sub_84AE(pc)

    ; End of function sub_8024


; =============== S U B R O U T I N E =======================================

sub_8028:
		jmp     sub_98A8(pc)

    ; End of function sub_8028


; =============== S U B R O U T I N E =======================================

j_OpenPortraitWindow:
		
		jmp     OpenPortraitWindow(pc)

    ; End of function j_OpenPortraitWindow


; =============== S U B R O U T I N E =======================================

j_ClosePortraitWindow:
		
		jmp     ClosePortraitWindow(pc)

    ; End of function j_ClosePortraitWindow


; =============== S U B R O U T I N E =======================================

sub_8034:
		jmp     sub_E02C(pc)

    ; End of function sub_8034


; =============== S U B R O U T I N E =======================================

sub_8038:
		jmp     sub_BF08(pc)

    ; End of function sub_8038


; =============== S U B R O U T I N E =======================================

sub_803C:
		jmp     sub_E49E(pc)    

    ; End of function sub_803C


; =============== S U B R O U T I N E =======================================

j_CreateMembersListScreen:
		
		jmp     CreateMembersListScreen(pc)

    ; End of function j_CreateMembersListScreen


; =============== S U B R O U T I N E =======================================

sub_8044:
		jmp     sub_EA72(pc)

    ; End of function sub_8044


; =============== S U B R O U T I N E =======================================

sub_8048:
		jmp     sub_BF10(pc)

    ; End of function sub_8048


; =============== S U B R O U T I N E =======================================

j_WriteTilesFromAscii:
		
		jmp     WriteTilesFromAscii(pc)

    ; End of function j_WriteTilesFromAscii


; =============== S U B R O U T I N E =======================================

j_WriteTilesFromNumber:
		
		jmp     WriteTilesFromNumber(pc)

    ; End of function j_WriteTilesFromNumber


; =============== S U B R O U T I N E =======================================

sub_8054:
		jmp     sub_AF66(pc)

    ; End of function sub_8054


; =============== S U B R O U T I N E =======================================

j_BuildMemberStatusWindow:
		
		jmp     BuildMemberStatusWindow(pc)

    ; End of function j_BuildMemberStatusWindow


; =============== S U B R O U T I N E =======================================

j_PlayCursedItemMusic:
		
		jmp     PlayCursedItemMusic(pc)

    ; End of function j_PlayCursedItemMusic


; =============== S U B R O U T I N E =======================================

sub_8060:
		jmp     sub_EC28(pc)

    ; End of function sub_8060


; =============== S U B R O U T I N E =======================================

sub_8064:
		jmp     sub_ECA6(pc)

    ; End of function sub_8064


; =============== S U B R O U T I N E =======================================

sub_8068:
		jmp     sub_ED5C(pc)

    ; End of function sub_8068


; =============== S U B R O U T I N E =======================================

j_PickItemSlot:
		
		jmp     PickItemSlot(pc)

    ; End of function j_PickItemSlot


; =============== S U B R O U T I N E =======================================

j_OpenMiniStatusWindow:
		
		jmp     OpenMiniStatusWindow(pc)

    ; End of function j_OpenMiniStatusWindow


; =============== S U B R O U T I N E =======================================

j_CloseMiniStatusWindow:
		
		jmp     CloseMiniStatusWindow(pc)

    ; End of function j_CloseMiniStatusWindow


; =============== S U B R O U T I N E =======================================

sub_8078:
		jmp     sub_D32C(pc)    

    ; End of function sub_8078


; =============== S U B R O U T I N E =======================================

sub_807C:
		jmp     sub_D75A(pc)

    ; End of function sub_807C


; =============== S U B R O U T I N E =======================================

sub_8080:
		jmp     sub_D774(pc)

    ; End of function sub_8080


; =============== S U B R O U T I N E =======================================

sub_8084:
		jmp     sub_BF14(pc)

    ; End of function sub_8084


; =============== S U B R O U T I N E =======================================

sub_8088:
		jmp     sub_F61E(pc)

    ; End of function sub_8088


; =============== S U B R O U T I N E =======================================

sub_808C:
		jmp     loc_9BFC(pc)

    ; End of function sub_808C


; =============== S U B R O U T I N E =======================================

sub_8090:
		jmp     sub_83E6(pc)

    ; End of function sub_8090


; =============== S U B R O U T I N E =======================================

j_LoadCursorTiles:
		
		jmp     LoadCursorTiles(pc)

    ; End of function j_LoadCursorTiles


; =============== S U B R O U T I N E =======================================

sub_8098:
		jmp     sub_8E52(pc)

    ; End of function sub_8098


; =============== S U B R O U T I N E =======================================

sub_809C:
		jmp     sub_AB5C(pc)

    ; End of function sub_809C


; =============== S U B R O U T I N E =======================================

j_nullsub_8DE0:
		
		jmp     nullsub_8DE0(pc)

    ; End of function j_nullsub_8DE0


; =============== S U B R O U T I N E =======================================

sub_80A4:
		jmp     sub_ADA6(pc)    

    ; End of function sub_80A4


; =============== S U B R O U T I N E =======================================

sub_80A8:
		jmp     sub_ADB8(pc)    

    ; End of function sub_80A8


; =============== S U B R O U T I N E =======================================

sub_80AC:
		jmp     sub_968A(pc)

    ; End of function sub_80AC


; =============== S U B R O U T I N E =======================================

sub_80B0:
		jmp     sub_8D66(pc)

    ; End of function sub_80B0


; =============== S U B R O U T I N E =======================================

sub_80B4:
		jmp     sub_9BD0(pc)

    ; End of function sub_80B4


; =============== S U B R O U T I N E =======================================

j_UpdateBattlefieldSprites:
		
		jmp     UpdateBattlefieldSprites(pc)

    ; End of function j_UpdateBattlefieldSprites


; =============== S U B R O U T I N E =======================================

j_nullsub_80E0:
		
		jmp     nullsub_80E0(pc)

    ; End of function j_nullsub_80E0


; =============== S U B R O U T I N E =======================================

j_MoveWindow:
		jmp     MoveWindow(pc)  

    ; End of function j_MoveWindow


; =============== S U B R O U T I N E =======================================

sub_80C4:
		jmp     sub_96FC(pc)    

    ; End of function sub_80C4


; =============== S U B R O U T I N E =======================================

sub_80C8:
		jmp     sub_9718(pc)    

    ; End of function sub_80C8


; =============== S U B R O U T I N E =======================================

sub_80CC:
		jmp     sub_9734(pc)

    ; End of function sub_80CC


; =============== S U B R O U T I N E =======================================

sub_80D0:
		jmp     sub_E2C2(pc)

    ; End of function sub_80D0


; =============== S U B R O U T I N E =======================================

sub_80D4:
		jmp     sub_E2D6(pc)

    ; End of function sub_80D4


; =============== S U B R O U T I N E =======================================

sub_80D8:
		jmp     sub_DFEC(pc)

    ; End of function sub_80D8


; =============== S U B R O U T I N E =======================================

sub_80DC:
		jmp     sub_AF84(pc)

    ; End of function sub_80DC


; =============== S U B R O U T I N E =======================================

nullsub_80E0:
		rts

    ; End of function nullsub_80E0


; =============== S U B R O U T I N E =======================================

sub_80E2:
		move.l  sp,(dword_FF0EFE).l
		clr.b   ((byte_FFB53A-$1000000)).w
		jsr     j_InitializeBattleData
		jsr     sub_20010
		jsr     sub_20020
		jsr     j_InitializeBattleMap
		bsr.w   sub_84AE
		clr.b   ((AREA_CURSOR_INDEX-$1000000)).w
loc_810C:
		clr.b   ((byte_FFB4D7-$1000000)).w
loc_8110:
		move.b  #$FF,((byte_FFB4D3-$1000000)).w
		bra.w   loc_81D4

    ; End of function sub_80E2


; =============== S U B R O U T I N E =======================================

BattleLoop:
		move.l  sp,(dword_FF0EFE).l
		clr.w   ((SCREEN_POSITION-$1000000)).w
		move.w  #$101,((CURSOR_POSITION_X-$1000000)).w
		clr.b   ((AREA_CURSOR_INDEX-$1000000)).w
		clr.b   ((byte_FFB4D7-$1000000)).w
		clr.b   ((byte_FFB53A-$1000000)).w
		jsr     j_InitializeBattleData
		jsr     sub_20010
		jsr     sub_20004
		jsr     j_InitializeBattleMap
		clr.w   d0
		jsr     j_GetCombatantX
		move.b  d1,((CURSOR_POSITION_X-$1000000)).w
		subq.w  #5,d1
		bge.s   loc_8160
		clr.w   d1
loc_8160:
		move.w  ((MAP_WIDTH-$1000000)).w,d2
		subi.w  #$B,d2
		cmp.w   d2,d1
		ble.s   loc_816E
		move.w  d2,d1
loc_816E:
		move.b  d1,((SCREEN_POSITION-$1000000)).w
		move.w  d1,d2
		jsr     j_GetCombatantY
		move.b  d1,((CURSOR_POSITION_Y-$1000000)).w
		subq.w  #5,d1
		bge.s   loc_8184
		clr.w   d1
loc_8184:
		move.w  ((MAP_HEIGHT-$1000000)).w,d2
		subi.w  #$A,d2
		cmp.w   d2,d1
		ble.s   loc_8192
		move.w  d2,d1
loc_8192:
		move.b  d1,((SCREEN_POSITION+1-$1000000)).w
		clr.b   ((byte_FFB4D7-$1000000)).w
		bsr.w   CheckBattleEnd  
		bsr.w   sub_84AE
		tst.b   ((byte_FFB4D7-$1000000)).w
		beq.s   loc_81AE
		jsr     sub_20040
loc_81AE:
		move.b  #$FF,((byte_FFB4D3-$1000000)).w
		clr.b   ((byte_FFB538-$1000000)).w
		jsr     (j_WaitForVInt).l
		jsr     sub_124008
loc_81C4:
		clr.w   ((SPEECH_SFX-$1000000)).w
		bsr.w   sub_8332
		bsr.w   PopulateTurnOrder
		clr.b   ((CURRENT_BATTLE_TURN-$1000000)).w
loc_81D4:
		lea     ((TURN_ORDER-$1000000)).w,a0
		clr.w   d0
		move.b  ((CURRENT_BATTLE_TURN-$1000000)).w,d0
		add.w   d0,d0
		adda.w  d0,a0
		clr.b   ((AREA_CURSOR_INDEX-$1000000)).w
		clr.w   d0
		move.b  (a0),d0
		move.b  d0,((byte_FFB53B-$1000000)).w
		cmpi.b  #$FF,d0
		beq.w   loc_8284
		jsr     j_GetCurrentHpForCombatant
		tst.w   d1
		beq.w   loc_8284
		jsr     j_GetCombatantX
		lsl.w   #8,d1
		move.w  d1,d6
		jsr     j_GetCombatantY
		or.w    d1,d6
		move.w  d0,-(sp)
		move.w  d6,d0
		bsr.w   LoadCursorTiles
		clr.b   ((byte_FFB538-$1000000)).w
		jsr     (j_WaitForVInt).l
		bsr.w   sub_8E52
		move.w  (sp)+,d0
		move.b  d0,((ACTOR_BLINKING_TOGGLE-$1000000)).w
		bsr.w   sub_AB5C
		move.b  ((byte_FFB53B-$1000000)).w,d0
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_824A
		jsr     j_IsAsleep
		tst.b   ((IS_ASLEEP_FLAG-$1000000)).w
		bne.s   loc_8254
loc_824A:
		bsr.w   sub_83E6
		cmpi.w  #-1,d0
		beq.s   loc_81D4
loc_8254:
		jsr     (j_WaitForVInt).l
		move.b  ((byte_FFB53B-$1000000)).w,d0
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_827C
		jsr     j_HandleAfterTurnStatusEffects
		tst.b   ((IS_POISONED_FLAG-$1000000)).w
		beq.s   loc_827C
		jsr     sub_124004
		jsr     (j_WaitForVInt).l
loc_827C:
		bsr.w   CheckBattleEnd  
		tst.w   d0              ; Check D0 for battle end
														;     0 = not done
														;     1 = win
														;     2 = lose
		bne.s   loc_8296
loc_8284:
		addq.b  #1,((CURRENT_BATTLE_TURN-$1000000)).w
		cmpi.b  #TURN_ORDER_ENTRIES_NUMBER,((CURRENT_BATTLE_TURN-$1000000)).w
		bne.w   loc_81D4
		bra.w   loc_81C4
loc_8296:
		clr.b   (FADING_SETTING).l
		movea.l (dword_FF0EFE).l,sp
		cmpi.w  #1,d0
		beq.w   loc_82DC
		sndCom  MUSIC_MAX_DIED
		bsr.w   sub_AB2C
		jsr     (j_OpenMessageWindow).l
		move.w  #$1B1,d0        ; "[Hero] has been[Line]defeated...[Wait2]"
		trap    #DISPLAY_MESSAGE
		jsr     (j_CloseMessageWindow).l
		bsr.w   LoadCursorTiles
		sndCom  SOUND_COMMAND_FADE_OUT
		jsr     (j_FadeOutToBlack).l
		clr.l   (VINT_CONTEXTUAL_FUNCTION_ADDRESS).l
		moveq   #-1,d0
		rts
loc_82DC:
		clr.w   d0
		move.b  ((CURRENT_MAP_VERSION-$1000000)).w,d0
		addi.w  #$28,d0 
		jsr     (j_SetEventFlag).l
		bsr.w   sub_AB2C
		jsr     j_ExecutePostBattleScript
		jsr     sub_20040
		bsr.w   LoadCursorTiles
		jsr     j_ResetForceMemberStats
		bra.w   loc_81C4

    ; End of function BattleLoop


; =============== S U B R O U T I N E =======================================

sub_830A:
		move.w  d0,-(sp)
		move.w  d0,d7
		lsl.w   #3,d0
		add.w   d7,d0
		add.w   d0,d0
		addi.w  #$100,d0
		lsl.w   #5,d0
		movea.w d0,a1
		move.w  #$120,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jsr     (j_WaitForDmaQueueProcessing).l
		move.w  (sp)+,d0
		rts

    ; End of function sub_830A


; =============== S U B R O U T I N E =======================================

sub_8332:
		jsr     sub_20028
		lea     (FF3000_LOADING_SPACE).l,a0
		move.w  #$8F,d7 
loc_8342:
		clr.l   (a0)+
		dbf     d7,loc_8342

		lea     ((byte_FFA8C2-$1000000)).w,a0
loc_834C:
		move.b  (a0)+,d0
		bmi.w   loc_8362
		move.b  (a0)+,d1
		move.l  a0,-(sp)
		lea     (FF3000_LOADING_SPACE).l,a0
		bsr.s   sub_830A
		movea.l (sp)+,a0
		bra.s   loc_834C
loc_8362:
		lea     ((byte_FFA8C2-$1000000)).w,a0
loc_8366:
		move.b  (a0)+,d0
		bmi.w   return_83E4
		move.b  (a0)+,d1
		ext.w   d0
		move.w  d0,((MESSAGE_ARG_NAME_1-$1000000)).w
		move.l  a0,-(sp)
		move.w  d0,-(sp)
		jsr     j_GetCombatantX
		lsl.w   #8,d1
		move.w  d1,d6
		jsr     j_GetCombatantY
		or.w    d1,d6
		move.w  d6,d0
		bsr.w   LoadCursorTiles
		clr.b   ((byte_FFB538-$1000000)).w
		jsr     (j_WaitForVInt).l
		bsr.w   sub_8E52
		move.w  (sp)+,d0
		jsr     j_GetMapSpriteForCombatant
		movea.l (p_pt_MapSprites).l,a0
		lsl.w   #2,d1
		movea.l (a0,d1.w),a0
		movem.w d0,-(sp)
		jsr     (sub_300).l
		lea     (FF3000_LOADING_SPACE).l,a0
		movem.w (sp)+,d0
		bsr.w   sub_830A
		bsr.w   sub_AB2C
		jsr     (j_OpenMessageWindow).l
		move.w  #$205,d0        ; "[Name] appears![Wait2]"
		trap    #DISPLAY_MESSAGE
		jsr     (j_CloseMessageWindow).l
		movea.l (sp)+,a0
		bra.s   loc_8366
return_83E4:
		rts

    ; End of function sub_8332


; =============== S U B R O U T I N E =======================================

sub_83E6:
		tst.b   ((byte_FFB4D7-$1000000)).w
		beq.s   loc_83F4
		bsr.w   sub_9D08
		bra.w   loc_8488
loc_83F4:
		clr.w   d0
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		jsr     j_GetEntity
		btst    #7,d1
		beq.w   loc_8410
		bsr.w   sub_A6CE
		bra.w   loc_8488
loc_8410:
		move.b  #-1,((byte_FFB53E-$1000000)).w
		clr.b   (CURRENT_PLAYER_INPUT).l
		move.b  #22,(INPUT_REPEAT_DELAYER).l
loc_8424:
		move.b  #1,(byte_FF0F03).l
		bsr.w   sub_8C7C
		tst.b   ((byte_FFB53E-$1000000)).w
		beq.s   loc_8448
		clr.b   ((byte_FFB53E-$1000000)).w
		bsr.w   sub_9D08
		cmpi.w  #$FFFF,d0
		beq.s   loc_8424
		bra.w   loc_8488
loc_8448:
		btst    #INPUT_BIT_C,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_8460
		bsr.w   sub_9D08
		cmpi.w  #$FFFF,d0
		beq.s   loc_8424
		bra.w   loc_8488
loc_8460:
		btst    #INPUT_BIT_A,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_8476
		bsr.w   sub_9D08
		cmpi.w  #$FFFF,d0
		beq.s   loc_8424
		bra.s   loc_8488
loc_8476:
		btst    #INPUT_BIT_B,(CURRENT_PLAYER_INPUT).l
		bne.s   loc_8492
		jsr     (j_WaitForVInt).l
		bra.s   loc_8424
loc_8488:
		clr.b   (byte_FF0F03).l
		clr.w   d0
		rts
loc_8492:
		clr.b   (byte_FF0F03).l
		moveq   #-1,d0
		rts

    ; End of function sub_83E6


; =============== S U B R O U T I N E =======================================

sub_849C:
		move.w  #$FF,d0
		lea     (PASSABILITY_FLAGS).l,a0
loc_84A6:
		clr.l   (a0)+
		dbf     d0,loc_84A6
		rts

    ; End of function sub_849C


; =============== S U B R O U T I N E =======================================

sub_84AE:
		clr.l   (VINT_CONTEXTUAL_FUNCTION_ADDRESS).l
		jsr     (j_DisableDisplayAndInterrupts).l
		jsr     (j_ClearScrollAndSpriteTables).l
		move.w  #$8C00,d0
		jsr     (j_SetVdpReg).l
		move.w  #$9001,d0
		jsr     (j_SetVdpReg).l
		move.w  #$8230,d0
		jsr     (j_SetVdpReg).l
loc_84DE:
		move.w  #$8407,d0
		jsr     (j_SetVdpReg).l
		move.w  #$8B00,d0
		jsr     (j_SetVdpReg).l
		bsr.w   sub_99FC
		bsr.w   sub_97F4
		bsr.w   sub_98A8
		bsr.w   sub_9126
		jsr     (j_EnableDisplayAndInterrupts).l
		moveq   #$FFFFFFFC,d6
		jsr     (j_UpdateBackgroundHScrollData).l
		moveq   #8,d6
		jsr     (j_UpdateBackgroundVScrollData).l
		jsr     (j_WaitForDmaQueueProcessing).l
		bsr.w   UpdateScreenAfterTileChange
		move.l  #sub_9A8A,(VINT_CONTEXTUAL_FUNCTION_ADDRESS).l
		move.b  #$FF,((ACTOR_BLINKING_TOGGLE-$1000000)).w
loc_8532:
		jsr     (j_FadeInFromBlack).l
		clr.w   d1
		clr.w   d2
		rts

    ; End of function sub_84AE


; =============== S U B R O U T I N E =======================================

sub_853E:
		move.b  #FACING_DOWN,((SPRITE_DIRECTION-$1000000)).w
		cmpi.b  #1,((CURSOR_POSITION_Y-$1000000)).w
		beq.w   nullsub_8DDE
		tst.b   ((byte_FFB538-$1000000)).w
		beq.w   loc_8598
		move.l  a0,-(sp)
		lea     (byte_FF4240).l,a0
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.w  d0,d7
		lsl.w   #3,d0
		add.w   d7,d0
		add.w   d0,d0
		addi.w  #$100,d0
		lsl.w   #5,d0
		movea.w d0,a1
		move.w  #$120,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		movea.l (sp)+,a0
		tst.b   ((byte_FFB4D4-$1000000)).w
		bne.s   loc_8598
		move.w  ((MAP_WIDTH-$1000000)).w,d0
		neg.w   d0
		btst    #0,(a0,d0.w)
		beq.w   nullsub_8DDE
loc_8598:
		subq.b  #1,((CURSOR_POSITION_Y-$1000000)).w
		move.b  #4,((CURSOR_YSPEED-$1000000)).w
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d0
		sub.b   ((SCREEN_POSITION+1-$1000000)).w,d0
		cmpi.b  #3,d0
		bne.s   return_85C0
		tst.b   ((SCREEN_POSITION+1-$1000000)).w
		beq.s   return_85C0
		move.b  #4,((CAMERA_YSPEED-$1000000)).w
		clr.b   ((CURSOR_YSPEED-$1000000)).w
return_85C0:
		rts

    ; End of function sub_853E


; =============== S U B R O U T I N E =======================================

sub_85C2:
		move.b  #FACING_UP,((SPRITE_DIRECTION-$1000000)).w
		move.w  ((MAP_HEIGHT-$1000000)).w,d7
		subq.w  #2,d7
		cmp.b   ((CURSOR_POSITION_Y-$1000000)).w,d7
		beq.w   nullsub_8DDE
		tst.b   ((byte_FFB538-$1000000)).w
		beq.w   loc_861E
		move.l  a0,-(sp)
		lea     (byte_FF4000).l,a0
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.w  d0,d7
		lsl.w   #3,d0
		add.w   d7,d0
		add.w   d0,d0
		addi.w  #$100,d0
		lsl.w   #5,d0
		movea.w d0,a1
		move.w  #$120,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		movea.l (sp)+,a0
		tst.b   ((byte_FFB4D4-$1000000)).w
		bne.s   loc_861E
		move.w  ((MAP_WIDTH-$1000000)).w,d0
		btst    #0,(a0,d0.w)
		beq.w   nullsub_8DDE
loc_861E:
		addq.b  #1,((CURSOR_POSITION_Y-$1000000)).w
		move.b  #-4,((CURSOR_YSPEED-$1000000)).w
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d0
		sub.b   ((SCREEN_POSITION+1-$1000000)).w,d0
		cmpi.b  #6,d0
		bne.s   return_864E
		move.w  ((MAP_HEIGHT-$1000000)).w,d7
		subi.b  #$A,d7
		cmp.b   ((SCREEN_POSITION+1-$1000000)).w,d7
		beq.s   return_864E
		move.b  #-4,((CAMERA_YSPEED-$1000000)).w
		clr.b   ((CURSOR_YSPEED-$1000000)).w
return_864E:
		rts

    ; End of function sub_85C2


; =============== S U B R O U T I N E =======================================

sub_8650:
		move.b  #FACING_LEFT,((SPRITE_DIRECTION-$1000000)).w
		move.w  ((MAP_WIDTH-$1000000)).w,d7
		subq.w  #2,d7
		cmp.b   ((CURSOR_POSITION_X-$1000000)).w,d7
		beq.w   nullsub_8DDE
		tst.b   ((byte_FFB538-$1000000)).w
		beq.w   loc_86A8
		move.l  a0,-(sp)
		lea     (byte_FF46C0).l,a0
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.w  d0,d7
		lsl.w   #3,d0
		add.w   d7,d0
		add.w   d0,d0
		addi.w  #$100,d0
		lsl.w   #5,d0
		movea.w d0,a1
		move.w  #$120,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		movea.l (sp)+,a0
		tst.b   ((byte_FFB4D4-$1000000)).w
		bne.s   loc_86A8
		btst    #0,1(a0)
		beq.w   nullsub_8DDE
loc_86A8:
		addq.b  #1,((CURSOR_POSITION_X-$1000000)).w
		move.b  #-4,((CURSOR_XSPEED-$1000000)).w
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d0
		sub.b   ((SCREEN_POSITION-$1000000)).w,d0
		cmpi.b  #7,d0
		bne.s   return_86D8
		move.w  ((MAP_WIDTH-$1000000)).w,d7
		subi.b  #$B,d7
		cmp.b   ((SCREEN_POSITION-$1000000)).w,d7
		beq.s   return_86D8
		move.b  #4,((CAMERA_XSPEED-$1000000)).w
		clr.b   ((CURSOR_XSPEED-$1000000)).w
return_86D8:
		rts

    ; End of function sub_8650


; =============== S U B R O U T I N E =======================================

sub_86DA:
		move.b  #FACING_RIGHT,((SPRITE_DIRECTION-$1000000)).w
		cmpi.b  #1,((CURSOR_POSITION_X-$1000000)).w
		beq.w   nullsub_8DDE
		tst.b   ((byte_FFB538-$1000000)).w
		beq.w   loc_872E
		move.l  a0,-(sp)
		lea     (byte_FF4480).l,a0
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.w  d0,d7
		lsl.w   #3,d0
		add.w   d7,d0
		add.w   d0,d0
		addi.w  #$100,d0
		lsl.w   #5,d0
		movea.w d0,a1
		move.w  #$120,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		movea.l (sp)+,a0
		tst.b   ((byte_FFB4D4-$1000000)).w
		bne.s   loc_872E
		btst    #0,-1(a0)
		beq.w   nullsub_8DDE
loc_872E:
		subq.b  #1,((CURSOR_POSITION_X-$1000000)).w
		move.b  #4,((CURSOR_XSPEED-$1000000)).w
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d0
		sub.b   ((SCREEN_POSITION-$1000000)).w,d0
		cmpi.b  #3,d0
		bne.s   return_8758
		cmpi.b  #0,((SCREEN_POSITION-$1000000)).w
		beq.s   return_8758
		move.b  #-4,((CAMERA_XSPEED-$1000000)).w
		clr.b   ((CURSOR_XSPEED-$1000000)).w
return_8758:
		rts

    ; End of function sub_86DA


; =============== S U B R O U T I N E =======================================

sub_875A:
		movea.l (p_CursorTiles).l,a0
		lea     ($D000).l,a1
		move.w  #$800,d0
		jmp     (j_ApplyImmediateVramDmaOnCompressedTiles).l

    ; End of function sub_875A


; =============== S U B R O U T I N E =======================================

LoadCursorTiles:
		
		clr.b   ((AREA_CURSOR_INDEX-$1000000)).w
		movem.l d0-d2/a0-a1,-(sp)
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_8786
		movea.l (p_CursorTiles).l,a0
		bra.s   loc_878C
loc_8786:
		lea     til_87A2(pc), a0
		nop
loc_878C:
		lea     ($D000).l,a1
		move.w  #$800,d0
loc_8796:
		jsr     (j_ApplyVIntVramDmaOnCompressedTiles).l
		movem.l (sp)+,d0-d2/a0-a1
		rts

    ; End of function LoadCursorTiles

til_87A2:       dc.b 8                  ; unknown tiles
		dc.b $10
		dc.b $C0
		dc.b 0
		dc.b $10
		dc.b 1
		dc.b $80
		dc.b $FF

; =============== S U B R O U T I N E =======================================

sub_87AA:
		clr.w   d0
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d0
		sub.b   ((SCREEN_POSITION+1-$1000000)).w,d0
		mulu.w  #$18,d0
		move.w  d0,((SCREEN_ADJUSTED_CURSOR_Y-$1000000)).w
		clr.w   d0
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d0
		sub.b   ((SCREEN_POSITION-$1000000)).w,d0
		mulu.w  #$18,d0
		move.w  d0,((SCREEN_ADJUSTED_CURSOR_X-$1000000)).w
		clr.w   d1
		clr.w   d2

    ; End of function sub_87AA


; =============== S U B R O U T I N E =======================================

; In: d1.w, d2.w = cursor X, Y speed

LoadCursorSpriteData:
		
		tst.b   ((byte_FFB538-$1000000)).w
		bne.w   loc_891C
		lea     spr_TargetingCursors(pc), a0
		clr.w   d0
		move.b  ((AREA_CURSOR_INDEX-$1000000)).w,d0
		andi.w  #$F,d0
		lsl.w   #6,d0
		adda.w  d0,a0
		lea     (SPRITE_54_PROPERTIES).l,a1
		moveq   #7,d7
loc_87F4:
		move.w  ((SCREEN_ADJUSTED_CURSOR_Y-$1000000)).w,d0
		add.w   (a0)+,d0
		ext.w   d2
		add.w   d2,d0
		move.w  d0,(a1)+
		move.w  (a0)+,(a1)+
		move.w  (a0)+,(a1)+
		move.w  ((SCREEN_ADJUSTED_CURSOR_X-$1000000)).w,d0
		add.w   (a0)+,d0
		ext.w   d1
		add.w   d1,d0
		move.w  d0,(a1)+
		dbf     d7,loc_87F4

		btst    #4,((AREA_CURSOR_INDEX-$1000000)).w
		beq.s   loc_883E
		lea     spr_DefaultTargetingCursor(pc), a0
		move.w  ((SCREEN_ADJUSTED_CURSOR_Y-$1000000)).w,d0
		add.w   (a0)+,d0
		ext.w   d2
		add.w   d2,d0
		move.w  d0,(a1)+
		move.w  (a0)+,(a1)+
		move.w  (a0)+,(a1)+
		move.w  ((SCREEN_ADJUSTED_CURSOR_X-$1000000)).w,d0
		add.w   (a0)+,d0
		ext.w   d1
		add.w   d1,d0
		move.w  d0,(a1)+
		bra.s   loc_884A
loc_883E:
		move.l  #$10009,(a1)+
		move.l  #$10001,(a1)+
loc_884A:
		move.w  #1,(SPRITE_03_PROPERTIES).l
		rts
spr_TargetingCursors:
		
		; sprite properties
        vdpSprite 116, V4|H4|62, 1664|PALETTE3,  120
        vdpSprite 1, V4|H4|62, 1664|PALETTE3,  1
        vdpSprite 1, V4|H4|62, 1664|PALETTE3,  1
        vdpSprite 1, V4|H4|62, 1664|PALETTE3,  1
        vdpSprite 1, V4|H4|62, 1664|PALETTE3,  1
        vdpSprite 1, V4|H4|62, 1664|PALETTE3,  1
        vdpSprite 1, V4|H4|62, 1664|PALETTE3,  1
        vdpSprite 1, V4|H4|62, 1664|PALETTE3,  1

        vdpSprite 86, V4|H4|55, 1680|PALETTE3,  120
        vdpSprite 116, V4|H4|56, 1696|PALETTE3,  96
        vdpSprite 146, V4|H4|57, 1680|FLIPPED_BIT|PALETTE3,  120
        vdpSprite 116, V4|H4|62, 1696|MIRRORED_BIT|PALETTE3,  144
        vdpSprite 1, V4|H4|62, 1664|PALETTE3,  1
        vdpSprite 1, V4|H4|62, 1664|PALETTE3,  1
        vdpSprite 1, V4|H4|62, 1664|PALETTE3,  1
        vdpSprite 1, V4|H4|62, 1664|PALETTE3,  1

        vdpSprite 62, V4|H4|55, 1680|PALETTE3,  120
        vdpSprite 116, V4|H4|56, 1696|PALETTE3,  72
        vdpSprite 170, V4|H4|57, 1680|FLIPPED_BIT|PALETTE3,  120
        vdpSprite 116, V4|H4|58, 1696|MIRRORED_BIT|PALETTE3,  168
        vdpSprite 86, V4|H4|59, 1712|PALETTE3,  92
        vdpSprite 86, V4|H4|60, 1712|MIRRORED_BIT|PALETTE3,  148
        vdpSprite 146, V4|H4|61, 1712|FLIPPED_BIT|PALETTE3,  92
        vdpSprite 146, V4|H4|62, 1712|MIRRORED_BIT|FLIPPED_BIT|PALETTE3,  148

spr_DefaultTargetingCursor:
		
        vdpSprite 116, V4|H4|63, 1728|PALETTE3,  120

loc_891C:
		addq.b  #1,((byte_FFB4C8-$1000000)).w
		lea     (SPRITE_03_PROPERTIES).l,a1
		move.w  ((SCREEN_ADJUSTED_CURSOR_Y-$1000000)).w,d0
		addi.w  #$70,d0 
		ext.w   d2
		add.w   d2,d0
		move.w  d0,(a1)+
		move.w  #$A08,(a1)+
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.w  d1,-(sp)
		jsr     j_GetEntity
		move.w  d0,d7
		lsl.w   #3,d0
		add.w   d7,d0
		add.w   d0,d0
		addi.w  #$4100,d0
		btst    #3,((byte_FFB4C8-$1000000)).w
		bne.s   loc_895E
		addi.w  #9,d0
loc_895E:
		btst    #7,d1
		beq.s   loc_8968
		addi.w  #$2000,d0
loc_8968:
		move.w  (sp)+,d1
		move.w  d0,(a1)+
		move.w  ((SCREEN_ADJUSTED_CURSOR_X-$1000000)).w,d0
		addi.w  #$7C,d0 
		ext.w   d1
		add.w   d1,d0
		move.w  d0,(a1)+
		move.l  #$10F04,(SPRITE_54_PROPERTIES).l
		rts

    ; End of function LoadCursorSpriteData


; =============== S U B R O U T I N E =======================================

sub_8986:
		clr.w   d1
		clr.w   d2
		clr.w   d3
		clr.w   d4
		move.b  ((CAMERA_XSPEED-$1000000)).w,d3
		move.b  ((CAMERA_YSPEED-$1000000)).w,d4
		ext.w   d3
		ext.w   d4
		add.w   d3,d3
		add.w   d4,d4
		addi.w  #-16,d3
		addi.w  #20,d4
		moveq   #5,d7
loc_89A8:
		clr.b   ((UPDATE_SCREEN_TOGGLE-$1000000)).w
		move.w  d7,-(sp)
		bsr.w   sub_8A22
		move.w  (sp)+,d7
		move.w  d7,-(sp)
		bsr.w   sub_8A8A
		move.w  (sp)+,d7
		movem.w d1-d7,-(sp)
		bsr.w   UpdateBattlefieldCameraPosition
		movem.w (sp)+,d1-d7
		tst.b   ((UPDATE_SCREEN_TOGGLE-$1000000)).w
		beq.s   loc_89DA
		movem.w d1-d7,-(sp)
		bsr.w   UpdateScreenAfterTileChange
		movem.w (sp)+,d1-d7
loc_89DA:
		move.w  d7,-(sp)
		bsr.w   UpdateCursorSpriteData
		move.w  (sp)+,d7
		cmpi.b  #1,((byte_FFB538-$1000000)).w
		bne.s   loc_89F8
		cmpi.w  #3,d7
		bne.s   loc_89F8
		move.w  d7,-(sp)
		bsr.w   CreateLandEffectWindow
		move.w  (sp)+,d7
loc_89F8:
		dbf     d7,loc_89A8
return_89FC:
		rts

    ; End of function sub_8986


; =============== S U B R O U T I N E =======================================

UpdateCursorSpriteData:
		
		move.b  ((CURSOR_XSPEED-$1000000)).w,d0
		ext.w   d0
		sub.w   d0,d1
		move.b  ((CURSOR_YSPEED-$1000000)).w,d0
		ext.w   d0
		sub.w   d0,d2
		move.w  d7,-(sp)
		bsr.w   LoadCursorSpriteData
		move.w  (sp)+,d7
		tst.w   d7
		beq.s   @Return
		jmp     (j_WaitForVInt).l
@Return:
		rts

    ; End of function UpdateCursorSpriteData


; =============== S U B R O U T I N E =======================================

sub_8A22:
		tst.b   ((CAMERA_XSPEED-$1000000)).w
		beq.s   return_89FC
		bgt.w   loc_8A6A
		cmpi.w  #5,d7
		bne.w   loc_8A52
		move.w  d3,d6
		jsr     (j_UpdateBackgroundHScrollData).l
		move.b  ((CAMERA_XSPEED-$1000000)).w,d0
		ext.w   d0
		sub.w   d0,d3
		asr.w   #2,d0
		add.b   d0,((SCREEN_POSITION-$1000000)).w
		move.b  #1,((UPDATE_SCREEN_TOGGLE-$1000000)).w
		rts
loc_8A52:
		move.w  d3,d6
		jsr     (j_UpdateBackgroundHScrollData).l
		jsr     (j_EnableDmaQueueProcessing).l
		move.b  ((CAMERA_XSPEED-$1000000)).w,d0
		ext.w   d0
		sub.w   d0,d3
		rts
loc_8A6A:
		tst.w   d7
		bne.s   loc_8A52
		moveq   #-4,d6
		jsr     (j_UpdateBackgroundHScrollData).l
		move.b  ((CAMERA_XSPEED-$1000000)).w,d0
		ext.w   d0
		asr.w   #2,d0
		add.b   d0,((SCREEN_POSITION-$1000000)).w
		move.b  #1,((UPDATE_SCREEN_TOGGLE-$1000000)).w
		rts

    ; End of function sub_8A22


; =============== S U B R O U T I N E =======================================

sub_8A8A:
		tst.b   ((CAMERA_YSPEED-$1000000)).w
		beq.w   return_89FC
		blt.w   loc_8AD4
		cmpi.w  #5,d7
		bne.w   loc_8ABC
		move.w  d4,d6
		jsr     (j_UpdateBackgroundVScrollData).l
		move.b  ((CAMERA_YSPEED-$1000000)).w,d0
		ext.w   d0
		sub.w   d0,d4
		asr.w   #2,d0
		sub.b   d0,((SCREEN_POSITION+1-$1000000)).w
		move.b  #1,((UPDATE_SCREEN_TOGGLE-$1000000)).w
		rts
loc_8ABC:
		move.w  d4,d6
		jsr     (j_UpdateBackgroundVScrollData).l
		jsr     (j_EnableDmaQueueProcessing).l
		move.b  ((CAMERA_YSPEED-$1000000)).w,d0
		ext.w   d0
		sub.w   d0,d4
		rts
loc_8AD4:
		tst.w   d7
		bne.s   loc_8ABC
		moveq   #8,d6
		jsr     (j_UpdateBackgroundVScrollData).l
		move.b  ((CAMERA_YSPEED-$1000000)).w,d0
		ext.w   d0
		asr.w   #2,d0
		sub.b   d0,((SCREEN_POSITION+1-$1000000)).w
		move.b  #1,((UPDATE_SCREEN_TOGGLE-$1000000)).w
		rts

    ; End of function sub_8A8A


; =============== S U B R O U T I N E =======================================

UpdateBattlefieldCamera:
		
		clr.w   d1
		clr.w   d2
		clr.w   d3
		clr.w   d4
		move.b  ((CAMERA_XSPEED-$1000000)).w,d3
		ext.w   d3
		asr.w   #1,d3
		move.b  d3,((CAMERA_XSPEED-$1000000)).w
		move.w  d3,d0
		asl.w   #2,d3
		add.w   d0,d3
		addi.w  #-16,d3
		move.b  ((CAMERA_YSPEED-$1000000)).w,d4
		ext.w   d4
		asr.w   #1,d4
		move.b  d4,((CAMERA_YSPEED-$1000000)).w
		move.w  d4,d0
		asl.w   #2,d4
		add.w   d0,d4
		addi.w  #20,d4
		moveq   #11,d7
loc_8B2A:
		clr.b   ((UPDATE_SCREEN_TOGGLE-$1000000)).w
		move.w  d7,-(sp)
		bsr.w   UpdateBackgroundHScrollForBattlefieldCamera
		move.w  (sp)+,d7
		move.w  d7,-(sp)
		bsr.w   UpdateBackgroundVScrollForBattlefieldCamera
		move.w  (sp)+,d7
		movem.w d1-d7,-(sp)
		bsr.w   UpdateBattlefieldCameraPosition
		movem.w (sp)+,d1-d7
		tst.b   ((UPDATE_SCREEN_TOGGLE-$1000000)).w
		beq.s   loc_8B5C
		movem.w d1-d7,-(sp)
		bsr.w   UpdateScreenAfterTileChange
		movem.w (sp)+,d1-d7
loc_8B5C:
		move.w  d7,-(sp)
		bsr.w   UpdateCursorSpriteData_0
		move.w  (sp)+,d7
		cmpi.b  #1,((byte_FFB538-$1000000)).w
		bne.s   loc_8B7A
		cmpi.w  #3,d7
		bne.s   loc_8B7A
		move.w  d7,-(sp)
		bsr.w   CreateLandEffectWindow
		move.w  (sp)+,d7
loc_8B7A:
		dbf     d7,loc_8B2A
		rts

    ; End of function UpdateBattlefieldCamera


; =============== S U B R O U T I N E =======================================

UpdateCursorSpriteData_0:
		
		move.b  ((CURSOR_XSPEED-$1000000)).w,d0
		ext.w   d0
		lsr.w   #1,d0
		sub.w   d0,d1
		move.b  ((CURSOR_YSPEED-$1000000)).w,d0
		ext.w   d0
		lsr.w   #1,d0
		sub.w   d0,d2
		move.w  d7,-(sp)
		bsr.w   LoadCursorSpriteData
		move.w  (sp)+,d7
		tst.w   d7
		beq.s   @Return
		jmp     (j_WaitForVInt).l
@Return:
		rts

    ; End of function UpdateCursorSpriteData_0


; =============== S U B R O U T I N E =======================================

UpdateBackgroundHScrollForBattlefieldCamera:
		
		tst.b   ((CAMERA_XSPEED-$1000000)).w
		beq.w   return_89FC
		bgt.w   loc_8BF2
		cmpi.w  #$B,d7
		bne.w   loc_8BDA
		move.w  d3,d6
		jsr     (j_UpdateBackgroundHScrollData).l
		move.b  ((CAMERA_XSPEED-$1000000)).w,d0
		ext.w   d0
		sub.w   d0,d3
		asr.w   #1,d0
		add.b   d0,((SCREEN_POSITION-$1000000)).w
		move.b  #1,((UPDATE_SCREEN_TOGGLE-$1000000)).w
		rts
loc_8BDA:
		move.w  d3,d6
		jsr     (j_UpdateBackgroundHScrollData).l
		jsr     (j_EnableDmaQueueProcessing).l
		move.b  ((CAMERA_XSPEED-$1000000)).w,d0
		ext.w   d0
		sub.w   d0,d3
		rts
loc_8BF2:
		tst.w   d7
		bne.s   loc_8BDA
		moveq   #$FFFFFFFC,d6
		jsr     (j_UpdateBackgroundHScrollData).l
		move.b  ((CAMERA_XSPEED-$1000000)).w,d0
		ext.w   d0
		asr.w   #1,d0
		add.b   d0,((SCREEN_POSITION-$1000000)).w
		move.b  #1,((UPDATE_SCREEN_TOGGLE-$1000000)).w
		rts

    ; End of function UpdateBackgroundHScrollForBattlefieldCamera


; =============== S U B R O U T I N E =======================================

UpdateBackgroundVScrollForBattlefieldCamera:
		
		tst.b   ((CAMERA_YSPEED-$1000000)).w
		beq.w   return_89FC
		blt.w   loc_8C5C
		cmpi.w  #$B,d7
		bne.w   loc_8C44
		move.w  d4,d6
		jsr     (j_UpdateBackgroundVScrollData).l
		move.b  ((CAMERA_YSPEED-$1000000)).w,d0
		ext.w   d0
		sub.w   d0,d4
		asr.w   #1,d0
		sub.b   d0,((SCREEN_POSITION+1-$1000000)).w
		move.b  #1,((UPDATE_SCREEN_TOGGLE-$1000000)).w
		rts
loc_8C44:
		move.w  d4,d6
		jsr     (j_UpdateBackgroundVScrollData).l
		jsr     (j_EnableDmaQueueProcessing).l
		move.b  ((CAMERA_YSPEED-$1000000)).w,d0
		ext.w   d0
		sub.w   d0,d4
		rts
loc_8C5C:
		tst.w   d7
		bne.s   loc_8C44
		moveq   #8,d6
		jsr     (j_UpdateBackgroundVScrollData).l
		move.b  ((CAMERA_YSPEED-$1000000)).w,d0
		ext.w   d0
		asr.w   #1,d0
		sub.b   d0,((SCREEN_POSITION+1-$1000000)).w
		move.b  #1,((UPDATE_SCREEN_TOGGLE-$1000000)).w
		rts

    ; End of function UpdateBackgroundVScrollForBattlefieldCamera


; =============== S U B R O U T I N E =======================================

sub_8C7C:
		clr.b   ((byte_FFB538-$1000000)).w
		clr.l   ((CAMERA_XSPEED-$1000000)).w
		bsr.w   sub_87AA
		btst    #INPUT_BIT_LEFT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_8C96
		bsr.w   sub_86DA
loc_8C96:
		btst    #INPUT_BIT_RIGHT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_8CA4
		bsr.w   sub_8650
loc_8CA4:
		btst    #INPUT_BIT_UP,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_8CB2
		bsr.w   sub_853E
loc_8CB2:
		btst    #INPUT_BIT_DOWN,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_8CC0
		bsr.w   sub_85C2
loc_8CC0:
		tst.l   ((CAMERA_XSPEED-$1000000)).w
		beq.s   return_8CD2
		sndCom  SFX_MENU_SELECTION
		bsr.w   sub_8986
		bsr.w   UpdateBattlefieldSprites
return_8CD2:
		rts

    ; End of function sub_8C7C


; =============== S U B R O U T I N E =======================================

sub_8CD4:
		move.l  a0,-(sp)
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_8CE4
		move.b  #1,((byte_FFB538-$1000000)).w
		bra.s   loc_8CEA
loc_8CE4:
		move.b  #2,((byte_FFB538-$1000000)).w
loc_8CEA:
		clr.l   ((CAMERA_XSPEED-$1000000)).w
		bsr.w   sub_87AA
		clr.w   d1
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d1
		mulu.w  ((MAP_WIDTH-$1000000)).w,d1
		clr.w   d0
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d0
		add.w   d1,d0
		lea     (PASSABILITY_FLAGS).l,a0
		adda.w  d0,a0
		btst    #INPUT_BIT_UP,(P1_INPUT).l
		beq.s   loc_8D1C
		bsr.w   sub_853E
		bra.s   loc_8D4A
loc_8D1C:
		btst    #INPUT_BIT_DOWN,(P1_INPUT).l
		beq.s   loc_8D2C
		bsr.w   sub_85C2
		bra.s   loc_8D4A
loc_8D2C:
		btst    #INPUT_BIT_LEFT,(P1_INPUT).l
		beq.s   loc_8D3C
		bsr.w   sub_86DA
		bra.s   loc_8D4A
loc_8D3C:
		btst    #INPUT_BIT_RIGHT,(P1_INPUT).l
		beq.s   loc_8D4A
		bsr.w   sub_8650
loc_8D4A:
		tst.l   ((CAMERA_XSPEED-$1000000)).w
		beq.s   loc_8D62
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_8D5A
		sndCom  SFX_WALKING
loc_8D5A:
		bsr.w   UpdateBattlefieldCamera
		bsr.w   UpdateBattlefieldSprites
loc_8D62:
		movea.l (sp)+,a0
		rts

    ; End of function sub_8CD4


; =============== S U B R O U T I N E =======================================

sub_8D66:
		move.b  #2,((byte_FFB538-$1000000)).w
		bra.s   loc_8D74

    ; End of function sub_8D66


; =============== S U B R O U T I N E =======================================

sub_8D6E:
		move.b  #1,((byte_FFB538-$1000000)).w
loc_8D74:
		clr.w   d1
		move.b  (a0)+,d1
		move.l  a0,-(sp)
		move.w  d1,-(sp)
		move.w  d1,-(sp)
		clr.l   ((CAMERA_XSPEED-$1000000)).w
		bsr.w   sub_87AA
		clr.w   d1
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d1
		mulu.w  ((MAP_WIDTH-$1000000)).w,d1
		clr.w   d0
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d0
		add.w   d1,d0
		lea     (PASSABILITY_FLAGS).l,a0
		adda.w  d0,a0
		move.w  (sp)+,d1
		cmpi.w  #3,d1
		bhi.w   loc_8DD8
		add.w   d1,d1
		move.w  off_8DB8(pc,d1.w),d1
		jsr     off_8DB8(pc,d1.w)
		bra.w   loc_8DC0
off_8DB8:
		dc.w sub_853E+$10000-off_8DB8
		dc.w sub_85C2+$10000-off_8DB8
		dc.w sub_8650+$10000-off_8DB8
		dc.w sub_86DA+$10000-off_8DB8
loc_8DC0:
		tst.l   ((CAMERA_XSPEED-$1000000)).w
		beq.s   loc_8DD8
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_8DD0
		sndCom  SFX_WALKING
loc_8DD0:
		bsr.w   UpdateBattlefieldCamera
		bsr.w   UpdateBattlefieldSprites
loc_8DD8:
		move.w  (sp)+,d0
		movea.l (sp)+,a0
		rts

    ; End of function sub_8D6E


; =============== S U B R O U T I N E =======================================

nullsub_8DDE:
		rts

    ; End of function nullsub_8DDE


; =============== S U B R O U T I N E =======================================

nullsub_8DE0:
		rts

    ; End of function nullsub_8DE0


; =============== S U B R O U T I N E =======================================

UpdateScreenAfterTileChange:
		
		lea     (byte_FFE000).l,a1
		move.w  ((MAP_WIDTH-$1000000)).w,d0
		move.w  d0,d1
		add.w   d0,d0
		add.w   d1,d0
		clr.w   d1
		clr.w   d2
		move.b  ((SCREEN_POSITION-$1000000)).w,d1
		move.b  ((SCREEN_POSITION+1-$1000000)).w,d2
		mulu.w  d0,d2
		add.w   d2,d1
		move.l  d1,-(sp)
		add.w   d1,d1
		move.l  (sp)+,d2
		add.w   d2,d1
		add.w   d1,d1
		lea     (MAP_SPRITE_POSITION).l,a0
		adda.w  d1,a0
loc_8E14:
		move.w  ((MAP_WIDTH-$1000000)).w,d0
		move.w  d0,d1
		add.w   d0,d0
		add.w   d1,d0
		subi.w  #$40,d0 
		add.w   d0,d0
		moveq   #$1F,d1
loc_8E26:
		moveq   #$3F,d2 
loc_8E28:
		move.w  (a0)+,(a1)+
		dbf     d2,loc_8E28

		adda.w  d0,a0
		dbf     d1,loc_8E26

		lea     (byte_FFE000).l,a0
		lea     ($E000).l,a1
		move.w  #$800,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jmp     (j_EnableDmaQueueProcessing).l

    ; End of function UpdateScreenAfterTileChange


; =============== S U B R O U T I N E =======================================

sub_8E52:
		move.b  d0,((TARGET_Y-$1000000)).w
		lsr.w   #8,d0
		move.b  d0,((TARGET_X-$1000000)).w
loc_8E5C:
		clr.l   ((CAMERA_XSPEED-$1000000)).w
		bsr.w   sub_87AA
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d0
		cmp.b   ((TARGET_X-$1000000)).w,d0
		ble.s   loc_8E76
		bsr.w   sub_86DA
		bra.w   loc_8E7C
loc_8E76:
		bge.s   loc_8E7C
		bsr.w   sub_8650
loc_8E7C:
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d0
		cmp.b   ((TARGET_Y-$1000000)).w,d0
		ble.s   loc_8E8C
		bsr.w   sub_853E
		bra.s   loc_8E92
loc_8E8C:
		bge.s   loc_8E92
		bsr.w   sub_85C2
loc_8E92:
		tst.l   ((CAMERA_XSPEED-$1000000)).w
		beq.s   loc_8EA0
		bsr.w   sub_8986
		bsr.w   UpdateBattlefieldSprites
loc_8EA0:
		jsr     (j_WaitForVInt).l
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d0
		sub.b   ((TARGET_X-$1000000)).w,d0
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d1
		sub.b   ((TARGET_Y-$1000000)).w,d1
		or.b    d1,d0
		bne.s   loc_8E5C
		rts

    ; End of function sub_8E52


; =============== S U B R O U T I N E =======================================

PopulateTurnOrder:
		
		lea     ((TURN_ORDER-$1000000)).w,a0
		move.l  a0,-(sp)
		moveq   #TURN_ORDER_LONGWORDS_COUNTER,d7
@ClearList_Loop:
		
		clr.l   (a0)+
		dbf     d7,@ClearList_Loop
		                
		movea.l (sp)+,a0
		clr.w   d0
		moveq   #COMBATANT_ENTRIES_COUNTER,d7
@RandomizeAgility_Loop:
		
		move.w  d7,-(sp)        ; save loop counter
		jsr     j_GetModifiedAgility
		cmpi.b  #-1,d1
		bne.w   @Continue
		                
		clr.w   d1
		moveq   #-1,d2
		bra.w   @LoadTurnOrderData
@Continue:
		move.w  d1,d5
		ble.w   @Default        ; fall back to default randomization if agility is 0 or less
		                
		move.w  d5,d6
		mulu.w  #51,d6
		addi.w  #128,d6
		lsr.w   #8,d6           ; D6 = (agility * 51 + 128) / 256
		sub.w   d6,d5
		addq.w  #1,d6
		jsr     (j_GenerateRandomNumber).w
		add.w   d7,d5
		jsr     (j_GenerateRandomNumber).w
		add.w   d7,d5
		moveq   #3,d6
		jsr     (j_GenerateRandomNumber).w
		subq.w  #1,d7
		add.w   d7,d5
		bra.w   @MoveTurnOrderData
@Default:
		moveq   #4,d6
		jsr     (j_GenerateRandomNumber).w
		lsr.w   #1,d7
		move.w  d7,d5
@MoveTurnOrderData:
		
		move.w  d5,d1
		move.b  d0,d2
@LoadTurnOrderData:
		
		move.w  (sp)+,d7        ; restore loop counter -> D7
		move.b  d2,(a0)+
		move.b  d1,(a0)+
		addq.w  #1,d0
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   @Sort
		dbf     d7,@RandomizeAgility_Loop
@Sort:
		moveq   #TURN_ORDER_SORT_MAIN_COUNTER,d6
@Sort_MainLoop:
		
		moveq   #TURN_ORDER_SORT_INNER_COUNTER,d7
		lea     ((TURN_ORDER-$1000000)).w,a0
@Sort_InnerLoop:
		
		move.w  (a0),d0
		move.w  NEXT_TURN_ORDER_ENTRY(a0),d1
		cmp.b   d0,d1
		ble.s   @Next
		move.w  d1,(a0)
		move.w  d0,NEXT_TURN_ORDER_ENTRY(a0)
@Next:
		addq.l  #TURN_ORDER_ENTRY_SIZE,a0
		dbf     d7,@Sort_InnerLoop
		dbf     d6,@Sort_MainLoop
		rts

    ; End of function PopulateTurnOrder


; =============== S U B R O U T I N E =======================================

sub_8F5C:
		move.b  ((CURRENT_REGION-$1000000)).w,d0
		ext.w   d0
		bpl.s   loc_8F7A
		lea     byte_8FBE(pc), a0
		nop
		moveq   #$23,d0 
		jsr     (j_CheckEventFlag).l
		beq.s   loc_8F76
		addq.l  #8,a0
loc_8F76:
		bra.w   loc_8F8C
loc_8F7A:
		clr.w   d1
		move.b  ((CURRENT_CHAPTER-$1000000)).w,d1
		subq.w  #1,d1
		lsl.w   #2,d1
		movea.l off_8F9E(pc,d1.w),a0
		lsl.w   #3,d0
		adda.w  d0,a0
loc_8F8C:
		clr.w   d0
		move.b  (a0)+,d0
		sndCom  SOUND_COMMAND_GET_D0_PARAMETER
		move.b  (a0)+,d0
		move.w  (a0)+,d1
		move.w  (a0)+,d2
		move.w  (a0)+,d3
		rts

    ; End of function sub_8F5C

off_8F9E:       dc.l byte_8FCE
		dc.l byte_9006
		dc.l byte_9036
		dc.l byte_904E
		dc.l byte_907E
		dc.l byte_909E
		dc.l byte_90BE
		dc.l byte_90DE
byte_8FBE:      dc.b MUSIC_HQ
		dc.b $B
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_HQ
		dc.b $26
		dc.w 0
		dc.w 0
		dc.w $FFFF
byte_8FCE:      dc.b MUSIC_MAIN_THEME
		dc.b $12
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_2
		dc.b 1
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_3
		dc.b 4
		dc.w 6
		dc.w 6
		dc.w $FFFF
		dc.b MUSIC_NOTHING
		dc.b 0
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_NOTHING
		dc.b 0
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_NOTHING
		dc.b 0
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_MAIN_THEME
		dc.b $12
		dc.w 0
		dc.w 0
		dc.w $FFFF
byte_9006:      dc.b MUSIC_MAIN_THEME
		dc.b $13
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_MAIN_THEME
		dc.b $13
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_MAIN_THEME
		dc.b $13
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_2
		dc.b $1A
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_3
		dc.b $F
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_3
		dc.b 8
		dc.w 1
		dc.w 2
		dc.w $FFFF
byte_9036:      dc.b MUSIC_MAIN_THEME
		dc.b $15
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_2
		dc.b $1C
		dc.w 0
		dc.w 0
		dc.w $1E
		dc.b MUSIC_BATTLE_2
		dc.b $23
		dc.w 0
		dc.w 0
		dc.w $FFFF
byte_904E:      dc.b MUSIC_MAIN_THEME
		dc.b $14
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_MAIN_THEME
		dc.b $14
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_1
		dc.b $1D
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_1
		dc.b $1D
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_1
		dc.b $1D
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_3
		dc.b $1D
		dc.w $29
		dc.w 0
		dc.w $FFFF
byte_907E:      dc.b MUSIC_SHIP
		dc.b $19
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_4
		dc.b $29
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_2
		dc.b $2A
		dc.w $A
		dc.w 9
		dc.w $FFFF
		dc.b MUSIC_BATTLE_4
		dc.b $29
		dc.w 0
		dc.w 0
		dc.w $FFFF
byte_909E:      dc.b MUSIC_MAIN_THEME
		dc.b $16
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_MAIN_THEME
		dc.b $16
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_3
		dc.b $1F
		dc.w $F
		dc.w $E
		dc.w $FFFF
		dc.b MUSIC_BATTLE_1
		dc.b $1B
		dc.w 0
		dc.w 0
		dc.w $FFFF
byte_90BE:      dc.b MUSIC_MAIN_THEME
		dc.b $17
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_MAIN_THEME
		dc.b $17
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_2
		dc.b $24
		dc.w 0
		dc.w $D
		dc.w $FFFF
		dc.b MUSIC_BATTLE_1
		dc.b $10
		dc.w 1
		dc.w $25
		dc.w $FFFF
byte_90DE:      dc.b MUSIC_MAIN_THEME
		dc.b $18
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_2
		dc.b $25
		dc.w 0
		dc.w $A
		dc.w $FFFF
		dc.b MUSIC_BATTLE_2
		dc.b $25
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_2
		dc.b $11
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_1
		dc.b $27
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_1
		dc.b $27
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_DARKSOL_BATTLE
		dc.b $2B
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_FINAL_BATTLE
		dc.b $2B
		dc.w 0
		dc.w 0
		dc.w $FFFF
		dc.b MUSIC_BATTLE_2
		dc.b $11
		dc.w 0
		dc.w 0
		dc.w $FFFF

; =============== S U B R O U T I N E =======================================

sub_9126:
		bsr.w   sub_8F5C
		move.w  d3,-(sp)
		move.w  d0,-(sp)
		move.b  d0,((byte_FFF807-$1000000)).w
		move.w  ((MAP_WIDTH-$1000000)).w,d3
		move.w  ((MAP_HEIGHT-$1000000)).w,d4
		movem.w d1-d4,-(sp)
		movea.l (p_pt_Maps).l,a0
		lsl.w   #5,d0
		adda.w  d0,a0
		movea.l (a0)+,a1
		move.l  a1,((dword_FFF910-$1000000)).w
		movea.l (a0)+,a2
		move.l  a2,((dword_FFF914-$1000000)).w
		addq.l  #8,a0
		movea.l (a0)+,a3
		move.l  a3,((dword_FFF920-$1000000)).w
		movea.l (a0)+,a4
		tst.w   (a0)+
		move.b  (a0),d0
		movem.l a1-a4,-(sp)
		move.w  d0,-(sp)
		andi.w  #$F0,d0 
		lsr.w   #2,d0
		movea.l (p_pt_MapTilesets).l,a0
		movea.l (a0,d0.w),a0
		lea     ($77C0).w,a1
		move.w  #$1000,d0
		moveq   #2,d1
		jsr     (j_ApplyImmediateVramDmaOnCompressedTiles).l
		move.w  (sp)+,d0
		move.w  d0,d1
		andi.w  #$F0,d1 
		lsr.w   #2,d1
		movea.l (off_58010).l,a0
		movea.l (a0,d1.w),a0
		andi.w  #$F,d0
		lsl.w   #2,d0
		movea.l (a0,d0.w),a0
		lea     ($97C0).l,a1
		move.w  #$1000,d0
		moveq   #2,d1
		jsr     (j_ApplyImmediateVramDmaOnCompressedTiles).l
		movem.l (sp)+,a1-a4
		lea     (PALETTE_1_BASE_01).l,a0
		move.l  (a4)+,(a0)+
		move.l  (a4)+,(a0)+
		move.l  (a4)+,(a0)+
		move.l  (a4)+,(a0)+
		move.l  (a4)+,(a0)+
		move.l  (a4)+,(a0)+
		move.l  (a4)+,(a0)+
		move.w  (a4)+,(a0)+
		movem.l a1-a2,-(sp)
		movea.l a3,a0
		move.l  #FF3000_LOADING_SPACE,((dword_FFF006-$1000000)).w
		clr.w   d0
		jsr     sub_10014
		movem.l (sp)+,a1-a2
		movem.w (sp)+,d1-d4
		lea     (FF3000_LOADING_SPACE).l,a4
		lea     (MAP_SPRITE_POSITION).l,a3
		clr.w   d5
		move.b  (MAP_WIDTH_0).l,d5
		move.w  d5,d6
		mulu.w  d2,d5
		add.w   d1,d5
		add.w   d5,d5
		adda.w  d5,a4
		sub.w   d3,d6
		add.w   d6,d6
		move.w  d6,d2
		move.w  d3,d5
		add.w   d5,d5
		move.w  d5,d1
		add.w   d5,d5
		add.w   d1,d5
		move.w  d5,d6
		subq.l  #4,d5
		add.w   d6,d6
		move.w  d6,d7
		subq.l  #2,d6
		subq.w  #1,d4
		subq.w  #1,d3
loc_922C:
		move.w  d3,-(sp)
loc_922E:
		move.w  (a4)+,d0
		andi.w  #$3FF,d0
		cmpi.w  #$294,d0
		bge.s   loc_923E
		movea.l a1,a0
		bra.s   loc_9244
loc_923E:
		movea.l a2,a0
		subi.w  #$294,d0
loc_9244:
		add.w   d0,d0
		move.w  d0,d1
		lsl.w   #3,d0
		add.w   d1,d0
		adda.w  d0,a0
		move.l  (a0)+,(a3)+
		move.w  (a0)+,(a3)
		adda.w  d5,a3
		move.l  (a0)+,(a3)+
		move.w  (a0)+,(a3)
		adda.w  d5,a3
		move.l  (a0)+,(a3)+
		move.w  (a0)+,(a3)
		suba.w  d6,a3
		dbf     d3,loc_922E

		adda.w  d7,a3
		adda.w  d2,a4
		move.w  (sp)+,d3
		dbf     d4,loc_922C

		bsr.w   sub_93C4
		bsr.w   sub_96AE
		move.w  (sp)+,d0
		clr.w   d0
		move.b  ((CURRENT_REGION-$1000000)).w,d0
		bpl.s   loc_9286
		moveq   #6,d0
		bra.w   loc_92A0
loc_9286:
		clr.w   d1
		move.b  ((CURRENT_CHAPTER-$1000000)).w,d1
		subq.w  #1,d1
		lea     byte_93BC(pc), a0
		add.b   (a0,d1.w),d0
		lea     byte_938A(pc), a0
		nop
		move.b  (a0,d0.w),d0
loc_92A0:
		lea     off_930E(pc), a0
		lsl.w   #2,d0
		movea.l (a0,d0.w),a0
		move.w  (a0)+,d0
		blt.s   loc_92DA
		move.l  a0,-(sp)
		movea.l (p_pt_TileAnimations).l,a0
		lsl.w   #2,d0
		movea.l (a0,d0.w),a0
		jsr     (j_DecompressGraphics).l
		lea     (FF3000_LOADING_SPACE).l,a0
		lea     (byte_FF4900).l,a1
		move.w  #$1BF,d7
loc_92D2:
		move.l  (a0)+,(a1)+
		dbf     d7,loc_92D2

		movea.l (sp)+,a0
loc_92DA:
		move.w  (a0)+,((word_FFBC60-$1000000)).w
		move.w  (a0)+,((word_FFBC62-$1000000)).w
		move.w  (a0)+,((word_FFBC64-$1000000)).w
		move.w  #1,((word_FFBC66-$1000000)).w
		clr.w   ((word_FFBC68-$1000000)).w
		lea     ((byte_FFB5B1-$1000000)).w,a1
		moveq   #$A,d7
		jsr     (j_CopyBytes).l
		move.w  (sp)+,d0
		tst.b   ((CURRENT_MAP_VERSION-$1000000)).w
		blt.s   return_930C
		tst.w   d0
		blt.s   return_930C
		move.w  d0,((MAP_HEIGHT-$1000000)).w
return_930C:
		rts

    ; End of function sub_9126

off_930E:       dc.l word_932A
		dc.l word_9336
		dc.l word_9348
		dc.l word_9354
		dc.l word_9360
		dc.l word_936C
		dc.l word_937E
word_932A:      dc.w $FFFF
		dc.w 9
		dc.w $340
		dc.w $2710
		dc.w 0
		dc.w $FFFF
word_9336:      dc.w 0
		dc.w 9
		dc.w $4B3
		dc.w $A
		dc.w 1
		dc.w 0
		dc.w 0
		dc.w 0
		dc.w $FFFF
word_9348:      dc.w 1
		dc.w $B
		dc.w $4C3
		dc.w $A
		dc.w 1
		dc.w $FFFF
word_9354:      dc.w 2
		dc.w $D
		dc.w $51E
		dc.w $A
		dc.w 1
		dc.w $FFFF
word_9360:      dc.w 3
		dc.w $C
		dc.w $3D1
		dc.w $14
		dc.w 1
		dc.w $FFFF
word_936C:      dc.w 4
		dc.w 2
		dc.w $40C
		dc.w $A
		dc.w 1
		dc.w $203
		dc.w $405
		dc.w $607
		dc.w $FFFF
word_937E:      dc.w 5
		dc.w 4
		dc.w $57B
		dc.w $A
		dc.w 1
		dc.w $FFFF
byte_938A:      dc.b 5
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 5
		dc.b 5
		dc.b 5
		dc.b 5
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 5
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 5
		dc.b 5
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 4
		dc.b 0
		dc.b 4
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 5
		dc.b 5
		dc.b 2
		dc.b 3
		dc.b 0
		dc.b 0
		dc.b 5
		dc.b 5
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 5
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 1
byte_93BC:      dc.b 0
		dc.b 7
		dc.b $D
		dc.b $11
		dc.b $17
		dc.b $1E
		dc.b $24
		dc.b $2A

; =============== S U B R O U T I N E =======================================

sub_93C4:
		clr.w   d0
		move.b  ((CURRENT_REGION-$1000000)).w,d0
		bmi.w   nullsub_95E2
		clr.w   d1
		move.b  ((CURRENT_CHAPTER-$1000000)).w,d1
		subq.w  #1,d1
		add.b   byte_93BC(pc,d1.w),d0
		add.w   d0,d0
		move.w  off_93E4(pc,d0.w),d0
		jmp     off_93E4(pc,d0.w)

    ; End of function sub_93C4

off_93E4:       dc.w sub_944C-off_93E4
		dc.w sub_945C-off_93E4
		dc.w return_9484-off_93E4
		dc.w return_9484-off_93E4
		dc.w return_9484-off_93E4
		dc.w return_9484-off_93E4
		dc.w return_9484-off_93E4
		dc.w nullsub_9486-off_93E4
		dc.w loc_9498-off_93E4
		dc.w sub_9488-off_93E4
		dc.w nullsub_94A8-off_93E4
		dc.w nullsub_94A8-off_93E4
		dc.w nullsub_94A8-off_93E4
		dc.w nullsub_94A8-off_93E4
		dc.w nullsub_94A8-off_93E4
		dc.w nullsub_94A8-off_93E4
		dc.w nullsub_94A8-off_93E4
		dc.w nullsub_94AA-off_93E4
		dc.w sub_94AC-off_93E4
		dc.w nullsub_94BC-off_93E4
		dc.w sub_94CE-off_93E4
		dc.w sub_94BE-off_93E4
		dc.w sub_94DE-off_93E4
		dc.w nullsub_94EE-off_93E4
		dc.w nullsub_94EE-off_93E4
		dc.w nullsub_94EE-off_93E4
		dc.w nullsub_94EE-off_93E4
		dc.w nullsub_94EE-off_93E4
		dc.w nullsub_94EE-off_93E4
		dc.w nullsub_94EE-off_93E4
		dc.w sub_94F0-off_93E4
		dc.w nullsub_9500-off_93E4
		dc.w nullsub_9500-off_93E4
		dc.w nullsub_9500-off_93E4
		dc.w nullsub_9500-off_93E4
		dc.w nullsub_9500-off_93E4
		dc.w nullsub_9500-off_93E4
		dc.w sub_9502-off_93E4
		dc.w sub_9512-off_93E4
		dc.w nullsub_9542-off_93E4
		dc.w nullsub_9542-off_93E4
		dc.w nullsub_9542-off_93E4
		dc.w nullsub_9542-off_93E4
		dc.w nullsub_9542-off_93E4
		dc.w sub_9544-off_93E4
		dc.w sub_9554-off_93E4
		dc.w nullsub_9564-off_93E4
		dc.w sub_9566-off_93E4
		dc.w nullsub_9576-off_93E4
		dc.w sub_9578-off_93E4
		dc.w nullsub_95E2-off_93E4
		dc.w nullsub_95E2-off_93E4

; =============== S U B R O U T I N E =======================================

sub_944C:
		moveq   #$20,d1 
		moveq   #0,d2
		moveq   #$15,d3
		moveq   #$17,d4
		moveq   #5,d5
		moveq   #6,d6
		bra.w   sub_95E4

    ; End of function sub_944C


; =============== S U B R O U T I N E =======================================

sub_945C:
		moveq   #$32,d0 
		jsr     (j_CheckEventFlag).l
		bne.w   nullsub_95E2
		moveq   #$11,d1
		moveq   #0,d2
		moveq   #2,d3
		moveq   #7,d4
		moveq   #5,d5
		moveq   #$C,d6
		bra.w   sub_95E4

    ; End of function sub_945C

		moveq   #$28,d0 
		jsr     (j_CheckEventFlag).l
		bne.w   nullsub_95E2
return_9484:    rts

; =============== S U B R O U T I N E =======================================

nullsub_9486:
		rts

    ; End of function nullsub_9486


; =============== S U B R O U T I N E =======================================

sub_9488:
		moveq   #$20,d1 
		moveq   #$19,d2
		moveq   #$1C,d3
		moveq   #$19,d4
		moveq   #0,d5
		moveq   #0,d6
		bsr.w   sub_95E4

    ; End of function sub_9488

loc_9498:       moveq   #$20,d1 
		moveq   #$1A,d2
		moveq   #$19,d3
		moveq   #$1B,d4
		moveq   #0,d5
		moveq   #1,d6
		bra.w   sub_95E4

; =============== S U B R O U T I N E =======================================

nullsub_94A8:
		rts

    ; End of function nullsub_94A8


; =============== S U B R O U T I N E =======================================

nullsub_94AA:
		rts

    ; End of function nullsub_94AA


; =============== S U B R O U T I N E =======================================

sub_94AC:
		moveq   #2,d1
		moveq   #4,d2
		moveq   #$2A,d3 
		moveq   #$B,d4
		moveq   #1,d5
		moveq   #0,d6
		bra.w   sub_95E4

    ; End of function sub_94AC


; =============== S U B R O U T I N E =======================================

nullsub_94BC:
		rts

    ; End of function nullsub_94BC


; =============== S U B R O U T I N E =======================================

sub_94BE:
		moveq   #$26,d1 
		moveq   #$10,d2
		moveq   #9,d3
		moveq   #7,d4
		moveq   #0,d5
		moveq   #0,d6
		bra.w   sub_95E4

    ; End of function sub_94BE


; =============== S U B R O U T I N E =======================================

sub_94CE:
		moveq   #$26,d1 
		moveq   #$10,d2
		moveq   #$10,d3
		moveq   #$B,d4
		moveq   #0,d5
		moveq   #0,d6
		bra.w   sub_95E4

    ; End of function sub_94CE


; =============== S U B R O U T I N E =======================================

sub_94DE:
		moveq   #$57,d1 
		moveq   #$19,d2
		moveq   #5,d3
		moveq   #$11,d4
		moveq   #1,d5
		moveq   #1,d6
		bra.w   sub_95E4

    ; End of function sub_94DE


; =============== S U B R O U T I N E =======================================

nullsub_94EE:
		rts

    ; End of function nullsub_94EE


; =============== S U B R O U T I N E =======================================

sub_94F0:
		moveq   #0,d1
		moveq   #$20,d2 
		moveq   #$D,d3
		moveq   #$1D,d4
		moveq   #1,d5
		moveq   #1,d6
		bra.w   sub_95E4

    ; End of function sub_94F0


; =============== S U B R O U T I N E =======================================

nullsub_9500:
		rts

    ; End of function nullsub_9500


; =============== S U B R O U T I N E =======================================

sub_9502:
		moveq   #0,d1
		moveq   #$20,d2 
		moveq   #$F,d3
		moveq   #$1E,d4
		moveq   #0,d5
		moveq   #0,d6
		bra.w   sub_95E4

    ; End of function sub_9502


; =============== S U B R O U T I N E =======================================

sub_9512:
		moveq   #$13,d1
		moveq   #$2F,d2 
		moveq   #$F,d3
		moveq   #$16,d4
		moveq   #1,d5
		moveq   #1,d6
		bsr.w   sub_95E4
		moveq   #$15,d1
		moveq   #$2F,d2 
		moveq   #$F,d3
		moveq   #1,d4
		moveq   #0,d5
		moveq   #1,d6
		bsr.w   sub_95E4
		moveq   #1,d1
		moveq   #$2E,d2 
		moveq   #$F,d3
		moveq   #$18,d4
		moveq   #1,d5
		moveq   #0,d6
		bra.w   sub_95E4

    ; End of function sub_9512


; =============== S U B R O U T I N E =======================================

nullsub_9542:
		rts

    ; End of function nullsub_9542


; =============== S U B R O U T I N E =======================================

sub_9544:
		moveq   #$A,d1
		moveq   #$18,d2
		moveq   #$A,d3
		moveq   #$12,d4
		moveq   #6,d5
		moveq   #5,d6
		bra.w   sub_95E4

    ; End of function sub_9544


; =============== S U B R O U T I N E =======================================

sub_9554:
		moveq   #$E,d1
		moveq   #0,d2
		moveq   #7,d3
		moveq   #$21,d4 
		moveq   #1,d5
		moveq   #2,d6
		bra.w   sub_95E4

    ; End of function sub_9554


; =============== S U B R O U T I N E =======================================

nullsub_9564:
		rts

    ; End of function nullsub_9564


; =============== S U B R O U T I N E =======================================

sub_9566:
		moveq   #$A,d1
		moveq   #$20,d2 
		moveq   #$E,d3
		moveq   #0,d4
		moveq   #4,d5
		moveq   #5,d6
		bra.w   sub_95E4

    ; End of function sub_9566


; =============== S U B R O U T I N E =======================================

nullsub_9576:
		rts

    ; End of function nullsub_9576


; =============== S U B R O U T I N E =======================================

sub_9578:
		moveq   #4,d0
		bsr.w   sub_9734
		moveq   #$FFFFFF81,d0
		jsr     j_GetCurrentHP
		tst.w   d1
		bne.s   loc_959A
		moveq   #7,d1
		moveq   #$20,d2 
		moveq   #$B,d3
		moveq   #7,d4
		moveq   #2,d5
		moveq   #2,d6
		bsr.w   sub_95E4
loc_959A:
		moveq   #$FFFFFF80,d0
		jsr     j_GetCurrentHP
		tst.w   d1
		bne.s   loc_95B6
		moveq   #$A,d1
		moveq   #$20,d2 
		moveq   #$E,d3
		moveq   #9,d4
		moveq   #2,d5
		moveq   #2,d6
		bsr.w   sub_95E4
loc_95B6:
		moveq   #$FFFFFF82,d0
		jsr     j_GetCurrentHP
		tst.w   d1
		bne.s   loc_95D2
		moveq   #$D,d1
		moveq   #$20,d2 
		moveq   #$11,d3
		moveq   #7,d4
		moveq   #2,d5
		moveq   #2,d6
		bsr.w   sub_95E4
loc_95D2:
		moveq   #0,d1
		moveq   #$20,d2 
		moveq   #$C,d3
		moveq   #2,d4
		moveq   #6,d5
		moveq   #3,d6
		bra.w   sub_95E4

    ; End of function sub_9578


; =============== S U B R O U T I N E =======================================

nullsub_95E2:
		rts

    ; End of function nullsub_95E2


; =============== S U B R O U T I N E =======================================

sub_95E4:
		movem.w d1/d3/d5,-(sp)
loc_95E8:
		bsr.w   loc_960A
		addq.w  #1,d1
		addq.w  #1,d3
		dbf     d5,loc_95E8

		movem.w (sp)+,d1/d3/d5
		addq.w  #1,d2
		addq.w  #1,d4
		dbf     d6,sub_95E4
		rts

    ; End of function sub_95E4


; =============== S U B R O U T I N E =======================================

; Wrapper for 9626 - Set tile D3,D4 to D0

sub_9602:
		movem.w d0-d7,-(sp)
		bra.w   loc_9626
loc_960A:
		movem.w d0-d7,-(sp)
		lea     (FF3000_LOADING_SPACE).l,a4
		clr.w   d5
		move.b  (MAP_WIDTH_0).l,d5
		mulu.w  d2,d5
		add.w   d1,d5
		add.w   d5,d5
		adda.w  d5,a4
		move.w  (a4)+,d0
loc_9626:
		move.w  ((MAP_WIDTH-$1000000)).w,d5
		add.w   d5,d5
		move.w  d5,d1
		add.w   d5,d5
		add.w   d1,d5
		subq.l  #4,d5
		lea     (MAP_SPRITE_POSITION).l,a3
		mulu.w  ((MAP_WIDTH-$1000000)).w,d4
		add.w   d4,d4
		move.w  d4,d1
		lsl.w   #3,d4
		add.w   d1,d4
		add.w   d3,d3
		move.w  d3,d1
		add.w   d3,d3
		add.w   d1,d3
		adda.w  d3,a3
		adda.w  d4,a3
		andi.w  #$3FF,d0
		cmpi.w  #$294,d0
		bge.s   loc_9662
		movea.l ((dword_FFF910-$1000000)).w,a0
		bra.s   loc_966A
loc_9662:
		movea.l ((dword_FFF914-$1000000)).w,a0
		subi.w  #$294,d0
loc_966A:
		add.w   d0,d0
		move.w  d0,d1
		lsl.w   #3,d0
		add.w   d1,d0
		adda.w  d0,a0
		move.l  (a0)+,(a3)+
		move.w  (a0)+,(a3)
		adda.w  d5,a3
		move.l  (a0)+,(a3)+
		move.w  (a0)+,(a3)
		adda.w  d5,a3
		move.l  (a0)+,(a3)+
		move.w  (a0)+,(a3)
		movem.w (sp)+,d0-d7
		rts

    ; End of function sub_9602


; =============== S U B R O U T I N E =======================================

sub_968A:
		movem.w d1-d6,-(sp)
		movea.l ((dword_FFF920-$1000000)).w,a0
		move.l  #FF3000_LOADING_SPACE,((dword_FFF006-$1000000)).w
		clr.w   d0
		jsr     sub_10014
		movem.w (sp)+,d1-d6
		bsr.w   sub_95E4
		bra.w   UpdateScreenAfterTileChange

    ; End of function sub_968A


; =============== S U B R O U T I N E =======================================

sub_96AE:
		clr.w   d7
		move.b  ((CURRENT_CHAPTER-$1000000)).w,d7
		subq.w  #1,d7
		lsl.w   #7,d7
		movea.l (p_BattleChests).l,a0
		adda.w  d7,a0
		move.b  ((CURRENT_REGION-$1000000)).w,d1
		move.w  #$1F,d7
		clr.w   d3
loc_96CA:
		cmp.b   (a0),d1
		bne.s   loc_96F2
		move.w  d3,d0
		jsr     (j_CheckEventFlag).l
		beq.s   loc_96F2
		move.w  d3,-(sp)
		clr.w   d3
		clr.w   d4
		move.b  1(a0),d3
		move.b  2(a0),d4
		moveq   #1,d0
		move.l  a0,-(sp)
		bsr.w   sub_9602        
		movea.l (sp)+,a0
		move.w  (sp)+,d3
loc_96F2:
		addq.w  #1,d3
		addq.l  #4,a0
		dbf     d7,loc_96CA
		rts

    ; End of function sub_96AE


; =============== S U B R O U T I N E =======================================

; Change chest tile to open at D1,D2

sub_96FC:
		movem.w d0-d4,-(sp)
		moveq   #1,d0
		clr.w   d3
		clr.w   d4
		move.b  d1,d3
		move.b  d2,d4
		bsr.w   sub_9602        
		bsr.w   UpdateScreenAfterTileChange
		movem.w (sp)+,d0-d4
		rts

    ; End of function sub_96FC


; =============== S U B R O U T I N E =======================================

; Change chest tile to closed at D1,D2

sub_9718:
		movem.w d0-d4,-(sp)
		clr.w   d0
		clr.w   d3
		clr.w   d4
		move.b  d1,d3
		move.b  d2,d4
		bsr.w   sub_9602        
		bsr.w   UpdateScreenAfterTileChange
		movem.w (sp)+,d0-d4
		rts

    ; End of function sub_9718


; =============== S U B R O U T I N E =======================================

sub_9734:
		lea     plt_DarkDragonMap(pc), a0
		lsl.w   #5,d0
		adda.w  d0,a0
		lea     (PALETTE_1_BASE).l,a1
		lea     (PALETTE_1_CURRENT).l,a2
		moveq   #7,d7
loc_974A:
		move.l  (a0),(a1)+
		move.l  (a0)+,(a2)+
		dbf     d7,loc_974A
		rts

    ; End of function sub_9734

plt_DarkDragonMap:
		dc.w 0
		dc.w $E
		dc.w $206
		dc.w $466
		dc.w $CA8
		dc.w $664
		dc.w $442
		dc.w $244
		dc.w $420
		dc.w $44A
		dc.w $446
		dc.w $226
		dc.w $226
		dc.w $206
		dc.w 0
		dc.w $468
		dc.w 0
		dc.w $E
		dc.w $206
		dc.w $466
		dc.w $CA8
		dc.w $664
		dc.w $442
		dc.w $244
		dc.w $420
		dc.w $64A
		dc.w $666
		dc.w $448
		dc.w $246
		dc.w $206
		dc.w 0
		dc.w $446
		dc.w 0
		dc.w $E
		dc.w $206
		dc.w $466
		dc.w $CA8
		dc.w $664
		dc.w $442
		dc.w $244
		dc.w $420
		dc.w $648
		dc.w $888
		dc.w $46A
		dc.w $468
		dc.w $226
		dc.w 0
		dc.w $244
		dc.w 0
		dc.w $E
		dc.w $206
		dc.w $466
		dc.w $CA8
		dc.w $664
		dc.w $442
		dc.w $244
		dc.w $420
		dc.w $848
		dc.w $CA8
		dc.w $68A
		dc.w $488
		dc.w $226
		dc.w 0
		dc.w $22
		dc.w 0
		dc.w $E
		dc.w $206
		dc.w $466
		dc.w $CA8
		dc.w $664
		dc.w $442
		dc.w $244
		dc.w $420
		dc.w $A48
		dc.w $EE8
		dc.w $8AC
		dc.w $48A
		dc.w $246
		dc.w 0
		dc.w 0

; =============== S U B R O U T I N E =======================================

sub_97F4:
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.w   loc_9824
		moveq   #$1F,d7
loc_97FE:
		movem.w d7,-(sp)
		moveq   #$1F,d0
		sub.w   d7,d0
		jsr     j_GetMapSpriteForCombatant
		cmpi.w  #$FFFF,d1
		beq.s   loc_9814
		bsr.s   sub_9872
loc_9814:
		movem.w (sp)+,d7
		dbf     d7,loc_97FE
return_981C:
		rts
und_981E:
		dc.b 0
		dc.b $9A
		dc.b $99
		dc.b $99
		dc.b $99
		dc.b 0
loc_9824:
		cmpi.b  #ALLY_NOVA,((COMBATANT_1_ENTITY-$1000000)).w
		beq.s   return_981C
		clr.w   d0
		movem.w d0/d2,-(sp)
		moveq   #$38,d0 
		moveq   #-1,d1
		jsr     (sub_37C).l
		move.b  d2,d1
		movem.w (sp)+,d0/d2
		beq.w   loc_9850
		andi.w  #$FF,d1
		move.b  und_981E(pc,d1.w),d1
		bra.s   loc_9856
loc_9850:
		jsr     j_GetMapSpriteForCombatant
loc_9856:
		bsr.s   sub_9872
		moveq   #$1E,d7
loc_985A:
		moveq   #$1F,d0
		sub.w   d7,d0
		moveq   #$70,d1 
		jsr     j_SetCombatantX
		jsr     j_SetCombatantY
		dbf     d7,loc_985A
		rts

    ; End of function sub_97F4


; =============== S U B R O U T I N E =======================================

sub_9872:
		movea.l (p_pt_MapSprites).l,a0
		lsl.w   #2,d1
		movea.l (a0,d1.w),a0
		movem.w d0,-(sp)
		jsr     (sub_300).l
		lea     (FF3000_LOADING_SPACE).l,a0
		movem.w (sp)+,d0
		mulu.w  #$240,d0
		addi.w  #$2000,d0
		movea.w d0,a1
		move.w  #$120,d0
		moveq   #2,d1
		jmp     (j_ApplyImmediateVramDma).l

    ; End of function sub_9872


; =============== S U B R O U T I N E =======================================

sub_98A8:
		lea     ((COMBATANT_DATA-$1000000)).w,a0
		lea     (SPRITE_22_PROPERTIES).l,a1
		moveq   #$1F,d7
loc_98B4:
		moveq   #$1F,d0
		sub.w   d7,d0
		cmpi.b  #$FF,(a0)
		bne.s   loc_98C2
		moveq   #-1,d1
		bra.s   loc_98C6
loc_98C2:
		move.b  2(a0),d1
loc_98C6:
		sub.b   ((SCREEN_POSITION+1-$1000000)).w,d1
		ext.w   d1
		move.w  d1,d2
		add.w   d1,d1
		add.w   d2,d1
		asl.w   #3,d1
		addi.w  #$70,d1 
		cmpi.w  #$50,d1 
		blt.s   loc_98E8
		cmpi.w  #$188,d1
		bgt.s   loc_98E8
		move.w  d1,(a1)+
		bra.s   loc_98EC
loc_98E8:
		move.w  #1,(a1)+
loc_98EC:
		move.w  #$A36,d0
		sub.w   d7,d0
		move.w  d0,(a1)+
		move.w  #$1F,d0
		sub.w   d7,d0
		mulu.w  #$12,d0
		addi.w  #$6100,d0
		tst.b   (a0)
		blt.s   loc_990A
		subi.w  #$2000,d0
loc_990A:
		move.w  d0,(a1)+
		move.b  1(a0),d1
		sub.b   ((SCREEN_POSITION-$1000000)).w,d1
		ext.w   d1
		move.w  d1,d2
		add.w   d1,d1
		add.w   d2,d1
		asl.w   #3,d1
		addi.w  #$7C,d1 
		cmpi.w  #$60,d1 
		blt.s   loc_9932
		cmpi.w  #$188,d1
		bgt.s   loc_9932
		move.w  d1,(a1)+
		bra.s   loc_9936
loc_9932:
		move.w  #1,(a1)+
loc_9936:
		adda.w  #$10,a0
		dbf     d7,loc_98B4
		rts

    ; End of function sub_98A8


; =============== S U B R O U T I N E =======================================

UpdateBattlefieldSprites:
		
		lea     ((COMBATANT_DATA-$1000000)).w,a0
		lea     (SPRITE_22_PROPERTIES).l,a1
		moveq   #$1F,d7
loc_994C:
		clr.w   d6
		moveq   #$1F,d0
		sub.w   d7,d0
		cmpi.b  #$FF,(a0)
		bne.s   loc_995C
		moveq   #-1,d1
		bra.s   loc_996A
loc_995C:
		cmp.b   ((byte_FFB4D3-$1000000)).w,d0
		bne.s   loc_9966
		moveq   #-1,d1
		bra.s   loc_996A
loc_9966:
		move.b  2(a0),d1
loc_996A:
		sub.b   ((SCREEN_POSITION+1-$1000000)).w,d1
		ext.w   d1
		move.w  d1,d2
		add.w   d1,d1
		add.w   d2,d1
		asl.w   #3,d1
		addi.w  #$70,d1 
		move.w  d1,(a1)+
		cmpi.w  #$50,d1 
		blt.s   loc_998A
		cmpi.w  #$188,d1
		ble.s   loc_998E
loc_998A:
		move.w  #1,d6
loc_998E:
		addq.l  #4,a1
		move.b  1(a0),d1
		sub.b   ((SCREEN_POSITION-$1000000)).w,d1
		ext.w   d1
		move.w  d1,d2
		add.w   d1,d1
		add.w   d2,d1
		asl.w   #3,d1
		addi.w  #$7C,d1 
		move.w  d1,(a1)+
		cmpi.w  #$60,d1 
		blt.s   loc_99B4
		cmpi.w  #$188,d1
		ble.s   loc_99B8
loc_99B4:
		move.w  #1,d6
loc_99B8:
		tst.w   d6
		beq.s   loc_99C2
		move.w  #1,-8(a1)
loc_99C2:
		adda.w  #$10,a0
		dbf     d7,loc_994C
		rts

    ; End of function UpdateBattlefieldSprites


; =============== S U B R O U T I N E =======================================

UpdateBattlefieldCameraPosition:
		
		lea     (SPRITE_22_PROPERTIES).l,a1
		moveq   #$1F,d7
loc_99D4:
		move.w  (a1),d0
		move.b  ((CAMERA_YSPEED-$1000000)).w,d1
		ext.w   d1
		add.w   d1,d0
		ble.s   loc_99E2
		move.w  d0,(a1)
loc_99E2:
		move.w  6(a1),d0
		move.b  ((CAMERA_XSPEED-$1000000)).w,d1
		ext.w   d1
		sub.w   d1,d0
		ble.s   loc_99F4
		move.w  d0,6(a1)
loc_99F4:
		addq.l  #8,a1
		dbf     d7,loc_99D4
		rts

    ; End of function UpdateBattlefieldCameraPosition


; =============== S U B R O U T I N E =======================================

sub_99FC:
		lea     MapSpritePalettes(pc), a0
		lea     (PALETTE_3_BASE).l,a1
		moveq   #$1F,d0
		jmp     (j_CopyPalette_Loop).l

    ; End of function sub_99FC

MapSpritePalettes:
		incbin "data/graphics/tech/palettes/mapspritepalettes.bin"
defined_byte_9A4E:
		dc.b $10
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $41
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $40
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $11
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $41
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $40
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $20
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $41
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $40
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $21
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $41
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $40
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0

; =============== S U B R O U T I N E =======================================

sub_9A8A:
		bsr.s   sub_9A9A

    ; End of function sub_9A8A


; =============== S U B R O U T I N E =======================================

sub_9A8C:
		bsr.w   sub_9B4E
		bsr.w   sub_9BAA
		bsr.w   sub_E02C
		rts

    ; End of function sub_9A8C


; =============== S U B R O U T I N E =======================================

sub_9A9A:
		clr.w   d6
		move.b  (SECONDS_COUNTER_FRAMES).l,d6
		lea     ((COMBATANT_DATA-$1000000)).w,a0
		lea     (SPRITE_22_TILE_FLAGS).l,a1
		move.b  defined_byte_9A4E(pc,d6.w),d1
		beq.w   return_9B4C
		btst    #6,d1
		bne.w   loc_9B08
		move.w  d1,d6
		andi.w  #$30,d6 
		cmpi.w  #$10,d6
		bne.s   loc_9ACC
		clr.w   d6
		bra.s   loc_9ACE
loc_9ACC:
		moveq   #-1,d6
loc_9ACE:
		moveq   #$1F,d7
loc_9AD0:
		move.b  (a0),d0
		eor.b   d6,d0
		bge.w   loc_9AFC
		move.w  #$1F,d0
		sub.w   d7,d0
		mulu.w  #$12,d0
		addi.w  #$6100,d0
		cmpi.b  #$FF,(a0)
		blt.s   loc_9AF0
		subi.w  #$2000,d0
loc_9AF0:
		btst    #0,d1
		beq.s   loc_9AFA
		addi.w  #9,d0
loc_9AFA:
		move.w  d0,(a1)
loc_9AFC:
		addq.w  #8,a1
		adda.w  #$10,a0
		dbf     d7,loc_9AD0
		rts
loc_9B08:
		lea     (SPRITE_21_LINK).l,a0
		moveq   #$1F,d7
		moveq   #$16,d0
loc_9B12:
		move.b  d0,(a0)
		addq.w  #8,a0
		addq.w  #1,d0
		dbf     d7,loc_9B12

		clr.w   d0
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		cmpi.b  #$FF,d0
		beq.w   return_9B4C
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.w   return_9B4C
		move.w  d0,d2
		addi.w  #$17,d2
		btst    #0,d1
		beq.s   return_9B4C
		lea     (SPRITE_22_TILE_FLAGS).l,a0
		lsl.w   #3,d0
		adda.w  d0,a0
		move.b  d2,-9(a0)
return_9B4C:
		rts

    ; End of function sub_9A9A


; =============== S U B R O U T I N E =======================================

sub_9B4E:
		cmpi.b  #$FF,((byte_FFB5B1-$1000000)).w
		beq.s   return_9BA8
		subq.w  #1,((word_FFBC66-$1000000)).w
		bne.s   return_9BA8
		move.w  ((word_FFBC64-$1000000)).w,((word_FFBC66-$1000000)).w
		move.w  ((word_FFBC68-$1000000)).w,d0
		lea     ((byte_FFB5B1-$1000000)).w,a0
		cmpi.b  #$FF,(a0,d0.w)
		bne.s   loc_9B74
		clr.w   d0
loc_9B74:
		clr.w   d1
		move.b  (a0,d0.w),d1
		addq.w  #1,d0
		move.w  d0,((word_FFBC68-$1000000)).w
		lea     (byte_FF4900).l,a0
		move.w  ((word_FFBC60-$1000000)).w,d0
		mulu.w  d0,d1
		lsl.w   #5,d1
		adda.w  d1,a0
		move.w  ((word_FFBC62-$1000000)).w,d1
		lsl.w   #5,d1           ; Controlling scroll effect of water tiles?
		movea.w d1,a1
		lsl.w   #4,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jmp     (j_EnableDmaQueueProcessing).l
return_9BA8:
		rts

    ; End of function sub_9B4E


; =============== S U B R O U T I N E =======================================

sub_9BAA:
		btst    #INPUT_BIT_START,(P1_INPUT).l
		beq.s   loc_9BBA
		move.w  #$100,d6
		bra.s   loc_9BBC
loc_9BBA:
		clr.w   d6
loc_9BBC:
		jsr     (j_UpdateForegroundHScrollData).l
		jsr     (j_EnableDmaQueueProcessing).l
		rts

    ; End of function sub_9BAA

defined_byte_9BCA:
		dc.b 0
		dc.b $9A
		dc.b $99
		dc.b $99
		dc.b $99
		dc.b 0

; =============== S U B R O U T I N E =======================================

sub_9BD0:
		tst.b   d0
		bne.s   loc_9BF6
		movem.w d0/d2,-(sp)
		moveq   #$38,d0 
		moveq   #-1,d1
		jsr     (sub_37C).l
		move.b  d2,d1
		movem.w (sp)+,d0/d2
		beq.w   loc_9BF6
		andi.w  #$FF,d1
		move.b  defined_byte_9BCA(pc,d1.w),d1
		bra.s   loc_9BFC
loc_9BF6:
		jsr     j_GetMapSpriteForCombatant
loc_9BFC:
		move.w  d1,((CURRENT_OBJECT-$1000000)).w
		move.w  d1,d0
		movea.l (p_pt_MapSprites).l,a0
		lsl.w   #2,d0
		movea.l (a0,d0.w),a0
		jsr     (sub_300).l
		movem.l d7-a1,-(sp)
		lea     (FF3000_LOADING_SPACE).l,a0
		lea     (byte_FF4000).l,a1
		move.w  #$240,d7
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		movea.l (p_pt_MapSprites+8).l,a0
		lsl.w   #2,d0
		movea.l (a0,d0.w),a0
		jsr     (sub_300).l
		movem.l d7-a1,-(sp)
		lea     (FF3000_LOADING_SPACE).l,a0
		lea     (byte_FF4240).l,a1
		move.w  #$240,d7
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		movea.l (p_pt_MapSprites+4).l,a0
		lsl.w   #2,d0
		movea.l (a0,d0.w),a0
		jsr     (sub_300).l
		movem.l d7-a1,-(sp)
		lea     (FF3000_LOADING_SPACE).l,a0
		lea     (byte_FF4480).l,a1
		move.w  #$240,d7
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		lea     (byte_FF4480).l,a0
		moveq   #1,d6
loc_9CA2:
		movea.l a0,a1
		adda.l  #$300,a1
		moveq   #$17,d7
loc_9CAC:
		move.l  (a0)+,d0
		rol.b   #4,d0
		rol.w   #8,d0
		rol.b   #4,d0
		swap    d0
		rol.b   #4,d0
		rol.w   #8,d0
		rol.b   #4,d0
		move.l  d0,(a1)+
		dbf     d7,loc_9CAC

		movea.l a0,a1
		adda.l  #$240,a1
		moveq   #$17,d7
loc_9CCC:
		move.l  (a0)+,d0
		rol.b   #4,d0
		rol.w   #8,d0
		rol.b   #4,d0
		swap    d0
		rol.b   #4,d0
		rol.w   #8,d0
		rol.b   #4,d0
		move.l  d0,(a1)+
		dbf     d7,loc_9CCC

		movea.l a0,a1
loc_9CE4:
		adda.l  #$180,a1
		moveq   #$17,d7
loc_9CEC:
		move.l  (a0)+,d0
		rol.b   #4,d0
		rol.w   #8,d0
		rol.b   #4,d0
		swap    d0
		rol.b   #4,d0
		rol.w   #8,d0
		rol.b   #4,d0
		move.l  d0,(a1)+
		dbf     d7,loc_9CEC
		dbf     d6,loc_9CA2
		rts

    ; End of function sub_9BD0


; =============== S U B R O U T I N E =======================================

sub_9D08:
		clr.b   (FADING_SETTING).l
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,((byte_FFB537-$1000000)).w
		move.b  ((CURSOR_POSITION_X-$1000000)).w,((byte_FFB535-$1000000)).w
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,((byte_FFB536-$1000000)).w
		bsr.w   sub_AB5C
		bcs.w   sub_AAE4
		clr.b   ((AREA_CURSOR_INDEX-$1000000)).w
		clr.b   ((byte_FFB4CB-$1000000)).w
		btst    #INPUT_BIT_A,(CURRENT_PLAYER_INPUT).l
		beq.w   loc_9D8C
		bsr.w   sub_A8C0
		jsr     (j_WaitForVInt).l
		clr.w   d1
		jsr     j_ClearPassabilityFlags
		clr.w   d0
		bsr.w   sub_AB9C
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.b  d0,((ACTOR_BLINKING_TOGGLE-$1000000)).w
		bsr.w   BuildMemberStatusScreen
		jsr     (j_WaitForVInt).l
		move.b  ((byte_FFB537-$1000000)).w,((ACTOR_BLINKING_TOGGLE-$1000000)).w
		move.w  d0,-(sp)
		bsr.w   sub_A8C0
		move.w  (sp)+,d0
		cmpi.w  #$FFFF,d0
		bne.s   loc_9D7C
		rts
loc_9D7C:
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		cmp.b   ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		beq.w   loc_9DC4
		bra.w   loc_9DBE
loc_9D8C:
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		cmp.b   ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		beq.w   loc_9DC4
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   OpenMiniStatusWindow
		bsr.w   sub_DEC0
loc_9DA4:
		jsr     (j_WaitForVInt).l
		tst.b   (CURRENT_PLAYER_INPUT).l
		beq.s   loc_9DA4
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   CloseMiniStatusWindow
		bsr.w   sub_DEE4
loc_9DBE:
		move.w  #$FFFF,d0
		rts
loc_9DC4:
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_9DD8
		bsr.w   OpenMiniStatusWindow
		bsr.w   sub_DEC0
loc_9DD8:
		move.b  #$FF,((ACTOR_BLINKING_TOGGLE-$1000000)).w
		bsr.w   sub_AC86
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_9DFA
		jsr     j_CreateMovementGrid
		moveq   #1,d0
		bsr.w   sub_AB9C
		bra.s   loc_9E00
loc_9DFA:
		jsr     j_MakeMoveEverywhereGrid
loc_9E00:
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   sub_9BD0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.b  d0,((byte_FFB4D3-$1000000)).w
		jsr     (j_WaitForVInt).l
		bsr.w   UpdateBattlefieldSprites
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_9E26
		clr.b   ((SPRITE_DIRECTION-$1000000)).w
loc_9E26:
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d0
		lsl.w   #8,d0
		or.b    ((CURSOR_POSITION_X-$1000000)).w,d0
		move.w  d0,((word_FFC0B2-$1000000)).w
loc_9E34:
		clr.b   ((byte_FFB4D4-$1000000)).w
		bsr.w   sub_8CD4
		jsr     (j_WaitForVInt).l
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d0
		lsl.w   #8,d0
		or.b    ((CURSOR_POSITION_X-$1000000)).w,d0
		cmp.w   ((word_FFC0B2-$1000000)).w,d0
		beq.s   loc_9E5E
		move.w  d0,((word_FFC0B2-$1000000)).w
		bsr.w   ParseBattleExits
		bge.w   loc_9E8A
loc_9E5E:
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_9E70
		btst    #INPUT_BIT_B,(CURRENT_PLAYER_INPUT).l
		bne.w   loc_A026
loc_9E70:
		btst    #INPUT_BIT_C,(CURRENT_PLAYER_INPUT).l
		bne.w   loc_A0DE
		btst    #INPUT_BIT_A,(CURRENT_PLAYER_INPUT).l
		bne.w   loc_A0DE
		bra.s   loc_9E34
loc_9E8A:
		movem.w d3-d4,-(sp)
		clr.b   (FADING_SETTING).l
		clr.w   d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
		movem.w (sp)+,d3-d4
		cmpi.b  #$7F,((CURRENT_MAP_ENTRANCE-$1000000)).w 
		beq.w   byte_9F68
		cmpi.b  #$7E,((CURRENT_MAP_ENTRANCE-$1000000)).w 
		beq.w   byte_9F88
		cmpi.b  #$7D,((CURRENT_MAP_ENTRANCE-$1000000)).w 
		bne.s   loc_9ECC
		moveq   #$25,d0 
		jsr     (j_SetEventFlag).l
		clr.b   ((CURRENT_MAP_ENTRANCE-$1000000)).w
loc_9ECC:
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.w   loc_9F34
		moveq   #PORTRAIT_NOVA,d0
		bsr.w   OpenPortraitWindow
		jsr     (j_OpenMessageWindow).l
		move.w  #SFX_DIALOG_BLEEP_7,((SPEECH_SFX-$1000000)).w
		move.b  ((VICTORY_EXIT-$1000000)).w,d0
		cmp.b   ((CURRENT_MAP_ENTRANCE-$1000000)).w,d0
		bne.s   loc_9EF8        
		move.w  #$1B3,d0        ; "[Hero]! You've reached[Line]your destination, but some[Line]enemies remain.[Wait2][Line]Will you leave them?"
		trap    #DISPLAY_MESSAGE
		bra.s   loc_9EFE
loc_9EF8:
		move.w  #$1B2,d0        ; "[Hero]! Do you really[Line]want to retreat from this[Line]battle?"
		trap    #DISPLAY_MESSAGE
loc_9EFE:
		jsr     (j_YesNoChoiceBox).l
		bsr.w   ClosePortraitWindow
		jsr     (j_CloseMessageWindow).l
		bsr.w   LoadCursorTiles
		tst.b   ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		beq.s   loc_9F34
		move.b  #5,(FADING_SETTING).l
		moveq   #1,d0
		bsr.w   sub_AB9C
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   sub_9BD0
		bra.w   loc_9E5E
loc_9F34:
		move.b  ((VICTORY_EXIT-$1000000)).w,d0
		cmp.b   ((CURRENT_MAP_ENTRANCE-$1000000)).w,d0
		bne.s   loc_9F4E
		clr.w   d0
		move.b  ((CURRENT_MAP_VERSION-$1000000)).w,d0
		addi.w  #$28,d0 
		jsr     (j_SetEventFlag).l
loc_9F4E:
		movea.l (dword_FF0EFE).l,sp
		sndCom  SFX_WARP
		jsr     (j_FadeOutToBlack).l
		clr.l   (VINT_CONTEXTUAL_FUNCTION_ADDRESS).l
		clr.w   d0
		rts
byte_9F68:
		sndCom  SFX_WARP
		jsr     (j_FadeOutToBlack).l
		bsr.w   sub_9FB0
		jsr     (j_FadeInFromBlack).l
		move.b  #2,(FADING_PALETTE_FLAGS).l
		bra.w   loc_9E5E
byte_9F88:
		sndCom  SFX_SPELL_CAST
		jsr     (j_FadeOutToWhite).l
		bsr.w   sub_9FB0
		moveq   #$3C,d0 
		jsr     (j_Sleep).l
		jsr     (j_FadeInFromWhite).l
		move.b  #2,(FADING_PALETTE_FLAGS).l
		bra.w   loc_9E5E

    ; End of function sub_9D08


; =============== S U B R O U T I N E =======================================

sub_9FB0:
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.b  d3,d1
		jsr     j_SetCombatantX
		move.b  d1,((CURSOR_POSITION_X-$1000000)).w
		subq.w  #5,d1
		bge.s   loc_9FC8
		clr.w   d1
loc_9FC8:
		move.w  ((MAP_WIDTH-$1000000)).w,d2
		subi.w  #$B,d2
		cmp.w   d2,d1
		ble.s   loc_9FD6
		move.w  d2,d1
loc_9FD6:
		move.b  d1,((SCREEN_POSITION-$1000000)).w
		move.w  d1,d2
		move.b  d4,d1
		jsr     j_SetCombatantY
		move.b  d1,((CURSOR_POSITION_Y-$1000000)).w
		subq.w  #5,d1
		bge.s   loc_9FEE
		clr.w   d1
loc_9FEE:
		move.w  ((MAP_HEIGHT-$1000000)).w,d2
		subi.w  #$A,d2
		cmp.w   d2,d1
		ble.s   loc_9FFC
		move.w  d2,d1
loc_9FFC:
		move.b  d1,((SCREEN_POSITION+1-$1000000)).w
		bsr.w   UpdateScreenAfterTileChange
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   sub_9BD0
		bsr.w   sub_87AA
		bsr.w   UpdateBattlefieldSprites
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d0
		lsl.w   #8,d0
		or.b    ((CURSOR_POSITION_X-$1000000)).w,d0
		move.w  d0,((word_FFC0B2-$1000000)).w
		rts

    ; End of function sub_9FB0


; START OF FUNCTION CHUNK FOR sub_9D08

loc_A026:
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   CloseMiniStatusWindow
		bsr.w   sub_DEE4
		clr.w   d1
		clr.w   d2
		move.b  ((byte_FFB535-$1000000)).w,d1
		move.b  ((byte_FFB536-$1000000)).w,d2
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		move.b  ((byte_FFB4C5-$1000000)).w,((byte_FFB4D3-$1000000)).w
		movem.w d0-d2,-(sp)
		bsr.w   UpdateBattlefieldSprites
		movem.w (sp)+,d0-d2
		move.b  #$FF,((ACTOR_BLINKING_TOGGLE-$1000000)).w
		movem.w d0-d2,-(sp)
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d1
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d2
		jsr     sub_202D4
		lea     ((byte_FFCB28-$1000000)).w,a0
loc_A074:
		move.b  #1,((byte_FFB4D4-$1000000)).w
		bsr.w   sub_8D66
		move.w  d0,-(sp)
		jsr     (j_WaitForVInt).l
		move.w  (sp)+,d0
		cmpi.b  #3,d0
		bls.s   loc_A074
		movem.w (sp)+,d0-d2
		move.b  #$FF,((byte_FFB4D3-$1000000)).w
		move.b  d1,((CURSOR_POSITION_X-$1000000)).w
		move.b  d2,((CURSOR_POSITION_Y-$1000000)).w
		move.b  d0,((ACTOR_BLINKING_TOGGLE-$1000000)).w
		bsr.w   sub_AB2C
		bsr.w   sub_A8C0
		bsr.w   UpdateBattlefieldSprites
		lea     (byte_FF4000).l,a0
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.w  d0,d7
		lsl.w   #3,d0
		add.w   d7,d0
		add.w   d0,d0
		addi.w  #$100,d0
		lsl.w   #5,d0
		movea.w d0,a1
		move.w  #$120,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		move.w  #$FFFF,d0
		rts
loc_A0DE:
		move.w  #1,d0
		bsr.w   sub_AB40
		beq.w   loc_9E34
		clr.w   d6
		move.b  ((byte_FFB4C5-$1000000)).w,d6
		lsl.w   #4,d6
		lea     ((COMBATANT_DATA-$1000000)).w,a0
		adda.w  d6,a0
		clr.w   d1
		move.b  1(a0),d1
		clr.w   d2
		move.b  2(a0),d2
		clr.w   d3
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d3
		move.b  d3,1(a0)
		clr.w   d4
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d4
		move.b  d4,2(a0)
		bsr.w   UpdateBattlefieldSprites
		bsr.w   sub_A8C0
		clr.b   ((byte_FFB4CA-$1000000)).w
		bsr.w   sub_AB2C
		clr.l   ((CASTER_INDEX-$1000000)).w
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,((CASTER_INDEX-$1000000)).w
loc_A132:
		clr.b   ((AREA_CURSOR_INDEX-$1000000)).w
		move.b  #$FF,((byte_FFB4D3-$1000000)).w
		bsr.w   UpdateBattlefieldSprites
		clr.b   ((byte_FFB4CB-$1000000)).w
		cmpi.b  #ALLY_NOVA,((COMBATANT_1_ENTITY-$1000000)).w
		bne.s   loc_A15C
		clr.b   (FADING_SETTING).l
		jsr     (j_ExecuteMainMenu).l
		bra.w   loc_A17A
loc_A15C:
		clr.b   ((BATTLE_ANIMATION_TYPE-$1000000)).w
		clr.b   ((CURRENT_ATTACK_TYPE-$1000000)).w
		bsr.w   sub_ADA6        
		move.b  #MAIN_MENU,((CURRENT_MENU-$1000000)).w
		bsr.w   sub_BEE0
		cmpi.w  #$FFFF,d0
		bne.w   loc_A19C
loc_A17A:
		clr.w   d1
		clr.w   d2
		move.b  ((byte_FFB535-$1000000)).w,d1
		move.b  ((byte_FFB536-$1000000)).w,d2
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     j_SetCombatantX
		move.w  d2,d1
		jsr     j_SetCombatantY
		bra.w   loc_9DD8
loc_A19C:
		add.w   d0,d0
		move.w  rjt_BattleMenuActions(pc,d0.w),d0
		jmp     rjt_BattleMenuActions(pc,d0.w)

; END OF FUNCTION CHUNK FOR sub_9D08

rjt_BattleMenuActions:
		dc.w BattleMenuAction_Attack-rjt_BattleMenuActions
		dc.w BattleMenuAction_Magic-rjt_BattleMenuActions
		dc.w BattleMenuAction_Item-rjt_BattleMenuActions
		dc.w BattleMenuAction_Stay-rjt_BattleMenuActions

; =============== S U B R O U T I N E =======================================

BattleMenuAction_Attack:
		
		clr.b   ((BATTLE_ACTION_TYPE-$1000000)).w
		bsr.w   sub_AC86
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     j_FindTargetableSpacesForAttack
		moveq   #1,d0
		bsr.w   sub_AB9C
		jsr     j_PopulateTargetsList
		subq.w  #1,((TABLE_AT_FFA8C0-$1000000)).w
		blt.s   loc_A1E4
		bsr.w   sub_A8D4
		cmpi.w  #$FFFF,d0
		beq.s   loc_A1F0
		move.b  d0,((TARGET_INDEX-$1000000)).w
		bra.w   sub_ACD4
loc_A1E4:
		jsr     (j_WaitForVInt).l
		clr.w   d0              ; "No target." refusal text
		bsr.w   sub_D32C        
loc_A1F0:
		bsr.w   sub_A8C0
		bsr.w   sub_AB2C
		jsr     (j_WaitForVInt).l
		bra.w   loc_A132

    ; End of function BattleMenuAction_Attack


; =============== S U B R O U T I N E =======================================

BattleMenuAction_Magic:
		
		move.b  #BATTLE_ACTION_TYPE_CAST_SPELL,((BATTLE_ACTION_TYPE-$1000000)).w
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,((byte_FFB4C9-$1000000)).w
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     j_GetEntitySpellsAddressForCombatant
		cmpi.b  #$FF,(a0)
		bne.s   loc_A22A
		moveq   #1,d0           ; "No magic." refusal text
		bsr.w   sub_D32C        
		bra.w   loc_A132
loc_A22A:
		move.b  #MAGIC_MENU,((CURRENT_MENU-$1000000)).w
		bsr.w   sub_BF10
		cmpi.w  #$FFFF,d0
		bne.s   loc_A24A
		clr.w   d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
		bra.w   loc_A132
loc_A24A:
		move.b  d1,((SPELL_INDEX-$1000000)).w
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     j_GetCurrentMpForCombatant
		move.w  d1,-(sp)
		move.b  ((SPELL_INDEX-$1000000)).w,d1
		jsr     j_GetMPCost
		move.w  (sp)+,d1
		cmp.w   d1,d2
		ble.s   loc_A274
		moveq   #3,d0           ; "Not enough MP." refusal text
		bsr.w   sub_D32C        
		bra.w   loc_A132
loc_A274:
		cmpi.b  #SPELL_EGRESS|LV_1,((SPELL_INDEX-$1000000)).w
		bne.s   loc_A2D0
		bsr.w   sub_AB2C
		clr.w   ((MESSAGE_ARG_NAME_1-$1000000)).w
		move.w  #SPELL_EGRESS|LV_1,((MESSAGE_ARG_NAME_2-$1000000)).w
		moveq   #1,d0
		move.l  d0,((MESSAGE_ARG_NUMBER-$1000000)).w
		trap    #5
		clr.w   ((SPEECH_SFX-$1000000)).w
		move.w  #$1B5,d0        ; "[Name] casts [Spell][Line]level [Num]!"
		trap    #DISPLAY_MESSAGE
		sndCom  SFX_SPELL_CAST
		move.w  #$1EA,d0        ; "[Dict][Line]"
		trap    #DISPLAY_MESSAGE
		tst.b   ((byte_FFB4D7-$1000000)).w
		beq.s   loc_A2CC
		trap    #7
		move.w  #$1D1,d0        ; "But nothing happens."
		trap    #DISPLAY_MESSAGE
		move.w  #$1EA,d0        ; "[Dict][Line]"
		trap    #DISPLAY_MESSAGE
		trap    #6
		clr.w   d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
		bra.w   sub_A656
loc_A2CC:
		bra.w   loc_A306
loc_A2D0:
		jsr     j_PopulateTargetsList
		tst.b   ((TARGETING_GROUP_BITFIELD-$1000000)).w
		beq.w   loc_A306
		subq.w  #1,((TABLE_AT_FFA8C0-$1000000)).w
		blt.w   loc_A1E4
		bsr.w   sub_A8D4
		cmpi.w  #$FFFF,d0
		bne.s   loc_A302
		bsr.w   sub_A8C0
		bsr.w   sub_AB2C
		jsr     (j_WaitForVInt).l
		bra.w   loc_A22A
loc_A302:
		move.b  d0,((TARGET_INDEX-$1000000)).w
loc_A306:
		bra.w   sub_ACD4

    ; End of function BattleMenuAction_Magic


; =============== S U B R O U T I N E =======================================

BattleMenuAction_Item:
		
		tst.b   ((byte_FFB4D7-$1000000)).w
		beq.s   loc_A32C
		clr.b   (FADING_SETTING).l
		jsr     (j_ExecuteItemMenu).l
		bpl.s   return_A32A
		move.b  #5,(FADING_SETTING).l
		bra.w   loc_A132
return_A32A:
		rts
loc_A32C:
		move.b  #BATTLE_ACTION_TYPE_USE_ITEM,((BATTLE_ACTION_TYPE-$1000000)).w
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,((byte_FFB4C9-$1000000)).w
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     j_GetEntityItemsAddressForCombatant
		cmpi.b  #$FF,(a0)
		bne.s   loc_A354
		moveq   #2,d0           ; "No item." refusal text
		bsr.w   sub_D32C        
		bra.w   loc_A132
loc_A354:
		clr.b   ((byte_FFB52A-$1000000)).w
		move.b  #ITEM_MENU,((CURRENT_MENU-$1000000)).w
		bsr.w   sub_BF10
		cmpi.w  #$FFFF,d0
		beq.w   loc_A132
		add.w   d0,d0
		move.w  off_A374(pc,d0.w),d0
		jmp     off_A374(pc,d0.w)

    ; End of function BattleMenuAction_Item

off_A374:       dc.w sub_A37C-off_A374
		dc.w sub_A3EE-off_A374
		dc.w sub_A530-off_A374
		dc.w sub_A5EA-off_A374

; =============== S U B R O U T I N E =======================================

sub_A37C:
		move.b  #1,((byte_FFB52A-$1000000)).w
		move.b  #3,((CURRENT_MENU-$1000000)).w
		bsr.w   sub_BF10
		cmpi.w  #$FFFF,d0
		bne.s   loc_A3A0
		clr.w   d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
		beq.s   loc_A354
loc_A3A0:
		tst.b   ((CANNOT_USE_ITEM_FLAG-$1000000)).w
		beq.s   loc_A3AE
		moveq   #8,d0           ; "You can't use it." refusal text
		bsr.w   sub_D32C        
		bra.s   loc_A354
loc_A3AE:
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,((SPELL_INDEX-$1000000)).w
		jsr     j_PopulateTargetsList
		tst.b   ((TARGETING_GROUP_BITFIELD-$1000000)).w
		beq.w   loc_A3E8
		subq.w  #1,((TABLE_AT_FFA8C0-$1000000)).w
		blt.w   loc_A1E4
		bsr.w   sub_A8D4
		cmpi.w  #$FFFF,d0
		bne.s   loc_A3E4
		bsr.w   sub_A8C0
		bsr.w   sub_AB2C
		jsr     (j_WaitForVInt).l
		bra.s   sub_A37C
loc_A3E4:
		move.b  d0,((TARGET_INDEX-$1000000)).w
loc_A3E8:
		bsr.w   sub_ACD4
		rts

    ; End of function sub_A37C


; =============== S U B R O U T I N E =======================================

sub_A3EE:
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     sub_202CC
		moveq   #1,d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
		jsr     j_PopulateTargetsList
		subq.w  #1,((TABLE_AT_FFA8C0-$1000000)).w
		blt.w   loc_A1E4
		move.b  #3,((CURRENT_MENU-$1000000)).w
		bsr.w   sub_BF10
		cmpi.w  #$FFFF,d0
		bne.s   loc_A432
		clr.w   d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
		bra.w   loc_A354
loc_A432:
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		jsr     j_GetEntityItemsAddressForCombatant
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
		move.b  d1,((byte_FFB4CD-$1000000)).w
		move.b  (a0,d1.w),d1
		move.b  d1,((byte_FFB4CE-$1000000)).w
loc_A44E:
		move.b  #1,((byte_FFB4CC-$1000000)).w
		bsr.w   sub_A8D4
		clr.b   ((byte_FFB4CC-$1000000)).w
		cmpi.w  #$FFFF,d0
		bne.s   loc_A474
		bsr.w   sub_A8C0
		bsr.w   sub_AB2C
		jsr     (j_WaitForVInt).l
		bra.w   sub_A3EE
loc_A474:
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.b  ((byte_FFB4CE-$1000000)).w,d1
		jsr     j_GiveItemForCombatant
		bcc.w   loc_A500
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   CloseMiniStatusWindow
		move.b  ((byte_FFB4C5-$1000000)).w,((byte_FFB4C9-$1000000)).w
		move.b  #1,((byte_FFB4CC-$1000000)).w
		move.b  #3,((CURRENT_MENU-$1000000)).w
		bsr.w   sub_BF10
		clr.b   ((byte_FFB4CC-$1000000)).w
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,((byte_FFB4C9-$1000000)).w
		cmpi.w  #$FFFF,d0
		beq.s   loc_A44E
		move.b  ((byte_FFB4C5-$1000000)).w,d0
loc_A4B8:
		jsr     j_GetEntityItemsAddressForCombatant
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
		move.b  d1,((byte_FFB4CF-$1000000)).w
		move.b  (a0,d1.w),d2
		move.b  d2,((byte_FFB4D0-$1000000)).w
		jsr     j_RemoveItemForCombatant
		move.b  ((byte_FFB4CE-$1000000)).w,d1
		jsr     j_GiveItemForCombatant
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		move.b  ((byte_FFB4CD-$1000000)).w,d1
		jsr     j_RemoveItemForCombatant
		move.b  ((byte_FFB4D0-$1000000)).w,d1
		jsr     j_GiveItemForCombatant
		bsr.w   sub_AAAA
		bra.w   loc_A51A
loc_A500:
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   sub_BEC0
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		move.b  ((byte_FFB4CD-$1000000)).w,d1
		jsr     j_RemoveItemForCombatant
		bsr.w   loc_AA8C
loc_A51A:
		clr.w   d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
loc_A526:
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,((byte_FFB4C5-$1000000)).w
		bra.w   sub_A656

    ; End of function sub_A3EE


; =============== S U B R O U T I N E =======================================

sub_A530:
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,((byte_FFB4C9-$1000000)).w
		move.w  #ITEMTYPE_MASK_WEAPON_OR_RING,d1
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     j_LoadEquippableItemsForCombatant
		bne.s   loc_A552
		moveq   #4,d0           ; "No equippable item." refusal text
		bsr.w   sub_D32C        
		bra.w   loc_A132
loc_A552:
		move.w  #ITEMTYPE_MASK_WEAPON,d1
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
loc_A55C:
		jsr     j_LoadEquippableItemsForCombatant
		beq.w   loc_A58C
		clr.b   ((CURRENT_MENU-$1000000)).w
		bsr.w   sub_D774
		move.w  d0,-(sp)
		clr.w   d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
		move.w  (sp)+,d0
		cmpi.w  #$FFFF,d0
		bne.s   loc_A58C
		bsr.w   sub_D75A
		bra.w   loc_A354
loc_A58C:
		move.w  #ITEMTYPE_MASK_RING,d1
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
loc_A596:
		jsr     j_LoadEquippableItemsForCombatant
		beq.w   loc_A5D6
		move.b  #MAIN_MENU,((CURRENT_MENU-$1000000)).w
		bsr.w   sub_D774
		cmpi.w  #$FFFF,d0
		bne.s   loc_A5D6
		clr.w   d0
loc_A5B2:
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
		move.w  #ITEMTYPE_MASK_WEAPON,d1
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     j_LoadEquippableItemsForCombatant
		bne.s   loc_A552
		bsr.w   sub_D75A
		bra.w   loc_A354
loc_A5D6:
		bsr.w   sub_D75A
		clr.w   d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
		bra.w   loc_A132

    ; End of function sub_A530


; =============== S U B R O U T I N E =======================================

sub_A5EA:
		move.b  #3,((CURRENT_MENU-$1000000)).w
		bsr.w   sub_BF10
		cmpi.w  #$FFFF,d0
		beq.w   loc_A354
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     j_GetEntityItemsAddressForCombatant
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
		move.b  d1,((byte_FFB4CD-$1000000)).w
		move.b  (a0,d1.w),d1
		jsr     j_GetItemType
		btst    #ITEMTYPE_BIT_CANNOT_DROP,d2
		bne.s   loc_A644        
loc_A620:
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
		movem.w d1,-(sp)
		move.b  (a0,d1.w),d1
		jsr     j_IncrementDealsStock
		movem.w (sp)+,d1
		jsr     j_RemoveItemForCombatant
		bra.s   loc_A64C
loc_A644:
		moveq   #7,d0           ; "No! Keep the item." refusal text
		bsr.w   sub_D32C        
		bra.s   sub_A5EA
loc_A64C:
		bra.w   loc_A132

    ; End of function sub_A5EA


; =============== S U B R O U T I N E =======================================

BattleMenuAction_Stay:
		
		jsr     (sub_34C).l

    ; End of function BattleMenuAction_Stay


; =============== S U B R O U T I N E =======================================

sub_A656:
		move.b  #$FF,((byte_FFB537-$1000000)).w
		clr.b   ((byte_FFB4CB-$1000000)).w
		move.b  ((byte_FFB4C5-$1000000)).w,d0
loc_A664:
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_A672
		bsr.w   CloseMiniStatusWindow
		bsr.w   sub_DEE4
loc_A672:
		jsr     (j_WaitForVInt).l
		bsr.w   sub_A8C0
		jsr     (j_WaitForVInt).l
		tst.b   ((byte_FFB4D7-$1000000)).w
		beq.s   loc_A68A
		rts
loc_A68A:
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     j_GetMapSpriteForCombatant
		movea.l (p_pt_MapSprites).l,a0
		lsl.w   #2,d1
		movea.l (a0,d1.w),a0
		jsr     (sub_300).l
		lea     (FF3000_LOADING_SPACE).l,a0
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.w  d0,d7
		lsl.w   #3,d0
		add.w   d7,d0
		add.w   d0,d0
		addi.w  #$100,d0
		lsl.w   #5,d0
		movea.w d0,a1
		move.w  #$120,d0
		moveq   #2,d1
		jmp     (j_ApplyVIntVramDma).l

    ; End of function sub_A656


; =============== S U B R O U T I N E =======================================

sub_A6CE:
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,((byte_FFB537-$1000000)).w
		bsr.w   sub_AB5C
		bcs.w   sub_AAE4
		clr.b   ((AREA_CURSOR_INDEX-$1000000)).w
		clr.b   ((byte_FFB4CB-$1000000)).w
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   OpenMiniStatusWindow
		bsr.w   sub_DEC0
		move.b  #$FF,((ACTOR_BLINKING_TOGGLE-$1000000)).w
		bsr.w   sub_AC86
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     j_CreateMovementGrid
		moveq   #1,d0
		bsr.w   sub_AB9C
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   sub_9BD0
		bsr.w   sub_AB2C
		bsr.w   UpdateBattlefieldSprites
		clr.b   ((BATTLE_ANIMATION_TYPE-$1000000)).w
		clr.b   ((CURRENT_ATTACK_TYPE-$1000000)).w
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     sub_20320
		jsr     (j_WaitForVInt).l
		move.b  ((byte_FFB4C5-$1000000)).w,((byte_FFB4D3-$1000000)).w
		bsr.w   UpdateBattlefieldSprites
		lea     ((byte_FFCB28-$1000000)).w,a0
loc_A744:
		move.b  #1,((byte_FFB4D4-$1000000)).w
		bsr.w   sub_8D6E
		move.w  d0,-(sp)
		moveq   #$A,d0
		jsr     (j_WaitForVInt).l
		move.w  (sp)+,d0
		cmpi.b  #3,d0
		bls.s   loc_A744
		move.b  #$FF,((byte_FFB4D3-$1000000)).w
		bsr.w   sub_AB2C
		bsr.w   UpdateBattlefieldSprites
		clr.w   d6
		move.b  ((byte_FFB4C5-$1000000)).w,d6
		lsl.w   #4,d6
		lea     ((COMBATANT_DATA-$1000000)).w,a0
		adda.w  d6,a0
		clr.w   d1
		move.b  1(a0),d1
		clr.w   d2
		move.b  2(a0),d2
		clr.w   d3
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d3
		move.b  d3,1(a0)
		clr.w   d4
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d4
		move.b  d4,2(a0)
		bsr.w   UpdateBattlefieldSprites
		bsr.w   sub_A8C0
		jsr     (j_WaitForVInt).l
		clr.b   ((byte_FFB4CA-$1000000)).w
		clr.b   ((byte_FFB4CB-$1000000)).w
		cmpi.b  #BATTLE_ACTION_TYPE_3,((BATTLE_ACTION_TYPE-$1000000)).w
		beq.w   sub_A656
		move.b  #$FF,((byte_FFB4D3-$1000000)).w
		bsr.w   UpdateBattlefieldSprites
		bsr.w   sub_AC86
		moveq   #1,d0
		bsr.w   sub_AB9C
		move.b  ((TARGET_INDEX-$1000000)).w,d0
		cmpi.b  #$FF,d0
		blt.w   loc_A8BA
		jsr     (j_WaitForVInt).l
		move.b  #1,((byte_FFB4CB-$1000000)).w
		clr.w   d0
		move.w  d0,d7
		lsl.w   #2,d7
		lea     ((byte_FFA8C2-$1000000)).w,a0
		move.w  (a0,d7.w),d1
		move.w  2(a0,d7.w),d2
		movem.w d0-d2,-(sp)
		lea     (byte_FF4000).l,a0
		movem.w d0-d1,-(sp)
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		jsr     j_GetCombatantX
		move.w  d1,d3
		jsr     j_GetCombatantY
		move.w  d1,d4
		movem.w (sp)+,d0-d1
		clr.w   d6
		cmp.w   d1,d3
		beq.s   loc_A832
		bge.s   loc_A82E
		move.w  #$6C0,d6
		bra.s   loc_A832
loc_A82E:
		move.w  #$480,d6
loc_A832:
		cmp.w   d2,d4
		beq.s   loc_A842
		bge.s   loc_A83E
		move.w  #0,d6
		bra.s   loc_A842
loc_A83E:
		move.w  #$240,d6
loc_A842:
		sub.w   d2,d4
		bge.s   loc_A848
		neg.w   d4
loc_A848:
		move.w  d3,d5
		sub.w   d1,d5
		bge.s   loc_A850
		neg.w   d5
loc_A850:
		cmp.w   d4,d5
		ble.s   loc_A864
		cmp.w   d1,d3
		beq.s   loc_A864
		bge.s   loc_A860
		move.w  #$6C0,d6
		bra.s   loc_A864
loc_A860:
		move.w  #$480,d6
loc_A864:
		adda.w  d6,a0
		clr.w   d0
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		move.w  d0,d7
		lsl.w   #3,d0
		add.w   d7,d0
		add.w   d0,d0
		addi.w  #$100,d0
		lsl.w   #5,d0
		movea.w d0,a1
		move.w  #$120,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		movem.w (sp)+,d0-d2
		lsl.w   #8,d1
		or.w    d2,d1
		move.w  d0,-(sp)
		move.w  d1,d0
		clr.b   ((byte_FFB538-$1000000)).w
		bsr.w   sub_8E52
		bsr.w   sub_AB5C
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   OpenMiniStatusWindow
		tst.b   ((byte_FFB4CC-$1000000)).w
		beq.s   loc_A8B8
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   sub_BE94
loc_A8B8:
		move.w  (sp)+,d0
loc_A8BA:
		bsr.w   sub_ACD4
		rts

    ; End of function sub_A6CE


; =============== S U B R O U T I N E =======================================

sub_A8C0:
		move.b  ((byte_FFB537-$1000000)).w,((ACTOR_BLINKING_TOGGLE-$1000000)).w
		move.b  #1,((byte_FFB539-$1000000)).w
		clr.w   d0
		bsr.w   sub_AB9C
		rts

    ; End of function sub_A8C0


; =============== S U B R O U T I N E =======================================

sub_A8D4:
		jsr     (j_WaitForVInt).l
		move.b  #1,((byte_FFB4CB-$1000000)).w
		clr.w   d0
loc_A8E2:
		move.w  d0,d7
		lsl.w   #2,d7
		lea     ((byte_FFA8C2-$1000000)).w,a0
loc_A8EA:
		move.w  (a0,d7.w),d1
		move.w  2(a0,d7.w),d2
		movem.w d0-d2,-(sp)
		lea     (byte_FF4000).l,a0
		movem.w d0-d1,-(sp)
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		jsr     j_GetCombatantX
		move.w  d1,d3
		jsr     j_GetCombatantY
		move.w  d1,d4
		movem.w (sp)+,d0-d1
		clr.w   d6
		cmp.w   d1,d3
		beq.s   loc_A92A
		bge.s   loc_A926
		move.w  #$6C0,d6
		bra.s   loc_A92A
loc_A926:
		move.w  #$480,d6
loc_A92A:
		cmp.w   d2,d4
		beq.s   loc_A93A
		bge.s   loc_A936
loc_A930:
		move.w  #0,d6
		bra.s   loc_A93A
loc_A936:
		move.w  #$240,d6
loc_A93A:
		sub.w   d2,d4
		bge.s   loc_A940
		neg.w   d4
loc_A940:
		move.w  d3,d5
		sub.w   d1,d5
		bge.s   loc_A948
		neg.w   d5
loc_A948:
		cmp.w   d4,d5
		ble.s   loc_A95C
		cmp.w   d1,d3
		beq.s   loc_A95C
		bge.s   loc_A958
		move.w  #$6C0,d6
		bra.s   loc_A95C
loc_A958:
		move.w  #$480,d6
loc_A95C:
		adda.w  d6,a0
		clr.w   d0
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		move.w  d0,d7
		lsl.w   #3,d0
		add.w   d7,d0
		add.w   d0,d0
		addi.w  #$100,d0
		lsl.w   #5,d0
		movea.w d0,a1
		move.w  #$120,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		movem.w (sp)+,d0-d2
		lsl.w   #8,d1
		or.w    d2,d1
		move.w  d0,-(sp)
		move.w  d1,d0
		clr.b   ((byte_FFB538-$1000000)).w
		bsr.w   sub_8E52
		bsr.w   sub_AB5C
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   OpenMiniStatusWindow
		tst.b   ((byte_FFB4CC-$1000000)).w
		beq.s   loc_A9B0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   sub_BE94
loc_A9B0:
		move.w  (sp)+,d0
loc_A9B2:
		jsr     (j_WaitForVInt).l
		btst    #INPUT_BIT_B,(CURRENT_PLAYER_INPUT).l
		bne.w   byte_AA82
loc_A9C4:
		btst    #INPUT_BIT_C,(CURRENT_PLAYER_INPUT).l
		bne.w   byte_AA76
		btst    #INPUT_BIT_A,(CURRENT_PLAYER_INPUT).l
loc_A9D8:
		bne.w   byte_AA76
		tst.w   ((TABLE_AT_FFA8C0-$1000000)).w
		beq.s   loc_A9B2
		btst    #INPUT_BIT_UP,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_A9FE
		addq.w  #1,d0
		sndCom  SFX_MENU_SELECTION
		cmp.w   ((TABLE_AT_FFA8C0-$1000000)).w,d0
		ble.s   loc_A9FA
		clr.w   d0
loc_A9FA:
		bra.w   loc_AA56
loc_A9FE:
		btst    #INPUT_BIT_RIGHT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_AA1A
		addq.w  #1,d0
		sndCom  SFX_MENU_SELECTION
		cmp.w   ((TABLE_AT_FFA8C0-$1000000)).w,d0
		ble.s   loc_AA16
		clr.w   d0
loc_AA16:
		bra.w   loc_AA56
loc_AA1A:
		btst    #INPUT_BIT_DOWN,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_AA36
		subq.w  #1,d0
		sndCom  SFX_MENU_SELECTION
		tst.w   d0
		bge.s   loc_AA32
		move.w  ((TABLE_AT_FFA8C0-$1000000)).w,d0
loc_AA32:
		bra.w   loc_AA56
loc_AA36:
		btst    #INPUT_BIT_LEFT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_AA52
		subq.w  #1,d0
		sndCom  SFX_MENU_SELECTION
		tst.w   d0
		bge.s   loc_AA4E
		move.w  ((TABLE_AT_FFA8C0-$1000000)).w,d0
loc_AA4E:
		bra.w   loc_AA56
loc_AA52:
		bra.w   loc_A9B2
loc_AA56:
		move.w  d0,-(sp)
		tst.b   ((byte_FFB4CC-$1000000)).w
		beq.s   loc_AA66
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   sub_BEC0
loc_AA66:
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   CloseMiniStatusWindow
		move.w  (sp)+,d0
		bra.w   loc_A8E2
byte_AA76:
		sndCom  SFX_VALIDATION
		clr.w   d0
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		rts
byte_AA82:
		sndCom  SFX_VALIDATION
		move.b  #1,((byte_FFB4CA-$1000000)).w
loc_AA8C:
		clr.w   d0
		tst.b   ((byte_FFB4CC-$1000000)).w
		beq.s   loc_AA9C
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   sub_BEC0
loc_AA9C:
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		bsr.w   CloseMiniStatusWindow
		jsr     (j_WaitForVInt).l

    ; End of function sub_A8D4


; =============== S U B R O U T I N E =======================================

sub_AAAA:
		clr.w   d0
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d0
		move.b  d0,((byte_FFB4C5-$1000000)).w
		jsr     j_GetCombatantX
		lsl.w   #8,d1
		move.w  d1,d6
		jsr     j_GetCombatantY
		or.w    d1,d6
		move.w  d6,d0
		clr.b   ((byte_FFB538-$1000000)).w
		bsr.w   sub_8E52
		move.b  #$FF,((byte_FFB4D3-$1000000)).w
		bsr.w   UpdateBattlefieldSprites
		bsr.w   sub_AB2C
		move.w  #$FFFF,d0
		rts

    ; End of function sub_AAAA


; =============== S U B R O U T I N E =======================================

sub_AAE4:
		bsr.w   sub_AB2C
		clr.b   ((byte_FFB4CA-$1000000)).w
loc_AAEC:
		clr.b   ((CURRENT_MENU-$1000000)).w
		bsr.w   sub_BF10
		tst.w   d0
		bmi.w   loc_AB24
		add.w   d0,d0
		move.w  off_AB08(pc,d0.w),d0
		jsr     off_AB08(pc,d0.w)
		bra.w   loc_AB22

    ; End of function sub_AAE4

off_AB08:       dc.w sub_F63A-off_AB08
		dc.w j_j_optionMenu_Speed-off_AB08
		dc.w j_j_optionMenuAction_Message-off_AB08
		dc.w j_j_optionMenuAction_Quit-off_AB08

; =============== S U B R O U T I N E =======================================

j_j_optionMenu_Speed:
		
		jmp     (j_optionMenu_Speed).l

    ; End of function j_j_optionMenu_Speed


; =============== S U B R O U T I N E =======================================

j_j_optionMenuAction_Message:
		
		jmp     (j_optionMenuAction_Message).l

    ; End of function j_j_optionMenuAction_Message


; =============== S U B R O U T I N E =======================================

j_j_optionMenuAction_Quit:
		
		jmp     (j_optionMenuAction_Quit).l

    ; End of function j_j_optionMenuAction_Quit


; START OF FUNCTION CHUNK FOR sub_AAE4

loc_AB22:
		bmi.s   loc_AAEC
loc_AB24:
		bsr.w   LoadCursorTiles
		moveq   #-1,d0
		rts

; END OF FUNCTION CHUNK FOR sub_AAE4


; =============== S U B R O U T I N E =======================================

sub_AB2C:
		move.w  #1,(SPRITE_03_PROPERTIES).l
		move.l  #$10F3F,(SPRITE_54_PROPERTIES).l  ; Y = 1, size = v4|h4, link = 63
		rts

    ; End of function sub_AB2C


; =============== S U B R O U T I N E =======================================

sub_AB40:
		clr.w   d1
		clr.w   d2
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d1
		mulu.w  ((MAP_WIDTH-$1000000)).w,d1
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d2
		add.w   d2,d1
		lea     ((PASSABILITY_FLAGS-$1000000)).w,a0
		btst    d0,(a0,d1.w)
		rts

    ; End of function sub_AB40


; =============== S U B R O U T I N E =======================================

sub_AB5C:
		lea     ((COMBATANT_DATA-$1000000)).w,a0
		moveq   #$1F,d7
loc_AB62:
		cmpi.b  #$FF,(a0)
		beq.s   loc_AB7C
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d0
		cmp.b   1(a0),d0
		bne.s   loc_AB7C
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d0
		cmp.b   2(a0),d0
		beq.s   loc_AB90
loc_AB7C:
		adda.w  #$10,a0
		dbf     d7,loc_AB62

		move.b  #$FF,((byte_FFB4C5-$1000000)).w
		ori     #1,ccr
		rts
loc_AB90:
		moveq   #$1F,d0
		sub.w   d7,d0
		move.b  d0,((byte_FFB4C5-$1000000)).w
		tst.b   d0
		rts

    ; End of function sub_AB5C


; =============== S U B R O U T I N E =======================================

sub_AB9C:
		move.w  ((MAP_WIDTH-$1000000)).w,d5
		move.w  d5,d6
		add.w   d5,d5
		add.w   d6,d5
		add.w   d5,d5  ; multiply by 6
		subq.w  #4,d5
		lea     (MAP_SPRITE_POSITION).l,a1
		move.w  #$11FF,d7
loc_ABB4:
		andi.l  #$9FFF9FFF,(a1)+
		dbf     d7,loc_ABB4

		lea     ((PASSABILITY_FLAGS-$1000000)).w,a0
		lea     (MAP_SPRITE_POSITION).l,a1
		move.w  ((MAP_HEIGHT-$1000000)).w,d7
		subq.w  #1,d7
		move.w  ((MAP_WIDTH-$1000000)).w,d4
		move.w  d4,d1
		add.w   d4,d4
		add.w   d1,d4
		lsl.w   #2,d4
loc_ABDA:
		move.w  ((MAP_WIDTH-$1000000)).w,d6
		subq.w  #1,d6
loc_ABE0:
		move.b  (a0)+,d1
		move.w  d0,d3
		add.w   d3,d3
		move.w  off_ABEE(pc,d3.w),d3
		jmp     off_ABEE(pc,d3.w)

    ; End of function sub_AB9C

off_ABEE:       dc.w loc_AC62-off_ABEE
		dc.w sub_ABF6-off_ABEE
		dc.w sub_AC44-off_ABEE
		dc.w sub_AC44-off_ABEE

; =============== S U B R O U T I N E =======================================

sub_ABF6:
		btst    #0,d1
		beq.s   loc_AC40
		move.l  a1,-(sp)
		andi.l  #$9FFF9FFF,(a1)
		ori.l   #$20002000,(a1)+
		andi.w  #$9FFF,(a1)
		ori.w   #$2000,(a1)
		adda.w  d5,a1
		andi.l  #$9FFF9FFF,(a1)
loc_AC1A:
		ori.l   #$20002000,(a1)+
		andi.w  #$9FFF,(a1)
		ori.w   #$2000,(a1)
		adda.w  d5,a1
		andi.l  #$9FFF9FFF,(a1)
		ori.l   #$20002000,(a1)+
		andi.w  #$9FFF,(a1)
		ori.w   #$2000,(a1)
		movea.l (sp)+,a1
loc_AC40:
		bra.w   loc_AC62

    ; End of function sub_ABF6


; =============== S U B R O U T I N E =======================================

sub_AC44:
		btst    #0,d1
		bne.s   loc_AC5E
		move.l  a1,-(sp)
		clr.l   (a1)+
		clr.w   (a1)
		adda.w  d5,a1
		clr.l   (a1)+
		clr.w   (a1)
		adda.w  d5,a1
		clr.l   (a1)+
		clr.w   (a1)
		movea.l (sp)+,a1
loc_AC5E:
		bra.w   *+4

    ; End of function sub_AC44


; START OF FUNCTION CHUNK FOR sub_ABF6

loc_AC62:
		addq.w  #6,a1
		dbf     d6,loc_ABE0

		adda.w  d4,a1
		dbf     d7,loc_ABDA

		add.w   d0,d0
		move.w  off_AC78(pc,d0.w),d0
		jmp     off_AC78(pc,d0.w)

; END OF FUNCTION CHUNK FOR sub_ABF6

off_AC78:       dc.w j_UpdateScreenAfterTileChange-off_AC78
		dc.w j_UpdateScreenAfterTileChange-off_AC78
		dc.w j_UpdateScreenAfterTileChange-off_AC78
		dc.w j_UpdateScreenAfterTileChange-off_AC78

; =============== S U B R O U T I N E =======================================

j_UpdateScreenAfterTileChange:
		
		bra.w   UpdateScreenAfterTileChange

    ; End of function j_UpdateScreenAfterTileChange

		rts

; =============== S U B R O U T I N E =======================================

sub_AC86:
		lea     (PALETTE_2_BASE).l,a0
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a0)+
		jsr     (j_WaitForVInt).l
		move.b  #5,(FADING_SETTING).l
		clr.b   (FADING_POINTER).l
		move.b  (FADING_COUNTER_MAX).l,(FADING_COUNTER).l
loc_ACCA:
		move.b  #2,(FADING_PALETTE_FLAGS).l
		rts

    ; End of function sub_AC86


; =============== S U B R O U T I N E =======================================

sub_ACD4:
		lea     ((BATTLE_SCENE_ACTORS-$1000000)).w,a6
		jsr     j_SetupBattleaction
		jmp     sub_124000

    ; End of function sub_ACD4


; =============== S U B R O U T I N E =======================================

; Check if boss dead

CheckBattleEnd:
		
		clr.w   d2
		clr.w   d3
		moveq   #$1F,d7         ; combatants counter
		clr.w   d0
loc_ACEC:
		jsr     j_GetEntity
		cmpi.w  #$FFFF,d1
		beq.w   loc_AD06
		btst    #7,d1
		bne.s   loc_AD04
		addq.w  #1,d2
		bra.s   loc_AD06
loc_AD04:
		addq.w  #1,d3
loc_AD06:
		addq.w  #1,d0
		dbf     d7,loc_ACEC

		clr.w   d0
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_AD24
		tst.w   d3
		bne.s   loc_AD24
		jsr     j_ResetForceMemberStats
		moveq   #1,d0
		move.b  d0,((byte_FFB4D7-$1000000)).w
loc_AD24:
		move.w  d0,-(sp)
		clr.w   d0
		jsr     j_GetCurrentHpForCombatant
		move.w  (sp)+,d0
		tst.w   d1              ; check if hero dead
		bne.s   loc_AD36
		moveq   #2,d0
loc_AD36:
		moveq   #$FFFFFFFF,d1
		rts

    ; End of function CheckBattleEnd


; =============== S U B R O U T I N E =======================================

ParseBattleExits:
		
		tst.b   ((byte_FFB4C5-$1000000)).w
		bne.w   loc_AD9C
loc_AD42:
		move.b  ((CURRENT_REGION-$1000000)).w,d0
		bpl.s   loc_AD54
		cmpi.w  #$21A,((CURSOR_POSITION_X-$1000000)).w
		bne.s   loc_AD54
		moveq   #1,d0
		rts
loc_AD54:
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d1
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d2
		movea.l (p_pt_BattleExits).l,a0
		clr.w   d7
		move.b  ((CURRENT_CHAPTER-$1000000)).w,d7
		subq.w  #1,d7
		lsl.w   #2,d7
		movea.l (a0,d7.w),a0    ; get battle exits for current chapter
		clr.w   d3
loc_AD72:
		tst.b   (a0)
		bmi.w   loc_AD9C
		cmp.b   (a0),d0         ; compare to current region
		bne.s   loc_AD98
		cmp.b   1(a0),d1        ; compare to current X position
		bne.s   loc_AD98
		cmp.b   2(a0),d2        ; compare to current Y position
		bne.s   loc_AD98
		clr.w   d0
		move.b  3(a0),d0        ; get destination map index
		move.b  5(a0),d3
		move.b  6(a0),d4
		bra.s   loc_ADA0
loc_AD98:
		addq.l  #4,a0
		bra.s   loc_AD72
loc_AD9C:
		moveq   #-1,d0
		rts
loc_ADA0:
		move.b  d0,((CURRENT_MAP_ENTRANCE-$1000000)).w
		rts

    ; End of function ParseBattleExits


; =============== S U B R O U T I N E =======================================

; Wrapper for ADEO, loads position and calls ADB8

sub_ADA6:
		move.b  ((CURRENT_REGION-$1000000)).w,d0
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d1
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d2
		bsr.s   sub_ADB8        
		bra.w   loc_ADE0

    ; End of function sub_ADA6


; =============== S U B R O U T I N E =======================================

; Get coordinates of tile sprite is facing D1,D2

sub_ADB8:
		clr.w   d3
		move.b  ((SPRITE_DIRECTION-$1000000)).w,d3
		add.w   d3,d3
		move.w  off_ADC8(pc,d3.w),d3
		jmp     off_ADC8(pc,d3.w)

    ; End of function sub_ADB8

off_ADC8:       dc.w sub_ADD4-off_ADC8
		dc.w sub_ADD8-off_ADC8
		dc.w sub_ADD0-off_ADC8
		dc.w sub_ADDC-off_ADC8

; =============== S U B R O U T I N E =======================================

sub_ADD0:
		subq.b  #1,d2
		rts

    ; End of function sub_ADD0


; =============== S U B R O U T I N E =======================================

sub_ADD4:
		addq.b  #1,d2
		rts

    ; End of function sub_ADD4


; =============== S U B R O U T I N E =======================================

sub_ADD8:
		subq.b  #1,d1
		rts

    ; End of function sub_ADD8


; =============== S U B R O U T I N E =======================================

sub_ADDC:
		addq.b  #1,d1
		rts

    ; End of function sub_ADDC


; START OF FUNCTION CHUNK FOR sub_ADA6

loc_ADE0:
		tst.b   ((byte_FFB4D7-$1000000)).w
		bne.s   loc_ADEC
		clr.b   ((byte_FFB4D5-$1000000)).w
		bra.s   loc_ADF2
loc_ADEC:
		move.b  #1,((byte_FFB4D5-$1000000)).w
loc_ADF2:
		clr.w   d7
		move.b  ((CURRENT_CHAPTER-$1000000)).w,d7
		subq.w  #1,d7
		lsl.w   #7,d7
		movea.l (p_BattleChests).l,a0
		adda.w  d7,a0
		move.w  #$1F,d7
		clr.w   d3
loc_AE0A:
		cmp.b   (a0),d0
		bne.s   loc_AE2A
		cmp.b   1(a0),d1
		bne.s   loc_AE2A
		cmp.b   2(a0),d2
		bne.s   loc_AE2A
		bset    #0,((byte_FFB4D5-$1000000)).w
		move.w  d3,d0
		clr.w   d3
		move.b  3(a0),d3
		bra.s   return_AE34
loc_AE2A:
		addq.w  #1,d3
		addq.l  #4,a0
		dbf     d7,loc_AE0A

		moveq   #-1,d0
return_AE34:
		rts

; END OF FUNCTION CHUNK FOR sub_ADA6


; =============== S U B R O U T I N E =======================================

MoveWindowWithSfx:
		
		 
		sndCom  SFX_MENU_SWITCH

    ; End of function MoveWindowWithSfx


; =============== S U B R O U T I N E =======================================

; In: D0 = size WWHH
;     D1 = origin/destination XXYYXXYY
;     D2 = animation frames length

MoveWindow:
		movem.l d0-d2/a0,-(sp)
		swap    d1              ; swap initial window position into low-order word
		bsr.w   CreateWindow    
		bsr.w   sub_AF66
		jsr     (j_WaitForVInt).l
		movem.l (sp)+,d0-d2/a0
		move.w  d2,d3
		subq.w  #1,d2
@Loop:
		bsr.w   sub_AF84
		movem.l d0-d3/a0,-(sp)
		move.w  d3,d7
		sub.w   d2,d7
		move.w  d1,d4           ; D4 = initial window position
		swap    d1              ; swap destination window position into low-order word
		movem.w d1/d4,-(sp)
		ext.w   d1
		ext.w   d4
		sub.w   d1,d4
		muls.w  d7,d4
		divs.w  d3,d4
		add.w   d1,d4
		movem.w (sp)+,d1/d5
		asr.w   #8,d1
		asr.w   #8,d5
		sub.w   d1,d5
		muls.w  d7,d5
		divs.w  d3,d5
		add.w   d1,d5
		lsl.w   #8,d5
		andi.w  #$FF,d4
		or.w    d5,d4
		move.w  d4,d1
		bsr.w   CreateWindow    
		bsr.w   sub_AF70
		jsr     (j_WaitForVInt).l
		movem.l (sp)+,d0-d3/a0
		dbf     d2,@Loop
return_AEA6:
		rts

    ; End of function MoveWindow


; =============== S U B R O U T I N E =======================================

; In: A0 = layout, D0 = size WWHH, D1 = position XXYY

CreateWindow:
		move.w  d0,((WINDOW_SIZE-$1000000)).w
		move.w  d1,((WINDOW_POSITION-$1000000)).w
		tst.b   ((DONT_SEND_SOUND_COMMANDS-$1000000)).w
		bne.s   return_AEA6
		move.w  d0,-(sp)        ; push window size
		lea     (PLANE_A_MAP_LAYOUT).l,a1
		move.w  d1,-(sp)        ; push window position
		andi.w  #$FF00,d1
		asr.w   #7,d1           ; D1 = X postion * 2
		move.w  (sp)+,d0        ; pull window position -> D0
		ext.w   d0              ; D0 = Y position
		btst    #0,(VDP_REG10_VALUE).l
		beq.w   loc_AF22        
		asl.w   #7,d0           ; D0 = Y position * 128
		move.w  #$80,d2 
		add.w   d0,d1
		adda.w  d1,a1
		move.w  (sp)+,d6        ; pull window size -> D6
		move.w  d6,d7
		andi.w  #$FF,d7         ; D7 = height
		lsr.w   #8,d6           ; D6 = width
		sub.w   d6,d2
		sub.w   d6,d2
		subq.w  #1,d6
		subq.w  #1,d7
loc_AEF2:
		move.w  d6,-(sp)        ; push width-1
loc_AEF4:
		move.l  a1,d0
		btst    #6,d0
		bne.s   loc_AF1C
		btst    #$C,d0
		beq.s   loc_AF1C
		move.w  (a0)+,(a1)+
loc_AF04:
		dbf     d6,loc_AEF4

		move.w  (sp)+,d6        ; pull width-1 -> D6
		adda.w  d2,a1
		dbf     d7,loc_AEF2    

		lea     ($C000).l,a1
		move.w  #$780,d0
		rts
loc_AF1C:
		addq.l  #2,a0
		addq.l  #2,a1
		bra.s   loc_AF04
loc_AF22:
		asl.w   #6,d0           ; D0 = Y position * 64
		moveq   #$40,d2 
		add.w   d0,d1
		adda.w  d1,a1
		move.w  (sp)+,d6        ; pull window size -> D6
		move.w  d6,d7
		andi.w  #$FF,d7         ; D7 = height
		lsr.w   #8,d6           ; D6 = width
		sub.w   d6,d2
		sub.w   d6,d2
		subq.w  #1,d6
		subq.w  #1,d7
loc_AF3C:
		move.w  d6,-(sp)        ; push width-1
loc_AF3E:
		move.l  a1,d0
		btst    #$B,d0
		bne.s   loc_AF60
		move.w  (a0)+,(a1)+
loc_AF48:
		dbf     d6,loc_AF3E

		move.w  (sp)+,d6        ; pull width-1 -> D6
		adda.w  d2,a1
		dbf     d7,loc_AF3C    

		lea     ($E000).l,a1
		move.w  #$3C0,d0
		rts
loc_AF60:
		addq.l  #2,a0
		addq.l  #2,a1
		bra.s   loc_AF48

    ; End of function CreateWindow


; =============== S U B R O U T I N E =======================================

sub_AF66:
		lea     ($C000).l,a1
		move.w  #$780,d0

    ; End of function sub_AF66


; =============== S U B R O U T I N E =======================================

sub_AF70:
		lea     (PLANE_A_MAP_LAYOUT).l,a0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jmp     (j_EnableDmaQueueProcessing).l

    ; End of function sub_AF70


; =============== S U B R O U T I N E =======================================

sub_AF84:
		movem.l d0-a1,-(sp)
		move.w  ((WINDOW_SIZE-$1000000)).w,d0
		move.w  ((WINDOW_POSITION-$1000000)).w,d1
		move.w  d0,-(sp)        ; push window size
		lea     (PLANE_A_MAP_LAYOUT).l,a1
		move.w  d1,-(sp)        ; push window position
		andi.w  #$FF00,d1
		asr.w   #7,d1           ; D1 = X postion * 2
		move.w  (sp)+,d0        ; pull window position -> D0
		ext.w   d0              ; D0 = Y position
		btst    #0,(VDP_REG10_VALUE).l
		beq.w   loc_AFF4        
		asl.w   #7,d0           ; D0 = Y position * 128
		move.w  #$80,d2 
		add.w   d0,d1
		adda.w  d1,a1
		move.w  (sp)+,d6        ; pull window size -> D6
		move.w  d6,d7
		andi.w  #$FF,d7         ; D7 = height
		lsr.w   #8,d6           ; D6 = width
		sub.w   d6,d2
		sub.w   d6,d2
		subq.w  #1,d6
		subq.w  #1,d7
loc_AFCC:
		move.w  d6,-(sp)        ; push width-1
loc_AFCE:
		move.l  a1,d0
		btst    #6,d0
		bne.s   loc_AFF0
loc_AFD6:
		btst    #$C,d0
		beq.s   loc_AFF0
		clr.w   (a1)+
loc_AFDE:
		dbf     d6,loc_AFCE

		move.w  (sp)+,d6        ; pull width-1 -> D6
		adda.w  d2,a1
		dbf     d7,loc_AFCC    

		movem.l (sp)+,d0-a1
		rts
loc_AFF0:
		addq.l  #2,a1
		bra.s   loc_AFDE
loc_AFF4:
		asl.w   #6,d0           ; D0 = Y position * 64
		moveq   #$40,d2 
		add.w   d0,d1
		adda.w  d1,a1
		move.w  (sp)+,d6        ; pull window size -> D6
		move.w  d6,d7
		andi.w  #$FF,d7         ; D7 = height
		lsr.w   #8,d6           ; D6 = width
		sub.w   d6,d2
		sub.w   d6,d2
		subq.w  #1,d6
		subq.w  #1,d7
loc_B00E:
		move.w  d6,-(sp)        ; push width-1
loc_B010:
		move.l  a1,d0
		btst    #$B,d0
		bne.s   loc_B02C
		clr.w   (a1)+
loc_B01A:
		dbf     d6,loc_B010

		move.w  (sp)+,d6        ; pull width-1 -> D6
		adda.w  d2,a1
		dbf     d7,loc_B00E    

		movem.l (sp)+,d0-a1
		rts
loc_B02C:
		addq.l  #2,a1
		bra.s   loc_B01A

    ; End of function sub_AF84


; =============== S U B R O U T I N E =======================================

; Clear window properties?

sub_B030:
		lea     (PLANE_A_MAP_LAYOUT).l,a0
loc_B036:
		move.w  #$3FF,d0
loc_B03A:
		clr.l   (a0)+
		dbf     d0,loc_B03A
		rts

    ; End of function sub_B030


; =============== S U B R O U T I N E =======================================

; Write tiles from number D0 into A1 : D7 letters, window width D1

WriteTilesFromNumber:
		
		jsr     (j_WriteAsciiNumber).l
		lea     (LOADED_NUMBER).l,a0
		moveq   #$A,d0
		sub.w   d7,d0
		adda.w  d0,a0

    ; End of function WriteTilesFromNumber


; =============== S U B R O U T I N E =======================================

; Write tiles from ASCII at A0 to A1 : D7 letters, window width D1

WriteTilesFromAscii:
		
		move.l  a2,-(sp)
		movea.l a1,a2
		subq.w  #1,d7
loc_B05A:
		clr.w   d0
		move.b  (a0)+,d0
		beq.w   loc_B08E
		ori.w   #VDPTILE_PALETTE3|VDPTILE_PRIORITY_BIT,d0
		cmpi.b  #9,d0
		beq.s   loc_B084
		move.w  d0,(a1)+
		bra.s   loc_B08A
		move.w  (a1,d1.w),d2
		cmpi.b  #$61,d2 
		bne.s   loc_B07E
		subi.w  #$3C,d0 
loc_B07E:
		move.w  d0,(a1,d1.w)
		bra.s   loc_B08A
loc_B084:
		movea.l a2,a1
		suba.w  d1,a1
		movea.l a1,a2
loc_B08A:
		dbf     d7,loc_B05A
loc_B08E:
		movea.l (sp)+,a2
		rts

    ; End of function WriteTilesFromAscii


; =============== S U B R O U T I N E =======================================

sub_B092:
		movem.l d0-a6,-(sp)
		sndCom  SOUND_COMMAND_254
		jsr     (j_WaitForVInt).l
		jsr     (j_WaitForVInt).l
		jsr     (j_WaitForVInt).l
		jsr     (j_DisableDisplayAndInterrupts).l
		movem.l (sp)+,d0-a6
		rts

    ; End of function sub_B092


; =============== S U B R O U T I N E =======================================

BuildMemberStatusScreen:
		
		jsr     j_LoadCombatantData
		sndCom  SFX_VALIDATION
		andi.w  #$FF,d0
		move.w  d0,((CURRENT_OBJECT-$1000000)).w
		bsr.w   sub_B4A6
		bsr.w   sub_B87A
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetPortraitForCombatant
		cmpi.w  #$FFFF,d1
		beq.s   loc_B0EA
		move.w  d1,d0
		jsr     LoadPortrait    
loc_B0EA:
		bsr.w   sub_B926
		move.w  (SPRITE_54_PROPERTIES).l,d0
		subi.w  #$7C,d0 
		move.b  d0,((byte_FFB521-$1000000)).w
		move.b  d0,((TARGET_Y-$1000000)).w
		move.w  (SPRITE_54_X).l,d0
		subi.w  #$7C,d0 
		move.b  d0,((byte_FFB520-$1000000)).w
		move.b  d0,((TARGET_X-$1000000)).w
		move.l  #$187C0800,((byte_FFB522-$1000000)).w
		move.l  #sub_B4F8,(VINT_CONTEXTUAL_FUNCTION_ADDRESS).l
		bsr.w   BuildMemberStatusWindow
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$161A,d0
		move.l  #$1F010901,d1
		move.w  #8,d2
		bsr.w   MoveWindowWithSfx
		bsr.w   sub_B46E
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetPortraitForCombatant
		cmpi.w  #$FFFF,d1
		beq.s   loc_B168
		lea     ((byte_FFB58C-$1000000)).w,a0
		lea     (PALETTE_1_CURRENT).l,a1
		jsr     (j_CopyPalette).l
		jsr     (j_ApplyVIntCramDma).l
loc_B168:
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetEntity
		btst    #7,d1
		bne.s   loc_B1BA
		movem.l d7-a1,-(sp)
		lea     wl_StatusGold(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$40,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		jsr     j_GetGold
		move.l  d1,d0
		lea     ((byte_FFB7FC-$1000000)).w,a1
		moveq   #6,d7
		bsr.w   WriteTilesFromNumber
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$804,d0
		move.l  #$11B0117,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
loc_B1BA:
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetPortraitForCombatant
		cmpi.w  #$FFFF,d1
		beq.s   loc_B1CE
		bsr.w   sub_E1B4
loc_B1CE:
		jsr     (j_WaitForPlayer1NewInput).l
		clr.b   ((IS_DISPLAYING_PORTRAIT-$1000000)).w
		btst    #INPUT_BIT_B,(CURRENT_PLAYER_INPUT).l
		bne.s   loc_B1E6
		clr.w   d0
		bra.s   loc_B1E8
loc_B1E6:
		moveq   #-1,d0
loc_B1E8:
		move.w  d0,-(sp)
		move.w  ((byte_FFB520-$1000000)).w,d0
		move.w  ((byte_FFB522-$1000000)).w,((byte_FFB520-$1000000)).w
		move.w  d0,((byte_FFB522-$1000000)).w
		move.w  #$1000,((byte_FFB524-$1000000)).w
		move.l  #sub_B4F8,(VINT_CONTEXTUAL_FUNCTION_ADDRESS).l
		movem.l d7-a1,-(sp)
		lea     wl_StatusMain(pc), a0
loc_B210:
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
loc_B214:
		move.w  #$478,d7
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		bsr.w   WriteMemberStatusWindowNameAndStats
		bsr.w   WriteMemberStatusWindowSpellsAndItems
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$161A,d0
		move.l  #$901E001,d1
		move.w  #8,d2
		bsr.w   MoveWindowWithSfx
		lea     (PALETTE_1_CURRENT).l,a1
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		jsr     (j_ApplyVIntCramDma).l
		bsr.w   UpdateScreenAfterTileChange
		bsr.w   sub_B900
		bsr.w   UpdateBattlefieldSprites
		bsr.w   sub_B030        
		bsr.w   sub_AF66
		move.w  (sp)+,d0
		rts

    ; End of function BuildMemberStatusScreen


; =============== S U B R O U T I N E =======================================

BuildMemberStatusWindow:
		
		movem.l d7-a1,-(sp)
		lea     wl_StatusMain(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$478,d7
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		bsr.w   WriteMemberStatusWindowNameAndStats
		bsr.w   WriteMemberStatusWindowSpellsAndItems
		bsr.w   WriteMemberStatusWindowIcons
		rts

    ; End of function BuildMemberStatusWindow


; =============== S U B R O U T I N E =======================================

WriteStatusEffectTiles:
		
		move.l  d0,(a0)
		subq.l  #4,a0
		cmpi.w  #VDPTILE_ASCII_SPACE|VDPTILE_PALETTE3|VDPTILE_PRIORITY_BIT,(a0)
		beq.s   @Return
		lea     ((byte_FFB84C-$1000000)).w,a0
@Return:
		rts

    ; End of function WriteStatusEffectTiles


; =============== S U B R O U T I N E =======================================

WriteMemberStatusWindowNameAndStats:
		
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetClassForCombatant
		jsr     j_GetClassNameAddress
		lea     ((byte_FFB808-$1000000)).w,a1
		move.w  d1,d7
		moveq   #-44,d1
		bsr.w   WriteTilesFromAscii
		                
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetEntityStatsAddressForCombatant
		addq.w  #2,a1
		moveq   #-44,d1
		moveq   #10,d7
		bsr.w   WriteTilesFromAscii
		                
		lea     ((byte_FFB82C-$1000000)).w,a0
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetStatusEffectsForCombatant
		btst    #STATUSEFFECT_BIT_CURSE,d1
		beq.s   loc_B2F8
		move.l  #VDPTILES_STATUSEFFECT_CURSE,d0
		bsr.s   WriteStatusEffectTiles
loc_B2F8:
		btst    #STATUSEFFECT_BIT_POISON,d1
		beq.s   loc_B306
		move.l  #VDPTILES_STATUSEFFECT_POISON,d0
		bsr.s   WriteStatusEffectTiles
loc_B306:
		btst    #STATUSEFFECT_BIT_MUDDLE,d1
		beq.s   loc_B314
		move.l  #VDPTILES_STATUSEFFECT_MUDDLE,d0
		bsr.s   WriteStatusEffectTiles
loc_B314:
		btst    #STATUSEFFECT_BIT_DISPEL,d1
		beq.s   loc_B324
		move.l  #VDPTILES_STATUSEFFECT_DISPEL,d0
		bsr.w   WriteStatusEffectTiles
loc_B324:
		btst    #STATUSEFFECT_BIT_SLEEP,d1
		beq.s   loc_B334
		move.l  #VDPTILES_STATUSEFFECT_SLEEP,d0
		bsr.w   WriteStatusEffectTiles
loc_B334:
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetCurrentHpForCombatant
		cmpi.w  #100,d1
		bge.s   loc_B352
		lea     ((byte_FFB8C0-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
loc_B352:
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetMaxHpForCombatant
		cmpi.w  #100,d1
		bge.s   loc_B372
		lea     ((byte_FFB8C4-$1000000)).w,a1
		addq.w  #2,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
loc_B372:
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetCurrentMpForCombatant
		cmpi.w  #100,d1
		bge.s   loc_B390
		lea     ((byte_FFB918-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
loc_B390:
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetMaxMpForCombatant
		cmpi.w  #100,d1
		bge.s   loc_B3B0
		lea     ((byte_FFB91C-$1000000)).w,a1
		addq.w  #2,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
loc_B3B0:
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetEntity
		tst.b   d1
		blt.s   loc_B3EC        ; write "N/A" if enemy
		jsr     j_GetLevelForCombatant
		lea     ((byte_FFB86E-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetExperienceForCombatant
		lea     ((byte_FFB976-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
		bra.s   loc_B408
loc_B3EC:
		lea     aNA(pc), a0
		lea     ((byte_FFB86C-$1000000)).w,a1
		moveq   #3,d7
		bsr.w   WriteTilesFromAscii
		lea     aNA(pc), a0
		lea     ((byte_FFB974-$1000000)).w,a1
		moveq   #3,d7
		bsr.w   WriteTilesFromAscii
loc_B408:
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetModifiedAttack
		lea     ((byte_FFB884-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetModifiedDefense
		lea     ((byte_FFB8DC-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetModifiedMove
		lea     ((byte_FFB934-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetModifiedAgility
		lea     ((byte_FFB98C-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
		rts

    ; End of function WriteMemberStatusWindowNameAndStats

aNA:    dc.b 'N/A '

; =============== S U B R O U T I N E =======================================

sub_B46E:
		lea     (byte_FFE000).l,a0
		move.w  #2431,d0
loc_B478:
		move.w  (a0)+,d1
		andi.w  #$6000,d1
		bne.s   loc_B484
		clr.w   -2(a0)
loc_B484:
		dbf     d0,loc_B478

		lea     (byte_FFE000).l,a0
loc_B48E:
		lea     ($E000).l,a1
		move.w  #$800,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jmp     (j_WaitForDmaQueueProcessing).l

    ; End of function sub_B46E


; =============== S U B R O U T I N E =======================================

sub_B4A6:
		lea     (SPRITE_22_PROPERTIES).l,a0
		lea     ((byte_FFB52B-$1000000)).w,a1
		moveq   #$1F,d0
		move.w  $100(a0),d1
		addi.l  #$1C,d1
		move.w  $106(a0),d2
		addi.l  #$1C,d2
loc_B4C6:
		move.w  (a0),d3
		move.w  6(a0),d4
		sub.w   d1,d3
		bgt.s   loc_B4E8
		cmpi.w  #$FFC8,d3
		blt.s   loc_B4E8
		sub.w   d2,d4
		bgt.s   loc_B4E8
		cmpi.w  #$FFD0,d4
		blt.s   loc_B4E8
		moveq   #$1F,d3
		sub.w   d0,d3
		move.b  d3,(a1)+
		bra.s   loc_B4EC
loc_B4E8:
		move.w  #1,(a0)
loc_B4EC:
		addq.l  #8,a0
		dbf     d0,loc_B4C6

		move.b  #$FF,(a1)
		rts

    ; End of function sub_B4A6


; =============== S U B R O U T I N E =======================================

sub_B4F8:
		clr.w   d0
		move.b  ((byte_FFB520-$1000000)).w,d0
		clr.w   d1
		move.b  ((byte_FFB521-$1000000)).w,d1
		clr.w   d2
		move.b  ((byte_FFB522-$1000000)).w,d2
		clr.w   d3
		move.b  ((byte_FFB523-$1000000)).w,d3
		clr.w   d4
		move.b  ((byte_FFB524-$1000000)).w,d4
		clr.w   d5
		move.b  ((byte_FFB525-$1000000)).w,d5
		sub.w   d0,d2
		muls.w  d5,d2
		divs.w  d4,d2
		add.w   d2,d0
		sub.w   d1,d3
		muls.w  d5,d3
		divs.w  d4,d3
		add.w   d3,d1
		lea     (SPRITE_54_PROPERTIES).l,a0
		move.w  d1,(a0)
		addi.w  #$7C,(a0) 
		move.w  d0,6(a0)
		addi.w  #$7C,6(a0) 
		lea     (SPRITE_22_PROPERTIES).l,a0
		lea     ((byte_FFB52B-$1000000)).w,a1
		lea     ((COMBATANT_DATA-$1000000)).w,a2
		clr.w   d6
		move.b  ((ACTOR_BLINKING_TOGGLE-$1000000)).w,d6
		lsl.w   #4,d6
		clr.w   d2
		move.b  1(a2,d6.w),d2
		clr.w   d3
		move.b  2(a2,d6.w),d3
loc_B564:
		clr.w   d7
		move.b  (a1)+,d7
		cmpi.b  #$FF,d7
		beq.s   loc_B5B0
		movem.w d4-d5,-(sp)
		lsl.w   #4,d7
		clr.w   d4
		move.b  1(a2,d7.w),d4
		clr.w   d5
		move.b  2(a2,d7.w),d5
		lsr.w   #1,d7
		sub.w   d2,d4
		sub.w   d3,d5
		move.w  d4,d6
		add.w   d4,d4
		add.w   d6,d4
		lsl.w   #3,d4
		move.w  d5,d6
		add.w   d5,d5
		add.w   d6,d5
		lsl.w   #3,d5
		add.w   d0,d4
		add.w   d1,d5
		addi.w  #$80,d4 
		addi.w  #$78,d5 
		move.w  d5,(a0,d7.w)
		move.w  d4,6(a0,d7.w)
		movem.w (sp)+,d4-d5
		bra.s   loc_B564
loc_B5B0:
		clr.w   d2
		move.b  ((TARGET_X-$1000000)).w,d2
		clr.w   d3
		move.b  ((TARGET_Y-$1000000)).w,d3
		move.w  d0,d6
		sub.w   d2,d6
		subq.w  #4,d6
		jsr     (j_UpdateBackgroundHScrollData).l
		move.w  d1,d6
		sub.w   d3,d6
		subq.w  #8,d6
		neg.w   d6
		jsr     (j_UpdateBackgroundVScrollData).l
		jsr     (j_EnableDmaQueueProcessing).l
		cmp.w   d4,d5
		bne.s   loc_B5EA
loc_B5E0:
		move.l  #sub_9A8A,(VINT_CONTEXTUAL_FUNCTION_ADDRESS).l
loc_B5EA:
		addq.b  #1,((byte_FFB525-$1000000)).w
		bra.w   sub_9A8A

    ; End of function sub_B4F8


; =============== S U B R O U T I N E =======================================

WriteMemberStatusWindowSpellsAndItems:
		
		move.w  #$C6D0,d7       ; spell icons VDP tiles start
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetEntitySpellsAddressForCombatant
		move.b  (a0),d1
		cmpi.b  #$FF,d1
		beq.w   WriteNothingStringUnderSpells
						; skip writing spells if first spell slot is empty
		lea     ((byte_FFBA1A-$1000000)).w,a1
		moveq   #3,d6           ; iterate 4 spell slots
@WriteSpells_Loop:
		
		move.b  (a0)+,d1
		cmpi.b  #$FF,d1
		beq.w   WriteItemNamesAndIcons
		bsr.w   WriteSpellIconTiles
		                
		movem.w d0-d1/d6-d7,-(sp)
		movem.l a0-a1,-(sp)     ; -> stash spell entry and layout position addresses
		move.w  d1,d0
		jsr     j_GetSpellNameAddress
		move.w  d1,d7
		adda.w  #48,a1          ; spell name position relative to spells start address
		moveq   #-44,d1
		bsr.w   WriteTilesFromAscii
		movem.l (sp)+,a0-a1     ; A0, A1 <- pop spell entry and layout position addresses
		movem.w (sp)+,d0-d1/d6-d7
		                
		movem.w d6-d7,-(sp)
		movem.l a0-a1,-(sp)
		lea     byte_B67C(pc), a0
		andi.w  #$C0,d1 
		move.w  d1,d2
		add.w   d1,d1
		add.w   d2,d1
		lsr.w   #4,d1
		adda.w  d1,a0
		adda.w  #92,a1          ; spell level tiles position relative to spells start address
		moveq   #12,d7
		jsr     (j_CopyBytes).l
		movem.l (sp)+,a0-a1
		movem.w (sp)+,d6-d7
		                
		adda.w  #132,a1
		dbf     d6,@WriteSpells_Loop
                
		bra.w   WriteItemNamesAndIcons

    ; End of function WriteMemberStatusWindowSpellsAndItems

byte_B67C:      dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F1
		dc.b $C0
		dc.b $20
		dc.b $C0
		dc.b $20
		dc.b $C0
		dc.b $20
		dc.b $C0
		dc.b $20
byte_B688:      dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F2
		dc.b $C8
		dc.b $F0
		dc.b $C0
		dc.b $20
		dc.b $C0
		dc.b $20
		dc.b $C0
		dc.b $20
byte_B694:      dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F2
		dc.b $C8
		dc.b $F0
		dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F1
		dc.b $C0
		dc.b $20
byte_B6A0:      dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F2
		dc.b $C8
		dc.b $F0
		dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F2
		dc.b $C8
		dc.b $F0
byte_B6AC:      dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F5
		dc.b $C0
		dc.b $F4
		dc.b $C0
		dc.b $20
		dc.b $C0
		dc.b $20
		dc.b $C0
		dc.b $20
byte_B6B8:      dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F2
		dc.b $C8
		dc.b $F0
		dc.b $C8
		dc.b $F4
		dc.b $C0
		dc.b $F7
		dc.b $C0
		dc.b $20
byte_B6C4:      dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F2
		dc.b $C8
		dc.b $F0
		dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F5
		dc.b $C0
		dc.b $F4
byte_B6D0:      dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F5
		dc.b $C0
		dc.b $F4
		dc.b $C8
		dc.b $F4
		dc.b $C0
		dc.b $F7
		dc.b $C0
		dc.b $20
byte_B6DC:      dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F2
		dc.b $C8
		dc.b $F0
		dc.b $C8
		dc.b $F4
		dc.b $C0
		dc.b $F6
		dc.b $C0
		dc.b $F4
byte_B6E8:      dc.b $C0
		dc.b $F0
		dc.b $C0
		dc.b $F5
		dc.b $C0
		dc.b $F4
		dc.b $C8
		dc.b $F4
		dc.b $C0
		dc.b $F6
		dc.b $C0
		dc.b $F4
byte_B6F4:      dc.b $AE
		dc.b $AF
		dc.b $B4
		dc.b $A8
		dc.b $A9
		dc.b $AE
		dc.b $A7
		dc.b $FF

; START OF FUNCTION CHUNK FOR WriteMemberStatusWindowSpellsAndItems

WriteNothingStringUnderSpells:
		
		move.w  d7,-(sp)
		lea     byte_B6F4(pc), a0
		lea     ((byte_FFBA46-$1000000)).w,a1
		moveq   #-44,d1
		moveq   #7,d7
		bsr.w   WriteTilesFromAscii
		move.w  (sp)+,d7
WriteItemNamesAndIcons:
		
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetEntityItemsAddressForCombatant
		move.b  (a0),d1
		cmpi.b  #$FF,d1
		beq.w   WriteNothingStringUnderItems
		lea     ((byte_FFBA2C-$1000000)).w,a1
		moveq   #3,d6
@WriteItems_Loop:
		
		move.b  (a0)+,d1
		cmpi.b  #$FF,d1
		beq.w   @Return         ; return if there are no more items
		bsr.w   WriteSpellIconTiles
		                
		movem.w d0-d1/d6-d7,-(sp)
		movem.l a0-a1,-(sp)
		move.w  d1,d0
		jsr     j_GetItemNameAddress
		move.w  d1,d7
		addq.w  #4,a1
		moveq   #-44,d1
		bsr.w   WriteTilesFromAscii
		movem.l (sp)+,a0-a1
		movem.w (sp)+,d0-d1/d6-d7
		                
		btst    #ITEMENTRY_BIT_EQUIPPED,d1
		beq.w   @NextItem       ; move on to next item if current one is not equipped
		movem.w d6-d7,-(sp)
		movem.l a0-a1,-(sp)
		lea     byte_B78C(pc), a0
		adda.w  #92,a1
		moveq   #-44,d1
		moveq   #8,d7
		bsr.w   WriteTilesFromAscii
		movem.l (sp)+,a0-a1
		movem.w (sp)+,d6-d7
@NextItem:
		adda.w  #132,a1
		dbf     d6,@WriteItems_Loop
@Return:
		rts

; END OF FUNCTION CHUNK FOR WriteMemberStatusWindowSpellsAndItems

byte_B78C:      dc.b $A5
		dc.b $B1
		dc.b $B5
		dc.b $A9
		dc.b $B0
		dc.b $B0
		dc.b $A5
		dc.b $A4
byte_B794:      dc.b $AE
		dc.b $AF
		dc.b $B4
		dc.b $A8
		dc.b $A9
		dc.b $AE
		dc.b $A7
		dc.b $FF

; START OF FUNCTION CHUNK FOR WriteMemberStatusWindowSpellsAndItems

WriteNothingStringUnderItems:
		
		move.w  d7,-(sp)
		lea     byte_B794(pc), a0
		lea     ((byte_FFBA58-$1000000)).w,a1
		moveq   #-44,d1
		moveq   #7,d7
		bsr.w   WriteTilesFromAscii
		move.w  (sp)+,d7
		rts

; END OF FUNCTION CHUNK FOR WriteMemberStatusWindowSpellsAndItems

		dc.b $FF
		dc.b $FF

; =============== S U B R O U T I N E =======================================

WriteSpellIconTiles:
		
		move.w  d7,(a1)
		addq.w  #1,d7
		move.w  d7,2(a1)
		addq.w  #1,d7
		move.w  d7,$2C(a1)
		addq.w  #1,d7
		move.w  d7,$2E(a1)
		addq.w  #1,d7
		move.w  d7,$58(a1)
		addq.w  #1,d7
		move.w  d7,$5A(a1)
		addq.w  #1,d7
		rts

    ; End of function WriteSpellIconTiles


; =============== S U B R O U T I N E =======================================

WriteMemberStatusWindowIcons:
		
		lea     (byte_FF4000).l,a1
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetEntitySpellsAddressForCombatant
		moveq   #3,d6
loc_B7EA:
		move.b  (a0)+,d1
		cmpi.b  #$FF,d1
		beq.w   loc_B81E
		move.l  a0,-(sp)
		andi.w  #$1F,d1
		movea.l (p_SpellIcons).l,a0
		move.w  d1,d2
		add.w   d1,d1
		add.w   d2,d1
		lsl.w   #6,d1
		adda.w  d1,a0
		move.w  #$C0,d7 
		jsr     (j_CopyBytes).l
		movea.l (sp)+,a0
		adda.w  #$C0,a1 
		dbf     d6,loc_B7EA
loc_B81E:
		jsr     j_GetEntityItemsAddressForCombatant
		moveq   #3,d6
loc_B826:
		move.b  (a0)+,d1
		cmpi.b  #$FF,d1
		beq.w   loc_B85A
		move.l  a0,-(sp)
		andi.w  #ITEMENTRY_MASK_INDEX,d1
		movea.l (p_ItemIcons).l,a0
		move.w  d1,d2
		add.w   d1,d1
		add.w   d2,d1
		lsl.w   #6,d1
		adda.w  d1,a0
		move.w  #$C0,d7 
		jsr     (j_CopyBytes).l
		movea.l (sp)+,a0
		adda.w  #$C0,a1 
		dbf     d6,loc_B826
loc_B85A:
		lea     (byte_FF4000).l,a0
		lea     ($DA00).l,a1
		move.w  #$300,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jsr     (j_WaitForDmaQueueProcessing).l
		rts

    ; End of function WriteMemberStatusWindowIcons


; =============== S U B R O U T I N E =======================================

sub_B87A:
		clr.b   (FADING_SETTING).l
		lea     (PALETTE_2_BASE).l,a0
		lea     (PALETTE_2_CURRENT).l,a1
		move.l  -$20(a0),(a1)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a1)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a1)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a1)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a1)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a1)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a1)+
		move.l  -$20(a0),(a0)+
		move.l  -$20(a0),(a1)+
		move.l  -$20(a0),(a0)+
		jsr     (j_ApplyVIntCramDma).l
		jsr     (j_WaitForVInt).l
		moveq   #1,d0
		bsr.w   sub_B936
		move.b  #OUT_TO_BLACK,(FADING_SETTING).l
		clr.b   (FADING_POINTER).l
		move.b  (FADING_COUNTER_MAX).l,(FADING_COUNTER).l
		move.b  #1,(FADING_PALETTE_FLAGS).l
		rts

    ; End of function sub_B87A


; =============== S U B R O U T I N E =======================================

sub_B900:
		move.b  #IN_FROM_BLACK,(FADING_SETTING).l
		clr.b   (FADING_POINTER).l
		move.b  (FADING_COUNTER_MAX).l,(FADING_COUNTER).l
		move.b  #1,(FADING_PALETTE_FLAGS).l
		bsr.s   sub_B926
		clr.w   d0
		bra.s   sub_B936

    ; End of function sub_B900


; =============== S U B R O U T I N E =======================================

sub_B926:
		jsr     (j_WaitForVInt).l
		tst.b   (FADING_SETTING).l
		bne.s   sub_B926
		rts

    ; End of function sub_B926


; =============== S U B R O U T I N E =======================================

sub_B936:
		clr.w   d2
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d2
		move.w  ((MAP_WIDTH-$1000000)).w,d1
		mulu.w  d1,d2
		clr.w   d1
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d1
		add.w   d2,d1
		lea     ((PASSABILITY_FLAGS-$1000000)).w,a0
		adda.w  d1,a0
		move.w  ((MAP_WIDTH-$1000000)).w,d2
		move.b  d0,-1(a0,d2.w)
		move.b  d0,(a0,d2.w)
		move.b  d0,1(a0,d2.w)
		move.b  d0,-1(a0)
		move.b  d0,(a0)
		move.b  d0,1(a0)
		neg.w   d2
		move.b  d0,-1(a0,d2.w)
		move.b  d0,(a0,d2.w)
		move.b  d0,1(a0,d2.w)
		bsr.w   sub_AB9C
		jmp     (j_WaitForVInt).l

    ; End of function sub_B936

wl_StatusMain:  incbin "data/graphics/tech/windowlayouts/wl-statusmain.bin"
wl_StatusGold:  incbin "data/graphics/tech/windowlayouts/wl-statusgold.bin"

; =============== S U B R O U T I N E =======================================

sub_BE3A:
		move.b  #3,((CURRENT_MENU-$1000000)).w
		jsr     j_GetEntityItemsAddress
		movea.l (p_ItemIcons).l,a2
		bra.w   loc_C5F4

    ; End of function sub_BE3A


; =============== S U B R O U T I N E =======================================

sub_BE50:
		clr.w   d0
		move.b  ((CURRENT_MENU-$1000000)).w,d0
		cmpi.w  #1,d0
		bne.s   loc_BE5E
		rts
loc_BE5E:
		lsl.w   #2,d0
		movea.l pt_MenuTiles(pc,d0.w),a0
		movea.l (a0),a0
		jmp     (j_DecompressGraphics).l

    ; End of function sub_BE50

pt_MenuTiles:   dc.l p_MenuTiles_Options
		dc.l p_MenuTiles_Main
		dc.l p_MenuTiles_Options
		dc.l p_MenuTiles_Options
		dc.l p_MenuTiles_Item
		dc.l p_MenuTiles_Shop
		dc.l p_MenuTiles_Options
		dc.l p_MenuTiles_Options
		dc.l p_MenuTiles_Headquarters
		dc.l p_MenuTiles_Church

; =============== S U B R O U T I N E =======================================

sub_BE94:
		movem.l d0-a1,-(sp)
		bsr.w   sub_C46A
		lea     wl_CC90(pc), a0
		nop
		move.w  #$606,d0
		bclr    #0,((byte_FFB4CA-$1000000)).w
		bne.s   loc_BEBA
		move.l  #$20101910,d1
		moveq   #3,d2
		bsr.w   MoveWindowWithSfx
loc_BEBA:
		movem.l (sp)+,d0-a1
		rts

    ; End of function sub_BE94


; =============== S U B R O U T I N E =======================================

sub_BEC0:
		movem.l d0-a1,-(sp)
		lea     wl_CC90(pc), a0
		nop
		move.w  #$606,d0
		move.l  #$19102010,d1
		moveq   #2,d2
		bsr.w   MoveWindowWithSfx
		movem.l (sp)+,d0-a1
		rts

    ; End of function sub_BEC0


; =============== S U B R O U T I N E =======================================

sub_BEE0:
		clr.w   d7
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		jsr     j_FindTargetableSpacesForAttack
		jsr     j_PopulateTargetsList
		tst.w   ((TABLE_AT_FFA8C0-$1000000)).w
		beq.s   loc_BEFC
		clr.w   d7
		bra.s   loc_BEFE
loc_BEFC:
		moveq   #3,d7
loc_BEFE:
		move.b  d7,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		move.b  d7,((byte_FFB529-$1000000)).w
		bra.s   loc_BF1C

    ; End of function sub_BEE0


; =============== S U B R O U T I N E =======================================

sub_BF08:
		move.b  #3,((byte_FFB4D5-$1000000)).w
		bra.s   sub_BF14

    ; End of function sub_BF08


; =============== S U B R O U T I N E =======================================

sub_BF10:
		clr.b   ((byte_FFB4D5-$1000000)).w

    ; End of function sub_BF10


; =============== S U B R O U T I N E =======================================

sub_BF14:
		clr.b   ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		clr.b   ((byte_FFB529-$1000000)).w
loc_BF1C:
		btst    #1,((CURRENT_MENU-$1000000)).w
		bne.s   loc_BF28
		bsr.w   sub_BE50
loc_BF28:
		bsr.w   sub_C3AA
		bsr.w   sub_C480
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$1306,d0
		bclr    #0,((byte_FFB4CA-$1000000)).w
		bne.s   loc_BF56
		tst.b   ((byte_FFB4CC-$1000000)).w
		beq.s   loc_BF4E
		move.l  #$19100C15,d1
		bra.s   loc_BF54
loc_BF4E:
		move.l  #$C1B0C15,d1
loc_BF54:
		bra.s   loc_BF5C
loc_BF56:
		move.l  #$1C150C15,d1
loc_BF5C:
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		bsr.w   sub_C1EA
loc_BF68:
		moveq   #$F,d6
loc_BF6A:
		btst    #INPUT_BIT_LEFT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_BF8C
		moveq   #1,d1
		bsr.w   sub_C262
		bcs.w   loc_BF8C
		move.b  #1,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_C01A
loc_BF8C:
		btst    #INPUT_BIT_RIGHT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_BFAC
		moveq   #2,d1
		bsr.w   sub_C262
		bcs.s   loc_BFAC
		move.b  #2,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_C01A
loc_BFAC:
		btst    #INPUT_BIT_UP,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_BFC2
		clr.b   ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_C01A
loc_BFC2:
		btst    #INPUT_BIT_DOWN,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_BFE2
		moveq   #3,d1
		bsr.w   sub_C262
		bcs.s   loc_BFE2
		move.b  #3,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_C01A
loc_BFE2:
		btst    #INPUT_BIT_B,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_BFF2
		moveq   #-1,d0
		bra.w   loc_C090
loc_BFF2:
		btst    #INPUT_BIT_C,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_C006
		clr.w   d0
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d0
		bra.w   loc_C050
loc_C006:
		btst    #INPUT_BIT_A,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_C02E
		clr.w   d0
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d0
		bra.w   loc_C050
loc_C01A:
		bsr.w   sub_C1DA
		bsr.w   sub_C3AA
		bsr.w   CreateMagicMenuWindow
		jsr     (j_WaitForVInt).l
		moveq   #$13,d6
loc_C02E:
		btst    #1,((CURRENT_MENU-$1000000)).w
		beq.s   loc_C042
		bsr.w   sub_C1A6
		jsr     (j_WaitForVInt).l
		bra.s   loc_C046
loc_C042:
		bsr.w   sub_C480
loc_C046:
		subq.w  #1,d6
		bne.s   loc_C04C
		moveq   #$14,d6
loc_C04C:
		bra.w   loc_BF6A
loc_C050:
		cmpi.b  #MAGIC_MENU,((CURRENT_MENU-$1000000)).w
		bne.w   loc_C090
		sndCom  SFX_VALIDATION
		move.w  d0,-(sp)
		moveq   #$14,d6
		bsr.w   sub_C1A6
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		jsr     j_GetEntitySpellsAddressForCombatant
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
		move.b  (a0,d1.w),d1
		bsr.w   ExecuteMagicMenu
		clr.w   d6
		bsr.w   sub_C16A
		sndCom  SFX_VALIDATION
		move.w  (sp)+,d0
		cmpi.w  #$FFFF,d1
		beq.s   loc_C01A
loc_C090:
		movem.w d0-d1,-(sp)
		move.w  d0,-(sp)
		clr.w   d6
		bsr.w   sub_C1A6
		move.w  (sp)+,d0
		cmpi.b  #MAGIC_MENU,((CURRENT_MENU-$1000000)).w
		beq.w   loc_C10E
		cmpi.b  #3,((CURRENT_MENU-$1000000)).w
		bne.w   loc_C10E
		tst.b   ((byte_FFB52A-$1000000)).w
		bne.w   loc_C10E
		cmpi.w  #$FFFF,d0
		beq.w   loc_C10E
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		jsr     j_GetEntityItemsAddressForCombatant
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
		move.b  (a0,d1.w),d1
		btst    #7,d1
		beq.w   loc_C0E8
		jsr     j_GetItemType
		btst    #ITEMTYPE_BIT_CURSED,d2
loc_C0E8:
		beq.s   loc_C100
		bsr.w   PlayCursedItemMusic
		moveq   #5,d0           ; "The item loves you." refusal text
		bsr.w   sub_D32C        
		bsr.w   sub_C3AA
		movem.w (sp)+,d0-d1
		bra.w   loc_BF68
loc_C100:
		bra.s   loc_C10E
		clr.w   d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
loc_C10E:
		movem.w (sp)+,d0-d1
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		movem.w d0-d1,-(sp)
		cmpi.b  #$FF,d0
		beq.s   loc_C128
		move.l  #$C152015,d1
		bra.s   loc_C142
loc_C128:
		tst.b   ((byte_FFB4CC-$1000000)).w
		beq.s   loc_C136
		move.l  #$C151710,d1
		bra.s   loc_C13C
loc_C136:
		move.l  #$C150C1C,d1
loc_C13C:
		bset    #0,((byte_FFB4CA-$1000000)).w
loc_C142:
		move.w  #$1306,d0
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		movem.w (sp)+,d0-d1
		rts

    ; End of function sub_BF14


; =============== S U B R O U T I N E =======================================

CreateMagicMenuWindow:
		
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$1306,d0
		move.l  #$C15,d1
		bsr.w   CreateWindow    
		bra.w   sub_AF66

    ; End of function CreateMagicMenuWindow


; =============== S U B R O U T I N E =======================================

sub_C16A:
		lea     (SPRITE_01_PROPERTIES).l,a1
		lea     spr_C7B2(pc), a0
		nop
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		cmpi.w  #$A,d6
		bge.s   loc_C190
		move.w  #1,-$10(a1)
		move.w  #1,-8(a1)
loc_C190:
		btst    #INPUT_BIT_START,(P1_INPUT).l
		beq.s   sub_C1A6
		move.w  #1,-$10(a1)
		move.w  #1,-8(a1)

    ; End of function sub_C16A


; =============== S U B R O U T I N E =======================================

sub_C1A6:
		lea     (SPRITE_00_PROPERTIES).l,a1
		lea     spr_C792(pc), a0
		nop
		clr.w   d0
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d0
		lsl.w   #3,d0
		adda.w  d0,a0
		move.w  (a0)+,d0
		cmpi.w  #$A,d6
		bge.s   loc_C1C6
		moveq   #1,d0
loc_C1C6:
		btst    #INPUT_BIT_START,(P1_INPUT).l
		beq.s   loc_C1D2
		moveq   #1,d0
loc_C1D2:
		move.w  d0,(a1)+
		move.l  (a0)+,(a1)+
		move.w  (a0)+,(a1)+
		rts

    ; End of function sub_C1A6


; =============== S U B R O U T I N E =======================================

sub_C1DA:
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d7
		cmp.b   ((byte_FFB529-$1000000)).w,d7
		beq.w   return_C242
		move.b  d7,((byte_FFB529-$1000000)).w

    ; End of function sub_C1DA


; =============== S U B R O U T I N E =======================================

sub_C1EA:
		btst    #1,((CURRENT_MENU-$1000000)).w
		beq.w   return_C242
		tst.b   ((byte_FFB53A-$1000000)).w
		bne.s   return_C242
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
loc_C204:
		btst    #0,((CURRENT_MENU-$1000000)).w
		beq.s   loc_C226
		tst.b   ((byte_FFB52A-$1000000)).w
		beq.w   return_C242
		jsr     j_GetEntityItemsAddressForCombatant
loc_C21A:
		move.b  (a0,d1.w),d1
		jsr     j_UseItem
		bra.s   loc_C236
loc_C226:
		jsr     j_GetEntitySpellsAddressForCombatant
		move.b  (a0,d1.w),d1
		jsr     j_FindTargetableSpacesForSpell
loc_C236:
		moveq   #1,d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
return_C242:
		rts

    ; End of function sub_C1EA


; =============== S U B R O U T I N E =======================================

sub_C244:
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		tst.b   ((byte_FFB53A-$1000000)).w
		beq.s   loc_C250
		rts
loc_C250:
		lsl.w   #6,d5
		or.w    d5,d1
		jsr     j_FindTargetableSpacesForSpell
		jsr     (j_WaitForVInt).l
		bra.s   loc_C236

    ; End of function sub_C244


; =============== S U B R O U T I N E =======================================

sub_C262:
		btst    #1,((CURRENT_MENU-$1000000)).w
		beq.w   loc_C298
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		btst    #0,((CURRENT_MENU-$1000000)).w
		beq.s   loc_C280
		jsr     j_GetEntityItemsAddressForCombatant
		bra.s   loc_C286
loc_C280:
		jsr     j_GetEntitySpellsAddressForCombatant
loc_C286:
		move.b  (a0,d1.w),d1
		cmpi.b  #$FF,d1
		bne.w   loc_C298
		ori     #1,ccr
		rts
loc_C298:
		tst.b   d0
		rts

    ; End of function sub_C262


; =============== S U B R O U T I N E =======================================

ExecuteMagicMenu:
		
		move.w  d1,d4
		lsr.w   #6,d4
		move.w  d4,d5
		andi.w  #SPELLENTRY_MASK_INDEX,d1
		jsr     (j_WaitForVInt).l
loc_C2AC:
		btst    #INPUT_BIT_LEFT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_C2C4
		subq.w  #1,d5
		cmpi.w  #$FFFF,d5
		bne.s   loc_C2C0
		move.w  d4,d5
loc_C2C0:
		bra.w   byte_C308
loc_C2C4:
		btst    #INPUT_BIT_RIGHT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_C2DA
		addq.w  #1,d5
		cmp.w   d4,d5
		ble.s   loc_C2D6
		clr.w   d5
loc_C2D6:
		bra.w   byte_C308
loc_C2DA:
		btst    #INPUT_BIT_B,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_C2E8
		moveq   #-1,d1
		rts
loc_C2E8:
		btst    #INPUT_BIT_A,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_C2F6
		bra.w   loc_C302
loc_C2F6:
		btst    #INPUT_BIT_C,(CURRENT_PLAYER_INPUT).l
		beq.w   loc_C34E
loc_C302:
		lsl.w   #6,d5
		or.w    d5,d1
		rts
byte_C308:
		sndCom  SFX_MENU_SELECTION
		movem.w d1/d4-d5,-(sp)
		lsl.w   #2,d4
		add.w   d5,d4
		lsl.w   #2,d4
		lea     off_C362(pc), a0
		nop
		movea.l (a0,d4.w),a0
		lea     ((byte_FFB860-$1000000)).w,a1
		moveq   #$C,d7
		jsr     (j_CopyBytes).l
		lsl.w   #6,d5
		andi.w  #SPELLENTRY_MASK_INDEX,d1
		or.w    d5,d1
		bsr.w   WriteMpCost
		bsr.w   CreateMagicMenuWindow
		movem.w (sp)+,d1/d4-d5
		movem.w d1/d4-d5,-(sp)
		bsr.w   sub_C244
		movem.w (sp)+,d1/d4-d5
		moveq   #$13,d6
loc_C34E:
		bsr.w   sub_C16A
		jsr     (j_WaitForVInt).l
		subq.w  #1,d6
		bne.s   loc_C35E
		moveq   #$14,d6
loc_C35E:
		bra.w   loc_C2AC

    ; End of function ExecuteMagicMenu

off_C362:       dc.l byte_B67C
		dc.l byte_B67C
		dc.l byte_B67C
		dc.l byte_B67C
		dc.l byte_B6AC
		dc.l byte_B688
		dc.l byte_B688
		dc.l byte_B688
		dc.l byte_B6D0
		dc.l byte_B6B8
		dc.l byte_B694
		dc.l byte_B694
		dc.l byte_B6E8
		dc.l byte_B6DC
		dc.l byte_B6C4
		dc.l byte_B6A0
defined_word_C3A2:
		dc.w $AE
		dc.w $AE
		dc.w $62
		dc.w $88

; =============== S U B R O U T I N E =======================================

sub_C3AA:
		clr.w   d0
		move.b  ((CURRENT_MENU-$1000000)).w,d0
		move.w  d0,-(sp)        ; -> stash current menu index
		cmpi.w  #3,d0
		bgt.s   loc_C3C2
		andi.w  #3,d0
		mulu.w  #$E4,d0 
		bra.s   loc_C3C4
loc_C3C2:
		clr.w   d0
loc_C3C4:
		lea     wl_C900(pc), a0 
		adda.w  d0,a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$E4,d7 
		jsr     (j_CopyBytes).l
		move.w  (sp)+,d0        ; D0 <- pop current menu index
		cmpi.w  #MAGIC_MENU,d0
		beq.w   loc_C6EE
		cmpi.w  #3,d0
		beq.w   loc_C74E
		move.w  d0,d7
		andi.w  #3,d7
		add.w   d7,d7
		move.w  defined_word_C3A2(pc,d7.w),d7
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		adda.w  d7,a1
		lsl.w   #4,d0
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
		lsl.w   #2,d1
		add.w   d1,d0
		lea     pt_MenuActionStrings(pc), a0
		movea.l (a0,d0.w),a0
		cmpi.b  #MAIN_MENU,((CURRENT_MENU-$1000000)).w
		bne.s   loc_C440
		cmpi.b  #0,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		bne.s   loc_C42C
		btst    #1,((byte_FFB4D5-$1000000)).w
		beq.s   loc_C42C
		lea     aTalk(pc), a0   
loc_C42C:
		cmpi.b  #3,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		bne.s   loc_C440
		btst    #0,((byte_FFB4D5-$1000000)).w
		beq.s   loc_C440
		lea     aSearch(pc), a0 
loc_C440:
		cmpi.b  #ITEM_MENU,((CURRENT_MENU-$1000000)).w
		bne.s   loc_C45C
		cmpi.b  #1,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		bne.s   loc_C45C
		btst    #2,((byte_FFB4D5-$1000000)).w
		beq.s   loc_C45C
		lea     aGold(pc), a0   
loc_C45C:
		clr.w   d7
		move.b  (a0)+,d7
		move.w  #-38,d1
		bsr.w   WriteTilesFromAscii
		rts

    ; End of function sub_C3AA


; =============== S U B R O U T I N E =======================================

sub_C46A:
		move.b  ((byte_FFB4C9-$1000000)).w,d1
		move.w  d1,-(sp)
		move.b  d0,((byte_FFB4C9-$1000000)).w
		bsr.w   sub_C480
		move.w  (sp)+,d1
		move.b  d1,((byte_FFB4C9-$1000000)).w
		rts

    ; End of function sub_C46A


; =============== S U B R O U T I N E =======================================

sub_C480:
		clr.w   d0
		move.b  ((CURRENT_MENU-$1000000)).w,d0
		btst    #1,d0
		bne.w   loc_C5CC
		cmpi.b  #MAIN_MENU,((CURRENT_MENU-$1000000)).w
		bne.s   loc_C49E
		movea.l (p_MenuTiles_Main).l,a2
		bra.s   loc_C4A4
loc_C49E:
		lea     (FF3000_LOADING_SPACE).l,a2
loc_C4A4:
		movea.l a2,a0
loc_C4A6:
		btst    #1,((byte_FFB4D5-$1000000)).w
		beq.s   loc_C4B2
		adda.w  #$900,a0
loc_C4B2:
		cmpi.w  #$A,d6
		ble.s   loc_C4C2
		tst.b   ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		bne.s   loc_C4C2
		adda.w  #$120,a0
loc_C4C2:
		lea     (FF0FFE_LOADING_SPACE).l,a1
		move.w  #$120,d7
		jsr     (j_CopyBytes).l
		adda.w  #$120,a1
		move.l  a1,-(sp)
		move.w  #$BF,d0 
loc_C4DC:
		clr.l   (a1)+
		dbf     d0,loc_C4DC

		movea.l (sp)+,a1
		movea.l a2,a0
		btst    #2,((byte_FFB4D5-$1000000)).w
		beq.s   loc_C4F2
		adda.w  #$6C0,a0
loc_C4F2:
		adda.w  #$240,a0
		cmpi.w  #$A,d6
		ble.s   loc_C508
		cmpi.b  #1,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		bne.s   loc_C508
		adda.w  #$120,a0
loc_C508:
		moveq   #8,d7
loc_C50A:
		move.l  (a0)+,$10(a1)
		move.l  (a0)+,$14(a1)
		move.l  (a0)+,$18(a1)
		move.l  (a0)+,$1C(a1)
		move.l  (a0)+,$60(a1)
		move.l  (a0)+,$64(a1)
loc_C522:
		move.l  (a0)+,$68(a1)
		move.l  (a0)+,$6C(a1)
		adda.w  #$20,a1 
		dbf     d7,loc_C50A

		adda.w  #$60,a1 
		movea.l a2,a0
		adda.w  #$480,a0
		cmpi.w  #$A,d6
		ble.s   loc_C54E
		cmpi.b  #2,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		bne.s   loc_C54E
		adda.w  #$120,a0
loc_C54E:
		moveq   #8,d7
loc_C550:
		move.l  (a0)+,$10(a1)
		move.l  (a0)+,$14(a1)
		move.l  (a0)+,$18(a1)
		move.l  (a0)+,$1C(a1)
		move.l  (a0)+,$60(a1)
		move.l  (a0)+,$64(a1)
		move.l  (a0)+,$68(a1)
		move.l  (a0)+,$6C(a1)
		adda.w  #$20,a1 
		dbf     d7,loc_C550

		adda.w  #$60,a1 
		movea.l a2,a0
		adda.w  #$6C0,a0
		btst    #0,((byte_FFB4D5-$1000000)).w
		beq.s   loc_C58E
		adda.w  #$480,a0
loc_C58E:
		cmpi.w  #$A,d6
		ble.s   loc_C5A0
		cmpi.b  #3,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		bne.s   loc_C5A0
		adda.w  #$120,a0
loc_C5A0:
		move.w  #$120,d7
		jsr     (j_CopyBytes).l
		adda.w  #$120,a1
		lea     (FF0FFE_LOADING_SPACE).l,a0
		lea     ($F800).l,a1
		move.w  #$400,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jmp     (j_WaitForDmaQueueProcessing).l
loc_C5CC:
		btst    #0,d0
		beq.s   loc_C5E4
		movea.l (p_ItemIcons).l,a2
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		jsr     j_GetEntityItemsAddressForCombatant
		bra.s   loc_C5F4
loc_C5E4:
		movea.l (p_SpellIcons).l,a2
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		jsr     j_GetEntitySpellsAddressForCombatant
loc_C5F4:
		movea.l a0,a3
		clr.w   d1
		bsr.w   GetIconTilesAddress
		lea     (FF0FFE_LOADING_SPACE).l,a1
		move.w  #ICONTILES_BYTESIZE,d7
loc_C606:
		jsr     (j_CopyBytes).l
		adda.w  #ICONTILES_BYTESIZE,a1
		move.l  a1,-(sp)
		move.w  #$BF,d0 
loc_C616:
		clr.l   (a1)+
		dbf     d0,loc_C616

		movea.l (sp)+,a1
		moveq   #1,d1
		bsr.w   GetIconTilesAddress
		moveq   #5,d7
loc_C626:
		move.l  (a0)+,$10(a1)
		move.l  (a0)+,$14(a1)
		move.l  (a0)+,$18(a1)
		move.l  (a0)+,$1C(a1)
		move.l  (a0)+,$40(a1)
		move.l  (a0)+,$44(a1)
		move.l  (a0)+,$48(a1)
		move.l  (a0)+,$4C(a1)
		adda.w  #$20,a1 
		dbf     d7,loc_C626

		adda.w  #$40,a1 
		moveq   #2,d1
		bsr.w   GetIconTilesAddress
		moveq   #5,d7
loc_C65A:
		move.l  (a0)+,$10(a1)
		move.l  (a0)+,$14(a1)
		move.l  (a0)+,$18(a1)
		move.l  (a0)+,$1C(a1)
		move.l  (a0)+,$40(a1)
		move.l  (a0)+,$44(a1)
		move.l  (a0)+,$48(a1)
loc_C676:
		move.l  (a0)+,$4C(a1)
		adda.w  #$20,a1 
		dbf     d7,loc_C65A

		adda.w  #$40,a1 
		moveq   #3,d1
		bsr.w   GetIconTilesAddress
		move.w  #ICONTILES_BYTESIZE,d7
		jsr     (j_CopyBytes).l
		adda.w  #ICONTILES_BYTESIZE,a1
		lea     IconHighlightTiles(pc), a0
		move.w  #$200,d7
		jsr     (j_CopyBytes).l
		lea     (FF0FFE_LOADING_SPACE).l,a0
		lea     ($F800).l,a1
		move.w  #$300,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jmp     (j_WaitForDmaQueueProcessing).l

    ; End of function sub_C480


; =============== S U B R O U T I N E =======================================

; In: A2 = icons tiles pointer
;     A3 = entity items/spells address
;     D1 = item/spell slot
; 
; Out: A0 = icon tiles address

GetIconTilesAddress:
		
		move.b  (a3,d1.w),d1
		andi.w  #ITEMENTRY_MASK_INDEX,d1
		cmpi.w  #ITEM_NOTHING_ITEM,d1
		bne.s   @Continue
		                
		movea.l (p_ItemIcons).l,a0
		adda.w  #ICONTILES_OFFSET_EMPTY,a0
		bra.s   @Return
@Continue:
		move.w  d1,d7
		add.w   d1,d1
		add.w   d7,d1
		lsl.w   #6,d1
		movea.l a2,a0
		adda.w  d1,a0
@Return:
		rts

    ; End of function GetIconTilesAddress


; START OF FUNCTION CHUNK FOR sub_C3AA

loc_C6EE:
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		jsr     j_GetEntitySpellsAddressForCombatant
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
		move.b  (a0,d1.w),d1
		move.w  d1,-(sp)
		jsr     j_GetSpellNameAddress
		move.w  d1,d7
		lea     ((byte_FFB83A-$1000000)).w,a1
		moveq   #-38,d1
		bsr.w   WriteTilesFromAscii
		move.w  (sp)+,d1
		                
		move.w  d1,-(sp)
		lea     byte_B67C(pc), a0
		andi.w  #$C0,d1 
		move.w  d1,d2
		add.w   d1,d1
		add.w   d2,d1
		lsr.w   #4,d1
		adda.w  d1,a0
		lea     ((byte_FFB860-$1000000)).w,a1
		moveq   #$C,d7
		jsr     (j_CopyBytes).l
		move.w  (sp)+,d1

; END OF FUNCTION CHUNK FOR sub_C3AA


; =============== S U B R O U T I N E =======================================

WriteMpCost:
		jsr     j_GetMPCost
		lea     ((byte_FFB88C-$1000000)).w,a1
		moveq   #3,d7
		move.w  d2,d0
		ext.l   d0
		bra.w   WriteTilesFromNumber

    ; End of function WriteMpCost


; START OF FUNCTION CHUNK FOR sub_C3AA

loc_C74E:
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		jsr     j_GetEntityItemsAddressForCombatant
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
		move.b  (a0,d1.w),d1
		move.w  d1,-(sp)
		jsr     j_GetItemNameAddress
		move.w  d1,d7
		lea     ((byte_FFB83A-$1000000)).w,a1
		moveq   #-38,d1
		bsr.w   WriteTilesFromAscii
		move.w  (sp)+,d1
		btst    #7,d1
		beq.s   return_C790
		lea     byte_B78C(pc), a0
		lea     ((byte_FFB886-$1000000)).w,a1
		move.w  #8,d7
		moveq   #-38,d1
		bsr.w   WriteTilesFromAscii
return_C790:
		rts

; END OF FUNCTION CHUNK FOR sub_C3AA

spr_C792:       ; icon highlight sprite properties
        vdpSprite 295, V4|H3|1, SELECTION|PALETTE3|PRIORITY_BIT, 255
        vdpSprite 307, V4|H3|1, SELECTION|PALETTE3|PRIORITY_BIT, 239
        vdpSprite 307, V4|H3|1, SELECTION|PALETTE3|PRIORITY_BIT, 271
        vdpSprite 319, V4|H3|1, SELECTION|PALETTE3|PRIORITY_BIT, 255

spr_C7B2:
        vdpSprite 320, V1|H4|2, 2024|PALETTE3|PRIORITY_BIT, 296
        vdpSprite 320, V1|H4|3, 2024|MIRRORED_BIT|PALETTE3|PRIORITY_BIT, 328

pt_MenuActionStrings:
		dc.l aMapdisp           
		dc.l aSpeed             
		dc.l aMessage           
		dc.l aQuit              
		dc.l aAttack            
		dc.l aMagic             
		dc.l aItem              
		dc.l aStay              
		dc.l aSearch            
		dc.l aTalk              
		dc.l aGold              
		dc.l aGold              
		dc.l aGold              
		dc.l aGold              
		dc.l aGold              
		dc.l aGold              
		dc.l aUse               
		dc.l aGive              
		dc.l aEquip             
		dc.l aDrop              
		dc.l aBuy               
		dc.l aDeals             
		dc.l aSell              
		dc.l aRepair            
		dc.l aUse               
		dc.l aGive              
		dc.l aEquip             
		dc.l aDrop              
		dc.l aBuy               
		dc.l aDeals             
		dc.l aSell              
		dc.l aRepair            
		dc.l aAdvice            
		dc.l aJoin              
		dc.l aItem_0            
		dc.l aStatus            
		dc.l aSave              
		dc.l aCure              
		dc.l aRaise             
		dc.l aPromote           
aMapdisp:       dc.b 8,'MAP',0,'DISP'
aSpeed:         dc.b 5,'SPEED'
aMessage:       dc.b 7,'MESSAGE'
aQuit:          dc.b 4,'QUIT'
aAttack:        dc.b 6,'ATTACK'
aMagic:         dc.b 5,'MAGIC'
aItem:          dc.b 4,'ITEM'
aStay:          dc.b 4,'STAY'
aSearch:        dc.b 6,'SEARCH'
aTalk:          dc.b 4,'TALK'
aGold:          dc.b 4,'GOLD'
aUse:           dc.b 3,'USE'
aGive:          dc.b 4,'GIVE'
aEquip:         dc.b 5,'EQUIP'
aDrop:          dc.b 4,'DROP'
aBuy:           dc.b 3,'BUY'
aSell:          dc.b 4,'SELL'
aDeals:         dc.b 5,'DEALS'
aRepair:        dc.b 6,'REPAIR'
aAdvice:        dc.b 6,'ADVICE'
aJoin:          dc.b 4,'JOIN'
aItem_0:        dc.b 4,'ITEM'
aStatus:        dc.b 6,'STATUS'
aSave:          dc.b 4,'SAVE'
aCure:          dc.b 4,'CURE'
aRaise:         dc.b 5,'RAISE'
aPromote:       dc.b 7,'PROMOTE'

wl_C900:        dc.w $C000              ; main menu window start
		dc.w $C000
		dc.w $C000
		dc.w $C7C0
		dc.w $C7C1
		dc.w $C7C2
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7C9
		dc.w $C7CA
		dc.w $C7CB
		dc.w $C7C3
		dc.w $C7C4
		dc.w $C7C5
		dc.w $C7D5
		dc.w $C7D6
		dc.w $C7D7
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7CC
		dc.w $C7CD
		dc.w $C7CE
		dc.w $C7C6
		dc.w $C7C7
		dc.w $C7C8
		dc.w $C7D8
		dc.w $C7D9
		dc.w $C7DA
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7CF
		dc.w $C7D0
		dc.w $C7D1
		dc.w $C7E1
		dc.w $C7E2
		dc.w $C7E3
		dc.w $C7DB
		dc.w $C7DC
		dc.w $C7DD
		dc.w $C000
		dc.w $C080
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C880
		dc.w $C7D2
		dc.w $C7D3
		dc.w $C7D4
		dc.w $C7E4
		dc.w $C7E5
		dc.w $C7E6
		dc.w $C7DE
		dc.w $C7DF
		dc.w $C7E0
		dc.w $C000
		dc.w $C090
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C890
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7E7
		dc.w $C7E8
		dc.w $C7E9
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $D080
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D880
		dc.w $C000              ; menu window 1 start
		dc.w $C000
		dc.w $C000
		dc.w $C7C0
		dc.w $C7C1
		dc.w $C7C2
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7C9
		dc.w $C7CA
		dc.w $C7CB
		dc.w $C7C3
		dc.w $C7C4
		dc.w $C7C5
		dc.w $C7D5
		dc.w $C7D6
		dc.w $C7D7
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7CC
		dc.w $C7CD
		dc.w $C7CE
		dc.w $C7C6
		dc.w $C7C7
		dc.w $C7C8
		dc.w $C7D8
		dc.w $C7D9
		dc.w $C7DA
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7CF
		dc.w $C7D0
		dc.w $C7D1
		dc.w $C7E1
		dc.w $C7E2
		dc.w $C7E3
		dc.w $C7DB
		dc.w $C7DC
		dc.w $C7DD
		dc.w $C000
		dc.w $C080
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C880
		dc.w $C7D2
		dc.w $C7D3
		dc.w $C7D4
		dc.w $C7E4
		dc.w $C7E5
		dc.w $C7E6
		dc.w $C7DE
		dc.w $C7DF
		dc.w $C7E0
		dc.w $C000
		dc.w $C090
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C890
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7E7
		dc.w $C7E8
		dc.w $C7E9
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $D080
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D880
		dc.w $C000              ; magic menu window start
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7C0
		dc.w $C7C1
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7C6
		dc.w $C7C7
		dc.w $C7C2
		dc.w $C7C3
		dc.w $C7CE
		dc.w $C7CF
		dc.w $C000
		dc.w $C080
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C880
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7C8
		dc.w $C7C9
		dc.w $C7C4
		dc.w $C7C5
		dc.w $C7D0
		dc.w $C7D1
		dc.w $C000
		dc.w $C090
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C890
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7CA
		dc.w $C7CB
		dc.w $C7D6
		dc.w $C7D7
		dc.w $C7D2
		dc.w $C7D3
		dc.w $C000
		dc.w $C090
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C890
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7CC
		dc.w $C7CD
		dc.w $C7D8
		dc.w $C7D9
		dc.w $C7D4
		dc.w $C7D5
		dc.w $C000
		dc.w $C090
		dc.w $C04D
		dc.w $C050
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C890
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7DA
		dc.w $C7DB
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $D080
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D880
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7C0
		dc.w $C7C1
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7C6
		dc.w $C7C7
		dc.w $C7C2
		dc.w $C7C3
		dc.w $C7CE
		dc.w $C7CF
		dc.w $C000
		dc.w $C080
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C880
		dc.w $C000
		dc.w $C000
		dc.w $C7C8
		dc.w $C7C9
		dc.w $C7C4
		dc.w $C7C5
		dc.w $C7D0
		dc.w $C7D1
		dc.w $C000
		dc.w $C090
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C890
		dc.w $C000
		dc.w $C000
		dc.w $C7CA
		dc.w $C7CB
		dc.w $C7D6
		dc.w $C7D7
		dc.w $C7D2
		dc.w $C7D3
		dc.w $C000
		dc.w $C090
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C890
		dc.w $C000
		dc.w $C000
		dc.w $C7CC
		dc.w $C7CD
		dc.w $C7D8
		dc.w $C7D9
		dc.w $C7D4
		dc.w $C7D5
		dc.w $C000
		dc.w $C090
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C890
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7DA
		dc.w $C7DB
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $D080
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D880

wl_CC90:        dc.w 0
		dc.w 0
		dc.w $C7C0
		dc.w $C7C1
		dc.w 0
		dc.w 0
		dc.w $C7C6
		dc.w $C7C7
		dc.w $C7C2
		dc.w $C7C3
		dc.w $C7CE
		dc.w $C7CF
		dc.w $C7C8
		dc.w $C7C9
		dc.w $C7C4
		dc.w $C7C5
		dc.w $C7D0
		dc.w $C7D1
		dc.w $C7CA
		dc.w $C7CB
		dc.w $C7D6
		dc.w $C7D7
		dc.w $C7D2
		dc.w $C7D3
		dc.w $C7CC
		dc.w $C7CD
		dc.w $C7D8
		dc.w $C7D9
		dc.w $C7D4
		dc.w $C7D5
		dc.w 0
		dc.w 0
		dc.w $C7DA
		dc.w $C7DB
		dc.w 0
		dc.w 0

IconHighlightTiles:
		incbin "data/graphics/tech/iconhighlighttiles.bin"

; =============== S U B R O U T I N E =======================================

OpenMiniStatusWindow:
		
		movem.l d0-a1,-(sp)
		bsr.w   CreateMiniStatusWindow
		lea     (WINDOW_LAYOUT_LOADING_SPACE).l,a0
		move.w  ((word_FFB7D8-$1000000)).w,d0
		lsl.w   #7,d0
		addq.w  #5,d0
		move.l  #$20010001,d1
		move.w  ((word_FFB7D8-$1000000)).w,d3
		lsr.w   #1,d3
		move.w  #$1F,d4
		sub.w   d3,d4
		lsl.w   #8,d4
		or.w    d4,d1
		move.w  #4,d2
		tst.b   ((byte_FFB4CB-$1000000)).w
		beq.s   loc_CF14
		addi.l  #$150015,d1
loc_CF14:
		bsr.w   MoveWindowWithSfx
		movem.l (sp)+,d0-a1
		rts

    ; End of function OpenMiniStatusWindow


; =============== S U B R O U T I N E =======================================

CloseMiniStatusWindow:
		
		movem.l d0-a1,-(sp)
		bsr.w   CreateMiniStatusWindow
		lea     (WINDOW_LAYOUT_LOADING_SPACE).l,a0
		move.w  ((word_FFB7D8-$1000000)).w,d0
		lsl.w   #7,d0
		addq.w  #5,d0
		move.l  #$20010001,d1
		move.w  ((word_FFB7D8-$1000000)).w,d3
		lsr.w   #1,d3
		move.w  #$1F,d4
		sub.w   d3,d4
		lsl.w   #8,d4
		or.w    d4,d1
		swap    d1
		move.w  #4,d2
		tst.b   ((byte_FFB4CB-$1000000)).w
		beq.s   loc_CF5C
		addi.l  #$150015,d1
loc_CF5C:
		bsr.w   MoveWindowWithSfx
		movem.l (sp)+,d0-a1
		rts

    ; End of function CloseMiniStatusWindow


; =============== S U B R O U T I N E =======================================

sub_CF66:
		bsr.w   BuildMiniStatusWindow
		lea     (WINDOW_LAYOUT_LOADING_SPACE).l,a0
		move.w  ((word_FFB7D8-$1000000)).w,d0
		lsl.w   #7,d0
		addq.w  #5,d0
		moveq   #1,d1
		move.w  ((word_FFB7D8-$1000000)).w,d3
		lsr.w   #1,d3
		moveq   #$1F,d4
		sub.w   d3,d4
		lsl.w   #8,d4
		or.w    d4,d1
		bra.w   CreateWindow    

    ; End of function sub_CF66


; =============== S U B R O U T I N E =======================================

sub_CF8C:
		bsr.w   BuildMiniStatusWindow
		lea     (WINDOW_LAYOUT_LOADING_SPACE).l,a0
		move.w  ((word_FFB7D8-$1000000)).w,d0
		lsl.w   #7,d0
		addq.w  #5,d0
		move.w  #$114,d1
		bra.w   CreateWindow    

    ; End of function sub_CF8C


; =============== S U B R O U T I N E =======================================

CreateMiniStatusWindow:
		
		jsr     (j_WaitForVInt).l

    ; End of function CreateMiniStatusWindow


; =============== S U B R O U T I N E =======================================

BuildMiniStatusWindow:
		
		ext.w   d0
		move.w  d0,((CURRENT_OBJECT-$1000000)).w
		jsr     j_GetCurrentHpForCombatant
		move.w  d1,d2
		jsr     j_GetMaxHpForCombatant
		move.w  d1,d3
		bsr.w   CapMiniStatusBarLength
		movem.w d2-d3,-(sp)     ; push current HP and max HP values
		jsr     j_GetCurrentMpForCombatant
		move.w  d1,d2
		jsr     j_GetMaxMpForCombatant
		move.w  d1,d3
		movem.w (sp)+,d0-d1     ; pull current HP and max HP values -> D0 and D1
		bsr.w   CapMiniStatusBarLength
		move.w  d1,d6
		cmp.w   d1,d3
		ble.s   loc_CFEA
		move.w  d3,d6           ; keep highest of max hp or max mp
loc_CFEA:
		addq.w  #3,d6
		lsr.w   #3,d6
		addi.w  #$A,d6          ; max window width = 22 tiles
		add.w   d6,d6
		movem.w d0-d2,-(sp)     ; push current HP, max HP and current MP values
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetDisplayedNameAddress
		move.w  d1,d2           ; D2 = displayed name length
		adda.w  d1,a0
loc_D006:
		tst.b   -(a0)
		bne.s   loc_D00E
		subq.w  #1,d2
		bra.s   loc_D006
loc_D00E:
		addq.w  #6,d2
		tst.b   d0
		bpl.s   loc_D018        ; branch if ally
		subq.w  #1,d2
		bra.s   loc_D026
loc_D018:
		jsr     j_GetLevelForCombatant
		cmpi.w  #$A,d1
		bge.s   loc_D026
		subq.w  #1,d2
loc_D026:
		add.w   d2,d2
		cmp.w   d6,d2
		ble.s   loc_D02E        
		move.w  d2,d6
loc_D02E:
		movem.w (sp)+,d0-d2     ; pull current HP, max HP and current MP values -> D0, D1 and D2
		move.w  d6,((word_FFB7D8-$1000000)).w
		lea     wl_D230(pc), a0
		lea     (WINDOW_LAYOUT_LOADING_SPACE).l,a1
		bsr.w   sub_D1B2
		bsr.w   sub_D1B2
		bsr.w   sub_D1B2
		move.w  ((word_FFB7D8-$1000000)).w,d7
		lsr.w   #1,d7
		subi.w  #9,d7
loc_D056:
		lea     wl_D24E(pc), a0
		nop
		bsr.w   sub_D1B2
		dbf     d7,loc_D056

		lea     wl_D258(pc), a0
		nop
		bsr.w   sub_D1B2
		bsr.w   sub_D1B2
		bsr.w   sub_D1B2
		bsr.w   sub_D1B2
		bsr.w   sub_D1B2
		movem.w d0-d3,-(sp)
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetEntity
		btst    #7,d1
		bne.s   loc_D09C        ; branch if enemy
		jsr     j_GetEntityStatsAddressForCombatant
		moveq   #$A,d7
		bra.s   loc_D0AA
loc_D09C:
		jsr     j_GetClassForCombatant
		jsr     j_GetClassNameAddress
		move.w  d1,d7           ; D7 = class name length
loc_D0AA:
		lea     (WINDOW_LAYOUT_LOADING_SPACE).l,a1
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		addq.l  #2,a1
		move.w  ((word_FFB7D8-$1000000)).w,d1
		neg.w   d1
		                
		bsr.w   WriteTilesFromAscii
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetLevelForCombatant
		addq.l  #2,a1
		move.w  #$C04C,(a1)+    ; 'L'
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		cmpi.w  #$A,d1
		bge.s   loc_D0DE
		subq.w  #1,d7
loc_D0DE:
		movem.w d0-d1,-(sp)
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetEntity
		tst.b   d1
		movem.w (sp)+,d0-d1
		blt.s   loc_D0FA
		bsr.w   WriteTilesFromNumber
		bra.s   loc_D106
loc_D0FA:
		moveq   #2,d7
		subq.l  #2,a1
		lea     aTwoSpaces(pc), a0; in the NA version, simply cover the "L?" string in the enemies mini status window with two spaces
		bsr.w   WriteTilesFromAscii
loc_D106:
		movem.w (sp)+,d0-d3
		movem.w d0-d3,-(sp)
		lea     (WINDOW_LAYOUT_LOADING_SPACE).l,a1
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		addq.w  #6,a1
		move.l  a1,-(sp)
		move.w  d0,d4
		move.w  d1,d5
		bsr.w   sub_D1D8
		movea.l (sp)+,a1
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		tst.w   d3
		bne.s   loc_D138
		move.w  #$C083,-2(a1)   ; small "P"
loc_D138:
		move.w  d2,d4
		move.w  d3,d5
		bsr.w   sub_D1D8
		movem.w (sp)+,d0-d3
		ext.l   d0
		lea     (WINDOW_LAYOUT_LOADING_SPACE).l,a1
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		suba.w  #$C,a1
		move.l  a1,-(sp)
		moveq   #2,d7
		bsr.w   sub_D19A
		movea.l (sp)+,a1
		move.l  a1,-(sp)
		addq.l  #6,a1
		move.w  d1,d0
		ext.l   d0
		moveq   #2,d7
		bsr.w   sub_D19A
		movea.l (sp)+,a1
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		move.l  a1,-(sp)
		suba.w  #$C,a1
		move.w  d2,d0
		ext.l   d0
		movea.l (sp)+,a1
		moveq   #2,d7
		bsr.w   sub_D19A
		addq.l  #2,a1
		move.w  d3,d0
		ext.l   d0
		moveq   #2,d7
		bsr.w   sub_D19A
		rts

    ; End of function BuildMiniStatusWindow


; =============== S U B R O U T I N E =======================================

sub_D19A:
		cmpi.w  #$64,d0 
		bge.s   loc_D1A6
		bra.w   WriteTilesFromNumber
		bra.s   byte_D1AE
loc_D1A6:
		lea     byte_D1AE(pc), a0
		bra.w   WriteTilesFromAscii

    ; End of function sub_D19A

byte_D1AE:      dc.b $3F
		dc.b $3F
aTwoSpaces:     dc.b ' '
		dc.b ' '

; =============== S U B R O U T I N E =======================================

sub_D1B2:
		movem.l a1,-(sp)
		move.w  (a0)+,(a1)
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		move.w  (a0)+,(a1)
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		move.w  (a0)+,(a1)
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		move.w  (a0)+,(a1)
		adda.w  ((word_FFB7D8-$1000000)).w,a1
		move.w  (a0)+,(a1)
		movem.l (sp)+,a1
		addq.w  #2,a1
		rts

    ; End of function sub_D1B2


; =============== S U B R O U T I N E =======================================

sub_D1D8:
		movem.w d0-d3,-(sp)
		tst.w   d5
		beq.w   loc_D218
loc_D1E2:
		move.w  d4,d0
		cmpi.w  #8,d0
		blt.s   loc_D1EC
		moveq   #8,d0
loc_D1EC:
		move.w  d5,d1
		cmpi.w  #8,d1
		blt.s   loc_D1F6
		moveq   #8,d1
loc_D1F6:
		lea     wl_D28A(pc), a0
		mulu.w  #9,d1
		add.w   d1,d0
		add.w   d0,d0
		move.w  (a0,d0.w),(a1)+
		subq.w  #8,d4
		bge.s   loc_D20C
		clr.w   d4
loc_D20C:
		subq.w  #8,d5
		beq.s   loc_D214
		bgt.s   loc_D1E2
		bra.s   loc_D218
loc_D214:
		move.w  (wl_D28A,pc),(a1)+
loc_D218:
		movem.w (sp)+,d0-d3
		rts

    ; End of function sub_D1D8


; =============== S U B R O U T I N E =======================================

; In: D2 = current HP or MP value
;     D3 = max HP or MP value

CapMiniStatusBarLength:
		
		cmpi.w  #100,d2
		blt.s   @CheckMaxValue
		moveq   #100,d2
@CheckMaxValue:
		
		cmpi.w  #100,d3
		blt.s   @Return
		moveq   #100,d3
@Return:
		rts

    ; End of function CapMiniStatusBarLength

wl_D230:
        vdpBaseTile WINDOW_CORNER
		vdpBaseTile WINDOW_VERTICAL_BORDER
		vdpBaseTile WINDOW_VERTICAL_BORDER
		vdpBaseTile WINDOW_VERTICAL_BORDER
		vdpBaseTile WINDOW_CORNER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_UPPERCASE_H
		vdpBaseTile ASCII_UPPERCASE_M
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile MINISTATUS_P_WITH_BAR
		vdpBaseTile MINISTATUS_P_WITH_BAR
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT

wl_D24E:
        vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT

wl_D258:
        vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_NUMBER_ZERO
		vdpBaseTile ASCII_NUMBER_ZERO
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SLASH
		vdpBaseTile ASCII_SLASH
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_NUMBER_ZERO
		vdpBaseTile ASCII_NUMBER_ZERO
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_CORNER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_VERTICAL_BORDER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_VERTICAL_BORDER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_VERTICAL_BORDER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_CORNER|VDPTILE_MIRRORED_BIT|VDPTILE_FLIPPED_BIT

wl_D28A:
        vdpBaseTile STATUS_BAR_ED
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile STATUS_BAR_EC
		vdpBaseTile STATUS_BAR_EB
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile STATUS_BAR_EA
		vdpBaseTile STATUS_BAR_E9
		vdpBaseTile STATUS_BAR_E8
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile STATUS_BAR_E7
		vdpBaseTile STATUS_BAR_E6
		vdpBaseTile STATUS_BAR_E5
		vdpBaseTile STATUS_BAR_E4
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile STATUS_BAR_E3
		vdpBaseTile STATUS_BAR_E2
		vdpBaseTile STATUS_BAR_E1
		vdpBaseTile STATUS_BAR_E0
		vdpBaseTile STATUS_BAR_1F
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile STATUS_BAR_1E
		vdpBaseTile STATUS_BAR_1D
		vdpBaseTile STATUS_BAR_1C
		vdpBaseTile STATUS_BAR_1B
		vdpBaseTile STATUS_BAR_1A
		vdpBaseTile STATUS_BAR_19
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile STATUS_BAR_18
		vdpBaseTile STATUS_BAR_17
		vdpBaseTile STATUS_BAR_16
		vdpBaseTile STATUS_BAR_15
		vdpBaseTile STATUS_BAR_14
		vdpBaseTile STATUS_BAR_13
		vdpBaseTile STATUS_BAR_12
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile STATUS_BAR_11
		vdpBaseTile STATUS_BAR_10
		vdpBaseTile STATUS_BAR_F
		vdpBaseTile STATUS_BAR_E
		vdpBaseTile STATUS_BAR_D
		vdpBaseTile STATUS_BAR_C
		vdpBaseTile STATUS_BAR_B
		vdpBaseTile STATUS_BAR_A
		vdpBaseTile ASCII_SPACE
		vdpBaseTile STATUS_BAR_9
		vdpBaseTile STATUS_BAR_8
		vdpBaseTile STATUS_BAR_7
		vdpBaseTile STATUS_BAR_6
		vdpBaseTile STATUS_BAR_5
		vdpBaseTile STATUS_BAR_4
		vdpBaseTile STATUS_BAR_3
		vdpBaseTile STATUS_BAR_2
		vdpBaseTile STATUS_BAR_1

; =============== S U B R O U T I N E =======================================

; Show battle menu action refusal text

sub_D32C:
		movem.l d0-a1,-(sp)
		lea     pt_MiscMessageWindowLayouts(pc), a0
		lsl.w   #2,d0
		movea.l (a0,d0.w),a0
		move.w  (a0)+,d0
		lea     (WINDOW_LAYOUT_LOADING_SPACE).l,a1
		move.w  #$80,d7 
		jsr     (j_CopyBytes).l
		move.w  d0,d7
		lsr.w   #8,d7
		lsr.w   #1,d7
		neg.w   d7
		addi.w  #$10,d7
		lsl.w   #8,d7
		movem.w d0/d7,-(sp)
		lea     (WINDOW_LAYOUT_LOADING_SPACE).l,a0
		move.l  #$200C000C,d1
		or.w    d7,d1
		move.w  #8,d2
		bsr.w   MoveWindowWithSfx
		sndCom  SFX_REFUSAL
		jsr     (j_WaitForInputFor3Seconds).l
		movem.w (sp)+,d0/d7
		move.l  #$EA0C000C,d1
		or.w    d7,d1
		swap    d1
		move.w  #8,d2
		bsr.w   MoveWindowWithSfx
		movem.l (sp)+,d0-a1
		rts

    ; End of function sub_D32C

pt_MiscMessageWindowLayouts:
		dc.l MiscMessageWindowLayout0
		dc.l MiscMessageWindowLayout1
		dc.l MiscMessageWindowLayout2
		dc.l MiscMessageWindowLayout3
		dc.l MiscMessageWindowLayout4
		dc.l MiscMessageWindowLayout5
		dc.l MiscMessageWindowLayout6
		dc.l MiscMessageWindowLayout7
		dc.l MiscMessageWindowLayout8
MiscMessageWindowLayout0:
		incbin "data/graphics/tech/windowlayouts/miscmessages/miscmessagewindowlayout0.bin"
						; "No target."
MiscMessageWindowLayout1:
		incbin "data/graphics/tech/windowlayouts/miscmessages/miscmessagewindowlayout1.bin"
						; "No magic."
MiscMessageWindowLayout2:
		incbin "data/graphics/tech/windowlayouts/miscmessages/miscmessagewindowlayout2.bin"
						; "No item."
MiscMessageWindowLayout3:
		incbin "data/graphics/tech/windowlayouts/miscmessages/miscmessagewindowlayout3.bin"
						; "Not enough MP."
MiscMessageWindowLayout4:
		incbin "data/graphics/tech/windowlayouts/miscmessages/miscmessagewindowlayout4.bin"
						; "No equippable item."
MiscMessageWindowLayout5:
		incbin "data/graphics/tech/windowlayouts/miscmessages/miscmessagewindowlayout5.bin"
						; "The item loves you."
MiscMessageWindowLayout6:
		incbin "data/graphics/tech/windowlayouts/miscmessages/miscmessagewindowlayout6.bin"
						; "The item is cursed."
MiscMessageWindowLayout7:
		incbin "data/graphics/tech/windowlayouts/miscmessages/miscmessagewindowlayout7.bin"
						; "No! Keep the item."
MiscMessageWindowLayout8:
		incbin "data/graphics/tech/windowlayouts/miscmessages/miscmessagewindowlayout8.bin"
						; "You can't use it."

; =============== S U B R O U T I N E =======================================

sub_D75A:
		bsr.w   BuildBattleEquipStatsWindow
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$C09,d0
		move.l  #$112F412,d1
		move.w  #4,d2
		bra.w   MoveWindowWithSfx

    ; End of function sub_D75A


; =============== S U B R O U T I N E =======================================

sub_D774:
		tst.b   ((CURRENT_MENU-$1000000)).w
		bne.s   loc_D780
		move.w  #ITEMTYPE_MASK_WEAPON,d1
		bra.s   loc_D784
loc_D780:
		move.w  #ITEMTYPE_MASK_RING,d1
loc_D784:
		clr.w   d0
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		jsr     j_GetEquippedItemForCombatant
		move.w  d2,((word_FFBC5A-$1000000)).w
		move.w  d2,((word_FFBC5C-$1000000)).w
		move.w  d3,((word_FFBC58-$1000000)).w
		bne.s   loc_D7A4
		clr.w   d0
		bra.w   loc_D7D0
loc_D7A4:
		cmpi.w  #$FFFF,d3
		bne.s   loc_D7BC
		cmpi.w  #4,((TABLE_AT_FFA8C0-$1000000)).w
		bne.s   loc_D7B6
		clr.w   d0
		bra.s   loc_D7B8
loc_D7B6:
		moveq   #3,d0
loc_D7B8:
		bra.w   loc_D7D0
loc_D7BC:
		bsr.w   sub_DB76
		clr.w   d0
		lea     ((byte_FFA8C2-$1000000)).w,a0
loc_D7C6:
		cmp.w   (a0),d3
		beq.s   loc_D7D0
		addq.w  #1,d0
		addq.l  #4,a0
		bra.s   loc_D7C6
loc_D7D0:
		move.b  d0,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		move.w  d0,((word_FFBC5E-$1000000)).w
		move.b  d0,((byte_FFB529-$1000000)).w
		bsr.w   sub_DAE2
		bsr.w   sub_DB92
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$1106,d0
		bclr    #0,((byte_FFB4CA-$1000000)).w
		bne.s   loc_D7FC
		move.l  #$E1B0E15,d1
		bra.s   loc_D802
loc_D7FC:
		move.l  #$1E150E15,d1
loc_D802:
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		tst.w   (word_FFD902).l
		bne.w   loc_D82E
		bsr.w   BuildBattleEquipStatsWindow
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$C09,d0
		move.l  #$F4120112,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
loc_D82E:
		bsr.w   sub_DAE2
		bsr.w   sub_DA86
		bsr.w   sub_DB76
		moveq   #$F,d6
loc_D83C:
		btst    #INPUT_BIT_LEFT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_D85C
		cmpi.w  #2,((TABLE_AT_FFA8C0-$1000000)).w
		blt.s   loc_D85C
		move.b  #1,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_D8FA
loc_D85C:
		btst    #INPUT_BIT_RIGHT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_D87C
		cmpi.w  #3,((TABLE_AT_FFA8C0-$1000000)).w
		blt.s   loc_D87C
		move.b  #2,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_D8FA
loc_D87C:
		btst    #INPUT_BIT_UP,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_D892
		clr.b   ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_D8FA
loc_D892:
		btst    #INPUT_BIT_DOWN,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_D8AA
		move.b  #3,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_D8FA
loc_D8AA:
		btst    #INPUT_BIT_B,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_D8D0
		move.w  ((word_FFBC58-$1000000)).w,d2
		bsr.w   loc_DAC0
		bsr.w   BuildBattleEquipStatsWindow
		bsr.w   sub_DA28
		jsr     (j_WaitForVInt).l
		moveq   #-1,d0
		bra.w   loc_D9CC
loc_D8D0:
		btst    #INPUT_BIT_C,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_D8E4
		clr.w   d0
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d0
		bra.w   loc_D942
loc_D8E4:
		btst    #INPUT_BIT_A,(CURRENT_PLAYER_INPUT).l
		beq.w   loc_D92E
		clr.w   d0
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d0
		bra.w   loc_D942
loc_D8FA:
		bsr.w   sub_DAAA
		bsr.w   sub_DAE2
		bsr.w   sub_DA12
		jsr     (j_WaitForVInt).l
		moveq   #$13,d6
		bsr.w   sub_DA3E
		move.w  d6,-(sp)
		bsr.w   BuildBattleEquipStatsWindow
		bsr.w   sub_DA28
		jsr     (j_WaitForVInt).l
		bsr.w   sub_DA78
		bsr.w   sub_DB76
		move.w  (sp)+,d6
		bra.s   loc_D932
loc_D92E:
		bsr.w   sub_DA3E
loc_D932:
		jsr     (j_WaitForVInt).l
		subq.w  #1,d6
		bne.s   loc_D93E
		moveq   #$14,d6
loc_D93E:
		bra.w   loc_D83C
loc_D942:
		movem.w d0-d1,-(sp)
		move.w  ((word_FFBC5A-$1000000)).w,d1
		jsr     j_GetItemType
		btst    #ITEMTYPE_BIT_CURSED,d2
		beq.s   loc_D9A2
		move.w  ((word_FFBC5E-$1000000)).w,d3
		cmp.b   ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d3
		beq.s   loc_D9A0
		move.w  ((word_FFBC58-$1000000)).w,d2
		bsr.w   loc_DAC0
		bsr.w   PlayCursedItemMusic
		move.b  d3,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		bsr.w   sub_DAE2
		bsr.w   sub_DA12
		jsr     (j_WaitForVInt).l
		moveq   #$13,d6
		bsr.w   sub_DA3E
		bsr.w   BuildBattleEquipStatsWindow
		bsr.w   sub_DA28
		jsr     (j_WaitForVInt).l
		bsr.w   sub_DA78
		bsr.w   sub_DB76
		moveq   #5,d0           ; "The item loves you." refusal text
		bsr.w   sub_D32C        
loc_D9A0:
		bra.s   loc_D9C8
loc_D9A2:
		move.w  ((word_FFBC5C-$1000000)).w,d1
		jsr     j_GetItemType
		btst    #ITEMTYPE_BIT_CURSED,d2
		beq.s   loc_D9C8
		bsr.w   PlayCursedItemMusic
		moveq   #6,d0           ; "The item is cursed." refusal text
		bsr.w   sub_D32C        
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		moveq   #STATUSEFFECT_CURSE,d1
		jsr     j_SetStatusEffectsForCombatant
loc_D9C8:
		movem.w (sp)+,d0-d1
loc_D9CC:
		movem.w d0-d1,-(sp)
		clr.w   d6
		bsr.w   sub_DA3E
		bsr.w   sub_DAE2
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		movem.w (sp)+,d0-d1
		movem.w d0-d1,-(sp)
		cmpi.b  #$FF,d0
		beq.s   loc_D9F4
		move.l  #$E152015,d1
		bra.s   loc_DA00
loc_D9F4:
		move.l  #$E150E1C,d1
		bset    #0,((byte_FFB4CA-$1000000)).w
loc_DA00:
		move.w  #$1106,d0
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		movem.w (sp)+,d0-d1
		rts

    ; End of function sub_D774


; =============== S U B R O U T I N E =======================================

sub_DA12:
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$1106,d0
		move.l  #$E15,d1
		bsr.w   CreateWindow    
		bra.w   sub_AF66

    ; End of function sub_DA12


; =============== S U B R O U T I N E =======================================

sub_DA28:
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$C09,d0
		move.l  #$112,d1
		bsr.w   CreateWindow    
		bra.w   sub_AF66

    ; End of function sub_DA28


; =============== S U B R O U T I N E =======================================

sub_DA3E:
		lea     (SPRITE_00_PROPERTIES).l,a1
		lea     (spr_C792).l,a0
loc_DA4A:
		clr.w   d0
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d0
		lsl.w   #3,d0
		adda.w  d0,a0
		move.w  (a0)+,d0
		cmpi.w  #$A,d6
		bge.s   loc_DA5E
		moveq   #1,d0
loc_DA5E:
		btst    #INPUT_BIT_START,(P1_INPUT).l
		beq.s   loc_DA6A
		moveq   #1,d0
loc_DA6A:
		move.w  d0,(a1)+
		move.w  (a0)+,d0
		lsr.w   #8,d0
		move.b  d0,(a1)+
		addq.l  #1,a1
		move.l  (a0)+,(a1)+
		rts

    ; End of function sub_DA3E


; =============== S U B R O U T I N E =======================================

sub_DA78:
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d7
		cmp.b   ((byte_FFB529-$1000000)).w,d7
		beq.s   return_DAA8
		move.b  d7,((byte_FFB529-$1000000)).w

    ; End of function sub_DA78


; =============== S U B R O U T I N E =======================================

sub_DA86:
		tst.b   ((CURRENT_MENU-$1000000)).w
		bne.s   return_DAA8
		tst.b   ((byte_FFB53A-$1000000)).w
		bne.s   return_DAA8
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		jsr     j_FindTargetableSpacesForAttack
		moveq   #1,d0
		bsr.w   sub_AB9C
		jsr     (j_WaitForVInt).l
return_DAA8:
		rts

    ; End of function sub_DA86


; =============== S U B R O U T I N E =======================================

sub_DAAA:
		lea     ((byte_FFA8C2-$1000000)).w,a0
		clr.w   d2
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d2
		lsl.w   #2,d2
		move.w  2(a0,d2.w),((word_FFBC5C-$1000000)).w
		move.w  (a0,d2.w),d2
loc_DAC0:
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		tst.b   ((CURRENT_MENU-$1000000)).w
		bne.s   loc_DAD0
		move.w  #$100,d1
		bra.s   loc_DAD4
loc_DAD0:
		move.w  #$200,d1
loc_DAD4:
		jmp     j_EquipItemForCombatant

    ; End of function sub_DAAA

		dc.b 0
		dc.b $AE
		dc.b 0
		dc.b $AE
		dc.b 0
		dc.b $62
		dc.b 0
		dc.b $88

; =============== S U B R O U T I N E =======================================

sub_DAE2:
		bsr.w   sub_DB76
		lea     wl_BattleEquip_ItemName(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$CC,d7 
		jsr     (j_CopyBytes).l
		bra.w   loc_DCA4

    ; End of function sub_DAE2


; =============== S U B R O U T I N E =======================================

BuildBattleEquipStatsWindow:
		
		lea     wl_BattleEquip_Stats(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$D8,d7 
		jsr     (j_CopyBytes).l
		clr.w   d0
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		move.w  d0,((CURRENT_OBJECT-$1000000)).w
		jsr     j_GetModifiedAttack
		lea     ((byte_FFB804-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetModifiedDefense
		lea     ((byte_FFB834-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetModifiedMove
		lea     ((byte_FFB864-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
		move.w  ((CURRENT_OBJECT-$1000000)).w,d0
		jsr     j_GetModifiedAgility
		lea     ((byte_FFB894-$1000000)).w,a1
		moveq   #2,d7
		move.w  d1,d0
		ext.l   d0
		bsr.w   WriteTilesFromNumber
		rts

    ; End of function BuildBattleEquipStatsWindow


; =============== S U B R O U T I N E =======================================

sub_DB76:
		tst.b   ((CURRENT_MENU-$1000000)).w
		bne.s   loc_DB82
		move.w  #ITEMTYPE_MASK_WEAPON,d1
		bra.s   loc_DB86
loc_DB82:
		move.w  #ITEMTYPE_MASK_RING,d1
loc_DB86:
		clr.w   d0
		move.b  ((byte_FFB4C9-$1000000)).w,d0
		jmp     j_LoadEquippableItemsForCombatant

    ; End of function sub_DB76


; =============== S U B R O U T I N E =======================================

sub_DB92:
		bsr.s   sub_DB76
		move.w  ((TABLE_AT_FFA8C0-$1000000)).w,d7
		subq.w  #1,d7
		lea     ((byte_FFA8C2-$1000000)).w,a3
		clr.w   d1
		bsr.w   sub_DC6E
		lea     (FF3000_LOADING_SPACE).l,a1
		move.w  #ICONTILES_BYTESIZE,d7
		jsr     (j_CopyBytes).l
		adda.w  #ICONTILES_BYTESIZE,a1
		move.l  a1,-(sp)
		move.w  #$BF,d0 
loc_DBBE:
		clr.l   (a1)+
		dbf     d0,loc_DBBE

		movea.l (sp)+,a1
		moveq   #1,d1
		bsr.w   sub_DC6E
		moveq   #5,d7
loc_DBCE:
		move.l  (a0)+,$10(a1)
		move.l  (a0)+,$14(a1)
		move.l  (a0)+,$18(a1)
		move.l  (a0)+,$1C(a1)
		move.l  (a0)+,$40(a1)
		move.l  (a0)+,$44(a1)
		move.l  (a0)+,$48(a1)
		move.l  (a0)+,$4C(a1)
		adda.w  #$20,a1 
		dbf     d7,loc_DBCE

		adda.w  #$40,a1 
		moveq   #2,d1
		bsr.w   sub_DC6E
		moveq   #5,d7
loc_DC02:
		move.l  (a0)+,$10(a1)
		move.l  (a0)+,$14(a1)
		move.l  (a0)+,$18(a1)
		move.l  (a0)+,$1C(a1)
		move.l  (a0)+,$40(a1)
		move.l  (a0)+,$44(a1)
		move.l  (a0)+,$48(a1)
		move.l  (a0)+,$4C(a1)
		adda.w  #$20,a1 
		dbf     d7,loc_DC02

		adda.w  #$40,a1 
		moveq   #3,d1
		bsr.w   sub_DC6E
		move.w  #ICONTILES_BYTESIZE,d7
		jsr     (j_CopyBytes).l
		adda.w  #ICONTILES_BYTESIZE,a1
		lea     IconHighlightTiles(pc), a0
		move.w  #$200,d7
		jsr     (j_CopyBytes).l
		lea     (FF3000_LOADING_SPACE).l,a0
		lea     ($F800).l,a1
		move.w  #$400,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jmp     (j_WaitForDmaQueueProcessing).l

    ; End of function sub_DB92


; =============== S U B R O U T I N E =======================================

sub_DC6E:
		movea.l (p_ItemIcons).l,a0
		cmp.w   ((TABLE_AT_FFA8C0-$1000000)).w,d1
		blt.s   loc_DC8E
		adda.l  #$2F40,a0
		cmpi.w  #3,d1
		bne.s   loc_DC8C
		adda.l  #$C0,a0 
loc_DC8C:
		bra.s   return_DCA2
loc_DC8E:
		lsl.w   #2,d1
		move.w  2(a3,d1.w),d1
		andi.w  #ITEMENTRY_MASK_INDEX,d1
		move.w  d1,d7
		add.w   d1,d1
		add.w   d7,d1
		lsl.w   #6,d1
		adda.w  d1,a0
return_DCA2:
		rts

    ; End of function sub_DC6E


; START OF FUNCTION CHUNK FOR sub_DAE2

loc_DCA4:
		lea     aWeaponring_0(pc), a0
		lea     ((byte_FFB82E-$1000000)).w,a1
		btst    #0,((CURRENT_MENU-$1000000)).w
		beq.s   loc_DCB6
		addq.w  #6,a0
loc_DCB6:
		moveq   #6,d7
		moveq   #-34,d1
		bsr.w   WriteTilesFromAscii
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
		cmpi.w  #4,((TABLE_AT_FFA8C0-$1000000)).w
		beq.w   loc_DCDE
		cmpi.w  #3,d1
		bne.s   loc_DCDE
		lea     byte_DD0A(pc), a0
		nop
		moveq   #6,d7
		bra.s   loc_DCF0
loc_DCDE:
		lea     ((byte_FFA8C2-$1000000)).w,a0
		lsl.w   #2,d1
		move.w  2(a0,d1.w),d1
		jsr     j_GetItemNameAddress
		move.w  d1,d7
loc_DCF0:
		lea     ((byte_FFB850-$1000000)).w,a1
		moveq   #-34,d1
		bra.w   WriteTilesFromAscii

; END OF FUNCTION CHUNK FOR sub_DAE2


; =============== S U B R O U T I N E =======================================

PlayCursedItemMusic:
		
		 
		sndCom  MUSIC_CURSED_ITEM
		move.w  #$FB,d0 
		jsr     (j_PlayMusicAfterCurrentOne).l
		rts

    ; End of function PlayCursedItemMusic

byte_DD0A:      dc.b VDPTILE_ORANGE_UPPERCASE_R
		dc.b VDPTILE_ORANGE_UPPERCASE_E
		dc.b VDPTILE_ORANGE_UPPERCASE_M
		dc.b VDPTILE_ORANGE_UPPERCASE_O
		dc.b VDPTILE_ORANGE_UPPERCASE_V
		dc.b VDPTILE_ORANGE_UPPERCASE_E
aWeaponring_0:  dc.b 'WEAPONRING',0,0
wl_BattleEquip_Stats:
		vdpBaseTile WINDOW_CORNER
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile WINDOW_HORIZONTAL_BORDER
		vdpBaseTile WINDOW_CORNER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_VERTICAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_UPPERCASE_A
		vdpBaseTile ASCII_UPPERCASE_T
		vdpBaseTile ASCII_UPPERCASE_T
		vdpBaseTile ASCII_UPPERCASE_A
		vdpBaseTile ASCII_UPPERCASE_C
		vdpBaseTile ASCII_UPPERCASE_K
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_NUMBER_NINE
		vdpBaseTile ASCII_NUMBER_NINE
		vdpBaseTile WINDOW_VERTICAL_BORDER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_VERTICAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile WINDOW_VERTICAL_BORDER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_VERTICAL_BORDER
		vdpBaseTile ASCII_UPPERCASE_D
		vdpBaseTile ASCII_UPPERCASE_E
		vdpBaseTile ASCII_UPPERCASE_F
		vdpBaseTile ASCII_UPPERCASE_E
		vdpBaseTile ASCII_UPPERCASE_N
		vdpBaseTile ASCII_UPPERCASE_S
		vdpBaseTile ASCII_UPPERCASE_E
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_NUMBER_NINE
		vdpBaseTile ASCII_NUMBER_NINE
		vdpBaseTile WINDOW_VERTICAL_BORDER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_VERTICAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile WINDOW_VERTICAL_BORDER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_VERTICAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_UPPERCASE_M
		vdpBaseTile ASCII_UPPERCASE_O
		vdpBaseTile ASCII_UPPERCASE_V
		vdpBaseTile ASCII_UPPERCASE_E
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_NUMBER_NINE
		vdpBaseTile ASCII_NUMBER_NINE
		vdpBaseTile WINDOW_VERTICAL_BORDER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_VERTICAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile WINDOW_VERTICAL_BORDER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_VERTICAL_BORDER
		vdpBaseTile ASCII_UPPERCASE_A
		vdpBaseTile ASCII_UPPERCASE_G
		vdpBaseTile ASCII_UPPERCASE_I
		vdpBaseTile ASCII_UPPERCASE_L
		vdpBaseTile ASCII_UPPERCASE_I
		vdpBaseTile ASCII_UPPERCASE_T
		vdpBaseTile ASCII_UPPERCASE_Y
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_NUMBER_NINE
		vdpBaseTile ASCII_NUMBER_NINE
		vdpBaseTile WINDOW_VERTICAL_BORDER|VDPTILE_MIRRORED_BIT
		vdpBaseTile WINDOW_CORNER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_CORNER|VDPTILE_MIRRORED_BIT|VDPTILE_FLIPPED_BIT
wl_BattleEquip_ItemName:
		dc.w $C000
		dc.w $C000
		dc.w $C7C0
		dc.w $C7C1
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $C7C6
		dc.w $C7C7
		dc.w $C7C2
		dc.w $C7C3
		dc.w $C7CE
		dc.w $C7CF
		dc.w $C000
		dc.w $C080
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C880
		dc.w $C7C8
		dc.w $C7C9
		dc.w $C7C4
		dc.w $C7C5
		dc.w $C7D0
		dc.w $C7D1
		dc.w $C000
		dc.w $C090
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C890
		dc.w $C7CA
		dc.w $C7CB
		dc.w $C7D6
		dc.w $C7D7
		dc.w $C7D2
		dc.w $C7D3
		dc.w $C000
		dc.w $C090
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C890
		dc.w $C7CC
		dc.w $C7CD
		dc.w $C7D8
		dc.w $C7D9
		dc.w $C7D4
		dc.w $C7D5
		dc.w $C000
		dc.w $C090
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C890
		dc.w $C000
		dc.w $C000
		dc.w $C7DA
		dc.w $C7DB
		dc.w $C000
		dc.w $C000
		dc.w $C000
		dc.w $D080
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D081
		dc.w $D880

; =============== S U B R O U T I N E =======================================

sub_DEC0:
		movem.l d0-a1,-(sp)
		bsr.w   BuildLandEffectWindow
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$806,d0
		move.l  #$F8010101,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		movem.l (sp)+,d0-a1
		rts

    ; End of function sub_DEC0


; =============== S U B R O U T I N E =======================================

sub_DEE4:
		movem.l d0-a1,-(sp)
		bsr.w   BuildLandEffectWindow
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$806,d0
		move.l  #$101F801,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		movem.l (sp)+,d0-a1
		rts

    ; End of function sub_DEE4


; =============== S U B R O U T I N E =======================================

CreateLandEffectWindow:
		
		movem.l d0-a1,-(sp)
		bsr.w   BuildLandEffectWindow
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$806,d0
		move.l  #$101,d1
		move.w  #8,d2
		bsr.w   CreateWindow    
		bsr.w   sub_AF66
		movem.l (sp)+,d0-a1
		rts

    ; End of function CreateLandEffectWindow


; =============== S U B R O U T I N E =======================================

BuildLandEffectWindow:
		
		lea     wl_LandEffect(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$60,d7 
		jsr     (j_CopyBytes).l
		clr.w   d0
		clr.w   d1
		clr.w   d2
		move.b  ((byte_FFB4C5-$1000000)).w,d0
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d2
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d1
		jsr     j_GetLandEffectAtPosition
		move.w  d1,-(sp)
		lea     aLandEffect(pc), a0
		lea     ((byte_FFB7EC-$1000000)).w,a1
		moveq   #-16,d1
		clr.w   d7
		move.b  (a0)+,d7
		bsr.w   WriteTilesFromAscii
		move.w  (sp)+,d0
		ext.l   d0
		moveq   #2,d7
		lea     ((byte_FFB822-$1000000)).w,a1
		bsr.w   WriteTilesFromNumber
		rts

    ; End of function BuildLandEffectWindow

aLandEffect:    dc.b $C,'Land',9,'Effect',0,$FF
wl_LandEffect:  incbin "data/graphics/tech/windowlayouts/wl-landeffect.bin"

; =============== S U B R O U T I N E =======================================

sub_DFEC:
		clr.b   ((IS_DISPLAYING_PORTRAIT-$1000000)).w
		jsr     (j_WaitForVInt).l
		move.w  d0,-(sp)
		btst    #0,d0
		bne.s   loc_E002
		clr.w   d1
loc_E000:
		bra.s   loc_E004
loc_E002:
		moveq   #1,d1
loc_E004:
		lea     ((byte_FFB54E-$1000000)).w,a2
		move.w  ((word_FFB54C-$1000000)).w,d7
		bsr.w   sub_E0B4
		move.w  (sp)+,d0
		btst    #1,d0
		bne.s   loc_E01C
		clr.w   d1
		bra.s   loc_E01E
loc_E01C:
		moveq   #1,d1
loc_E01E:
		lea     ((byte_FFB56E-$1000000)).w,a2
		move.w  ((word_FFB56C-$1000000)).w,d7
		bsr.w   sub_E0B4
		rts

    ; End of function sub_DFEC


; =============== S U B R O U T I N E =======================================

sub_E02C:
		tst.b   ((IS_DISPLAYING_PORTRAIT-$1000000)).w
		beq.w   return_E0B2
		lea     ((word_FFB56A-$1000000)).w,a0
		subq.w  #1,(a0)
		cmpi.w  #3,(a0)
		bne.s   loc_E04E
		moveq   #1,d1
		lea     ((byte_FFB54E-$1000000)).w,a2
		move.w  ((word_FFB54C-$1000000)).w,d7
		bsr.w   sub_E0B4
loc_E04E:
		tst.w   (a0)
		bne.s   loc_E06E
		clr.w   d1
		lea     ((byte_FFB54E-$1000000)).w,a2
		move.w  ((word_FFB54C-$1000000)).w,d7
		bsr.w   sub_E0B4
		moveq   #$78,d6 
		jsr     (j_GenerateRandomNumber).l
		addi.w  #$1E,d7
		move.w  d7,(a0)
loc_E06E:
		lea     ((word_FFB58A-$1000000)).w,a0
		tst.b   ((CURRENTLY_TYPEWRITING-$1000000)).w
		bne.s   loc_E07C
		clr.w   (a0)
		bra.s   loc_E096
loc_E07C:
		subq.w  #1,(a0)
		cmpi.w  #5,(a0)
		bne.s   loc_E092
		moveq   #1,d1
		lea     ((byte_FFB56E-$1000000)).w,a2
		move.w  ((word_FFB56C-$1000000)).w,d7
		bsr.w   sub_E0B4
loc_E092:
		tst.w   (a0)
		bne.s   return_E0B2
loc_E096:
		clr.w   d1
		lea     ((byte_FFB56E-$1000000)).w,a2
		move.w  ((word_FFB56C-$1000000)).w,d7
		bsr.w   sub_E0B4
		moveq   #5,d6
		jsr     (j_GenerateRandomNumber).l
		addi.w  #$A,d7
		move.w  d7,(a0)
return_E0B2:
		rts

    ; End of function sub_E02C


; =============== S U B R O U T I N E =======================================

sub_E0B4:
		bne.s   loc_E0B8
		rts
loc_E0B8:
		subq.w  #1,d7
loc_E0BA:
		move.w  d7,-(sp)
		clr.w   d5
		clr.w   d6
		move.b  (a2)+,d5
		move.b  (a2)+,d6
		move.w  (a2)+,d0
		tst.w   d1
		bne.s   loc_E0D8
		move.w  d6,d0
		mulu.w  #6,d0
		add.w   d5,d0
		add.w   d0,d0
		move.w  unk_E0F6(pc,d0.w),d0
loc_E0D8:
		or.w    ((word_FFB5AE-$1000000)).w,d0
		add.w   ((word_FFB548-$1000000)).w,d5
		add.w   ((word_FFB54A-$1000000)).w,d6
		jsr     (sub_248).l
		move.w  (sp)+,d7
		dbf     d7,loc_E0BA

		jmp     (j_RequestVdpCommandQueueProcessing).l

    ; End of function sub_E0B4

unk_E0F6:       dc.b $85 
		dc.b $C0 
		dc.b $85 
		dc.b $C4 
		dc.b $85 
		dc.b $C8 
		dc.b $85 
		dc.b $CC 
		dc.b $85 
		dc.b $E0 
		dc.b $85 
		dc.b $E4 
		dc.b $85 
		dc.b $C1 
		dc.b $85 
		dc.b $C5 
		dc.b $85 
		dc.b $C9 
		dc.b $85 
		dc.b $CD 
		dc.b $85 
		dc.b $E1 
		dc.b $85 
		dc.b $E5 
		dc.b $85 
		dc.b $C2 
		dc.b $85 
		dc.b $C6 
		dc.b $85 
		dc.b $CA 
		dc.b $85 
		dc.b $CE 
		dc.b $85 
		dc.b $E2 
		dc.b $85 
		dc.b $E6 
		dc.b $85 
		dc.b $C3 
		dc.b $85 
		dc.b $C7 
		dc.b $85 
		dc.b $CB 
		dc.b $85 
		dc.b $CF 
		dc.b $85 
		dc.b $E3 
		dc.b $85 
		dc.b $E7 
		dc.b $85 
		dc.b $D0 
		dc.b $85 
		dc.b $D4 
		dc.b $85 
		dc.b $D8 
		dc.b $85 
		dc.b $DC 
		dc.b $85 
		dc.b $F0 
		dc.b $85 
		dc.b $F4 
		dc.b $85 
		dc.b $D1 
		dc.b $85 
		dc.b $D5 
		dc.b $85 
		dc.b $D9 
		dc.b $85 
		dc.b $DD 
		dc.b $85 
		dc.b $F1 
		dc.b $85 
		dc.b $F5 
		dc.b $85 
		dc.b $D2 
		dc.b $85 
		dc.b $D6 
		dc.b $85 
		dc.b $DA 
		dc.b $85 
		dc.b $DE 
		dc.b $85 
		dc.b $F2 
		dc.b $85 
		dc.b $F6 
		dc.b $85 
		dc.b $D3 
		dc.b $85 
		dc.b $D7 
		dc.b $85 
		dc.b $DB 
		dc.b $85 
		dc.b $DF 
		dc.b $85 
		dc.b $F3 
		dc.b $85 
		dc.b $F7 

; =============== S U B R O U T I N E =======================================

; Load portrait tiles.

LoadPortrait:
		movea.l (p_pt_Portraits).l,a0
		lsl.w   #2,d0
		movea.l (a0,d0.w),a0
		move.w  (a0)+,d0
		move.w  d0,((word_FFB54C-$1000000)).w
		beq.s   loc_E176
		subq.w  #1,d0
		lea     ((byte_FFB54E-$1000000)).w,a1
loc_E170:
		move.l  (a0)+,(a1)+
		dbf     d0,loc_E170
loc_E176:
		move.w  (a0)+,d0
		move.w  d0,((word_FFB56C-$1000000)).w
		beq.s   loc_E18A
		subq.w  #1,d0
		lea     ((byte_FFB56E-$1000000)).w,a1
loc_E184:
		move.l  (a0)+,(a1)+
		dbf     d0,loc_E184
loc_E18A:
		lea     ((byte_FFB58C-$1000000)).w,a1
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		lea     ($B800).l,a1
		move.w  #$380,d0
		jsr     (j_ApplyVIntVramDmaOnCompressedTiles).l
		jmp     (j_EnableDmaQueueProcessing).l

    ; End of function LoadPortrait


; =============== S U B R O U T I N E =======================================

sub_E1B4:
		move.w  #$85C0,((word_FFB5AE-$1000000)).w
		move.w  #2,((word_FFB548-$1000000)).w
		move.w  #2,((word_FFB54A-$1000000)).w
		move.w  #$14,((word_FFB56A-$1000000)).w
		move.w  #$14,((word_FFB58A-$1000000)).w
		movem.l d7-a1,-(sp)
		lea     wl_Portrait2(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$A0,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$80A,d0
		move.l  #$1F60101,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		move.b  #1,((IS_DISPLAYING_PORTRAIT-$1000000)).w
		rts

    ; End of function sub_E1B4


; =============== S U B R O U T I N E =======================================

OpenPortraitWindow:
		
		move.w  d0,-(sp)
		bsr.w   LoadPortrait    
		jsr     (j_WaitForVInt).l
		lea     ((byte_FFB58C-$1000000)).w,a0
		lea     (PALETTE_2_CURRENT).l,a1
		moveq   #7,d7
loc_E222:
		move.l  (a0)+,(a1)+
		dbf     d7,loc_E222

		jsr     (j_ApplyVIntCramDma).l
		move.w  #$A5C0,((word_FFB5AE-$1000000)).w
		move.w  #2,((word_FFB548-$1000000)).w
		move.w  #2,((word_FFB54A-$1000000)).w
		move.w  #$14,((word_FFB56A-$1000000)).w
		move.w  #$14,((word_FFB58A-$1000000)).w
		movem.l d7-a1,-(sp)
		lea     wl_Portrait1(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$A0,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$80A,d0
		move.l  #$1F60101,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		move.b  #1,((IS_DISPLAYING_PORTRAIT-$1000000)).w
		move.w  (sp)+,d0
		rts

    ; End of function OpenPortraitWindow


; =============== S U B R O U T I N E =======================================

ClosePortraitWindow:
		
		movem.w d0,-(sp)
		clr.b   ((IS_DISPLAYING_PORTRAIT-$1000000)).w
		movem.l d7-a1,-(sp)
		lea     wl_Portrait1(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$A0,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$80A,d0
		move.l  #$10101F6,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		move.w  (sp)+,d0
		rts

    ; End of function ClosePortraitWindow


; =============== S U B R O U T I N E =======================================

sub_E2C2:
		movem.w d0,-(sp)
		bsr.s   BuildSpeakerNameWindow
		move.l  #$F60B000B,d1
		bsr.w   MoveWindowWithSfx
		move.w  (sp)+,d0
		rts

    ; End of function sub_E2C2


; =============== S U B R O U T I N E =======================================

sub_E2D6:
		move.w  d0,-(sp)
		bsr.s   BuildSpeakerNameWindow
		move.l  #$BF60B,d1
		bsr.w   MoveWindowWithSfx
		move.w  (sp)+,d0
		rts

    ; End of function sub_E2D6


; =============== S U B R O U T I N E =======================================

BuildSpeakerNameWindow:
		
		movem.l d7-a1,-(sp)
		lea     wl_SpeakerName(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$3C,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		jsr     j_GetEntityStatsAddress
		move.w  d1,d7
		lea     ((CURRENT_SPEAKER_NAME_VDPTILES-$1000000)).w,a1
		moveq   #-16,d1
		bsr.w   WriteTilesFromAscii
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$A03,d0
		move.w  #4,d2
		rts

    ; End of function BuildSpeakerNameWindow

wl_Portrait1:   incbin "data/graphics/tech/windowlayouts/wl-portrait1.bin"
wl_Portrait2:   incbin "data/graphics/tech/windowlayouts/wl-portrait2.bin"
wl_SpeakerName: incbin "data/graphics/tech/windowlayouts/wl-speakername.bin"

; =============== S U B R O U T I N E =======================================

; Out: D0 = selected item index if it exists, else D0 = $FFFFFFFF

sub_E49E:
		clr.w   ((word_FFA940-$1000000)).w
		clr.w   ((word_FFA942-$1000000)).w
		movem.l d7-a1,-(sp)
		lea     wl_ShopInventory(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$144,d7
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		bsr.w   sub_E71A
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$1B06,d0
		move.l  #$2F70201,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		lea     ShopIconHighlightTiles(pc), a0
		lea     ($FE00).l,a1
		move.w  #$100,d0
		jsr     (j_ApplyVIntVramDmaOnCompressedTiles).l
		jsr     (j_WaitForDmaQueueProcessing).l
		moveq   #$14,d1
		bsr.w   sub_EA04
loc_E4FA:
		move.w  ((word_FFA942-$1000000)).w,d0
		btst    #INPUT_BIT_RIGHT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_E546
		move.w  ((word_FFA940-$1000000)).w,d2
		mulu.w  #6,d2
		add.w   d0,d2
		addq.w  #1,d2
		cmp.w   ((SHOP_INVENTORY_LENGTH-$1000000)).w,d2
		bge.s   loc_E546
		addq.w  #1,d0
		sndCom  SFX_MENU_SELECTION
		cmp.w   ((word_FFA944-$1000000)).w,d0
		blt.s   loc_E53A
		addq.w  #1,((word_FFA940-$1000000)).w
		clr.w   ((word_FFA942-$1000000)).w
		clr.b   ((byte_FFB4D8-$1000000)).w
		bsr.w   sub_E992
		bra.w   loc_E62C
loc_E53A:
		move.w  d0,((word_FFA942-$1000000)).w
		bsr.w   sub_E9F0
		bra.w   loc_E62C
loc_E546:
		move.w  ((word_FFA942-$1000000)).w,d0
		btst    #INPUT_BIT_LEFT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_E58C
		move.w  ((word_FFA940-$1000000)).w,d2
		mulu.w  #6,d2
		add.w   d0,d2
		ble.s   loc_E58C
		subq.w  #1,d0
		sndCom  SFX_MENU_SELECTION
		bge.s   loc_E580
		subq.w  #1,((word_FFA940-$1000000)).w
		move.w  #5,((word_FFA942-$1000000)).w
		move.b  #1,((byte_FFB4D8-$1000000)).w
		bsr.w   sub_E992
		bra.w   loc_E62C
loc_E580:
		move.w  d0,((word_FFA942-$1000000)).w
		bsr.w   sub_E9F0
		bra.w   loc_E62C
loc_E58C:
		btst    #INPUT_BIT_UP,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_E5AE
		tst.w   ((word_FFA940-$1000000)).w
		beq.s   loc_E5AE
		subq.w  #1,((word_FFA940-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		move.b  #1,((byte_FFB4D8-$1000000)).w
		bsr.w   sub_E992
loc_E5AE:
		btst    #INPUT_BIT_DOWN,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_E608
		move.w  ((word_FFA940-$1000000)).w,d2
		addq.w  #1,d2
		mulu.w  #6,d2
		cmp.w   ((SHOP_INVENTORY_LENGTH-$1000000)).w,d2
		bge.s   loc_E608
		addq.w  #1,((word_FFA940-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		move.w  ((word_FFA942-$1000000)).w,d0
		move.w  ((word_FFA940-$1000000)).w,d2
		move.w  d2,d1
		add.w   d2,d2
		add.w   d1,d2
		add.w   d2,d2
		move.w  ((SHOP_INVENTORY_LENGTH-$1000000)).w,d1
		sub.w   d2,d1
		cmpi.w  #6,d1
		ble.s   loc_E5EE
		moveq   #6,d1
loc_E5EE:
		move.w  d1,((word_FFA944-$1000000)).w
loc_E5F2:
		cmp.w   d1,d0
		blt.w   loc_E5FC
		subq.w  #1,d0
		bne.s   loc_E5F2
loc_E5FC:
		move.w  d0,((word_FFA942-$1000000)).w
		clr.b   ((byte_FFB4D8-$1000000)).w
		bsr.w   sub_E992
loc_E608:
		btst    #INPUT_BIT_B,(CURRENT_PLAYER_INPUT).l
		bne.w   loc_E63A
		btst    #INPUT_BIT_C,(CURRENT_PLAYER_INPUT).l
		bne.w   loc_E640
		btst    #INPUT_BIT_A,(CURRENT_PLAYER_INPUT).l
		bne.w   loc_E640
loc_E62C:
		bsr.w   sub_E67A
		jsr     (j_WaitForVInt).l
		bra.w   loc_E4FA
loc_E63A:
		moveq   #-1,d0
		bra.w   loc_E656        
loc_E640:
		move.w  ((word_FFA940-$1000000)).w,d0
		mulu.w  #6,d0
		add.w   ((word_FFA942-$1000000)).w,d0
		lea     ((TABLE_AT_FFA8C0-$1000000)).w,a0
						; shop inventory
		add.w   d0,d0
		move.w  (a0,d0.w),d0
loc_E656:
		move.w  d0,-(sp)        ; save selected item index
		clr.w   d1
		bsr.s   sub_E67A
		bsr.w   sub_AF84
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$1B06,d0
		move.l  #$20102F7,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		move.w  (sp)+,d0        ; restore selected item index -> D0
		rts

    ; End of function sub_E49E


; =============== S U B R O U T I N E =======================================

sub_E67A:
		lea     (SPRITE_19_PROPERTIES).l,a0
		cmpi.w  #7,d1
		bge.s   loc_E692
		move.w  #1,(a0)
		move.w  #1,6(a0)
		bra.s   loc_E6A4
loc_E692:
		move.w  ((word_FFA942-$1000000)).w,d0
		lsl.w   #5,d0
		addi.w  #$9C,d0 
		move.w  d0,6(a0)
		move.w  #$91,(a0) 
loc_E6A4:
		move.b  #$F,2(a0)
		move.w  #$C7F0,4(a0)
		addq.l  #8,a0
		move.w  #1,(a0)
		move.w  #1,6(a0)
		tst.w   ((word_FFA940-$1000000)).w
		beq.s   loc_E6DC
		cmpi.w  #7,d1
		blt.s   loc_E6DC
		move.w  #$98,6(a0) 
		move.w  #$90,(a0) 
		clr.b   2(a0)
		move.w  #$D084,4(a0)
loc_E6DC:
		addq.l  #8,a0
		move.w  #1,(a0)
		move.w  #1,6(a0)
		move.w  ((word_FFA940-$1000000)).w,d0
		addq.w  #1,d0
		mulu.w  #6,d0
		cmp.w   ((SHOP_INVENTORY_LENGTH-$1000000)).w,d0
		bge.s   loc_E712
		cmpi.w  #7,d1
		blt.s   loc_E712
		move.w  #$158,6(a0)
		move.w  #$A8,(a0) 
		clr.b   2(a0)
		move.w  #$C084,4(a0)
loc_E712:
		subq.w  #1,d1
		bne.s   return_E718
		moveq   #$14,d1
return_E718:
		rts

    ; End of function sub_E67A


; =============== S U B R O U T I N E =======================================

sub_E71A:
		lea     (byte_FF113E).l,a0
		move.w  #$63F,d7
loc_E724:
		move.l  #$DDDDDDDD,(a0)+
		dbf     d7,loc_E724

		lea     ((TABLE_AT_FFA8C0-$1000000)).w,a1
						; shop inventory
		move.w  ((word_FFA940-$1000000)).w,d0
		move.w  d0,d1
		add.w   d0,d0
		add.w   d1,d0
		add.w   d0,d0
		adda.w  d0,a1
		adda.w  d0,a1
		move.w  ((SHOP_INVENTORY_LENGTH-$1000000)).w,d1
		sub.w   d0,d1
		cmpi.w  #6,d1
		ble.s   loc_E750
		moveq   #6,d1
loc_E750:
		move.w  d1,((word_FFA944-$1000000)).w
		move.w  d1,d7
		subq.w  #1,d7
		lea     (FF0FFE_LOADING_SPACE).l,a0
		lea     ((byte_FFB816-$1000000)).w,a2
loc_E762:
		move.w  (a1)+,d0
		move.w  d7,-(sp)
		bsr.w   sub_E802
		jsr     j_GetItemPrice
		move.w  d2,d0
		bsr.w   sub_E7A2
		move.w  #$C024,(a2)
		addq.l  #8,a2
		move.w  (sp)+,d7
		dbf     d7,loc_E762

		lea     (FF0FFE_LOADING_SPACE).l,a0
		lea     ($B800).l,a1
		move.w  #$3C0,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jsr     (j_WaitForDmaQueueProcessing).l
		rts

    ; End of function sub_E71A


; =============== S U B R O U T I N E =======================================

sub_E7A2:
		movem.l a1-a2,-(sp)
		andi.l  #$FFFF,d0
		move.l  a0,-(sp)
		lea     dword_F06A(pc), a1
		moveq   #$1F,d7
loc_E7B4:
		move.l  (a1)+,(a0)+
		dbf     d7,loc_E7B4

		movea.l (sp)+,a0
		adda.w  #$14,a0
		jsr     (j_WriteAsciiNumber).l
		lea     (byte_FF0E85).l,a2
		moveq   #4,d7
loc_E7CE:
		clr.w   d0
		move.b  (a2)+,d0
		cmpi.w  #$20,d0 
		beq.s   loc_E7F2
		subi.w  #$30,d0 
		mulu.w  #$14,d0
		lea     dword_F0EA(pc), a1
		adda.w  d0,a1
		move.l  (a1)+,(a0)+
		move.l  (a1)+,(a0)+
		move.l  (a1)+,(a0)+
		move.l  (a1)+,(a0)+
		move.l  (a1)+,(a0)+
		bra.s   loc_E7F6
loc_E7F2:
		adda.w  #$14,a0
loc_E7F6:
		dbf     d7,loc_E7CE

		addq.w  #8,a0
		movem.l (sp)+,a1-a2
		rts

    ; End of function sub_E7A2


; =============== S U B R O U T I N E =======================================

sub_E802:
		move.l  a1,-(sp)
		move.w  d0,-(sp)
		movea.l (p_ItemIcons).l,a1
		move.w  d0,d1
		add.w   d0,d0
		add.w   d1,d0
		lsl.w   #6,d0
		adda.w  d0,a1
		moveq   #$2F,d7 
loc_E818:
		move.l  (a1)+,(a0)+
		dbf     d7,loc_E818

		ori.w   #$D,-2(a0)
		ori.w   #$D000,-$24(a0)
		ori.w   #$D,-$9E(a0)
		ori.w   #$D000,-$C0(a0)
		move.w  (sp)+,d0
		movea.l (sp)+,a1
		rts

    ; End of function sub_E802


; =============== S U B R O U T I N E =======================================

sub_E83C:
		move.w  ((word_FFA940-$1000000)).w,d0
		move.w  d0,d1
		add.w   d0,d0
		add.w   d1,d0
		add.w   d0,d0
		move.w  ((word_FFA942-$1000000)).w,d1
		add.w   d1,d0
		add.w   d0,d0
		lea     ((TABLE_AT_FFA8C0-$1000000)).w,a0
		move.w  (a0,d0.w),d0
		rts

    ; End of function sub_E83C


; =============== S U B R O U T I N E =======================================

sub_E85A:
		bsr.w   *+4
		movem.l d7-a1,-(sp)
		lea     ((byte_FFBA0C-$1000000)).w,a0
		lea     ((byte_FFB9A0-$1000000)).w,a1
		move.w  #$6C,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		movem.l d7-a1,-(sp)
		lea     wl_F30E(pc), a0
		lea     ((byte_FFBA0C-$1000000)).w,a1
		move.w  #$36,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		movem.l d7-a1,-(sp)
		lea     wl_F30E(pc), a0
		lea     ((byte_FFBA42-$1000000)).w,a1
		move.w  #$36,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
loc_E8AC:
		move.w  #$1B06,d0
		move.w  #$201,d1
		lea     ((byte_FFB96A-$1000000)).w,a0
		bsr.w   CreateWindow    
		bsr.w   sub_AF66
		jmp     (j_WaitForDmaQueueProcessing).l

    ; End of function sub_E85A


; =============== S U B R O U T I N E =======================================

sub_E8C6:
		movem.l d7-a1,-(sp)
		lea     ((byte_FFB810-$1000000)).w,a0
		lea     ((byte_FFBA0C-$1000000)).w,a1
		move.w  #$6C,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		bsr.w   sub_E8FE
		movem.l d7-a1,-(sp)
		lea     ((byte_FFB810-$1000000)).w,a0
		lea     ((byte_FFB9A0-$1000000)).w,a1
		move.w  #$D8,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1

    ; End of function sub_E8C6


; =============== S U B R O U T I N E =======================================

sub_E8FE:
		bra.s   loc_E8AC

    ; End of function sub_E8FE


; =============== S U B R O U T I N E =======================================

sub_E900:
		bsr.w   *+4
		movem.l d7-a1,-(sp)
		lea     ((byte_FFB9A0-$1000000)).w,a0
		lea     ((byte_FFBA0C-$1000000)).w,a1
		move.w  #$6C,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		movem.l d7-a1,-(sp)
		lea     wl_F30E(pc), a0
		lea     ((byte_FFB9A0-$1000000)).w,a1
		move.w  #$36,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		movem.l d7-a1,-(sp)
		lea     wl_F30E(pc), a0
		lea     ((byte_FFB9D6-$1000000)).w,a1
		move.w  #$36,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		bra.w   loc_E8AC

    ; End of function sub_E900


; =============== S U B R O U T I N E =======================================

sub_E956:
		movem.l d7-a1,-(sp)
		lea     ((byte_FFB87C-$1000000)).w,a0
		lea     ((byte_FFB9A0-$1000000)).w,a1
		move.w  #$6C,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		bsr.w   sub_E98E
		movem.l d7-a1,-(sp)
		lea     ((byte_FFB810-$1000000)).w,a0
		lea     ((byte_FFB9A0-$1000000)).w,a1
		move.w  #$D8,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1

    ; End of function sub_E956


; =============== S U B R O U T I N E =======================================

sub_E98E:
		bra.w   loc_E8AC

    ; End of function sub_E98E


; =============== S U B R O U T I N E =======================================

sub_E992:
		bsr.w   sub_AF84
		movem.l d7-a1,-(sp)
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		lea     ((byte_FFB96A-$1000000)).w,a1
		move.w  #$144,d7
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		tst.b   ((byte_FFB4D8-$1000000)).w
		bne.s   loc_E9BC
		bsr.w   sub_E85A
		bra.s   loc_E9C0
loc_E9BC:
		bsr.w   sub_E900
loc_E9C0:
		movem.l d7-a1,-(sp)
		lea     wl_ShopInventory(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$144,d7
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		bsr.w   sub_E71A
		tst.b   ((byte_FFB4D8-$1000000)).w
		bne.s   loc_E9EA
		bsr.w   sub_E8C6
		bra.s   loc_E9EE
loc_E9EA:
		bsr.w   sub_E956
loc_E9EE:
		bra.s   sub_EA04

    ; End of function sub_E992


; =============== S U B R O U T I N E =======================================

sub_E9F0:
		bsr.w   sub_AF84
		lea     wl_F2D8(pc), a0
		move.w  #$1B01,d0
		move.w  #$206,d1
		bsr.w   CreateWindow    

    ; End of function sub_E9F0


; =============== S U B R O U T I N E =======================================

sub_EA04:
		movem.l d7-a1,-(sp)
		lea     wl_ShopItemNameAndPrice(pc), a0
		lea     ((byte_FFB96A-$1000000)).w,a1
		move.w  #$64,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		bsr.w   sub_E83C
		move.w  d0,d1
		move.w  d1,-(sp)
		jsr     j_GetItemNameAddress
		move.w  d1,d7
		lea     ((byte_FFB980-$1000000)).w,a1
		moveq   #-20,d1
		bsr.w   WriteTilesFromAscii
		move.w  (sp)+,d1
		jsr     j_GetItemPrice
		move.l  d2,d0
		lea     ((byte_FFB9AE-$1000000)).w,a1
		moveq   #5,d7
		bsr.w   WriteTilesFromNumber
		lea     ((byte_FFB96A-$1000000)).w,a0
		move.w  #$A05,d0
		move.w  ((word_FFA942-$1000000)).w,d1
		ror.w   #6,d1
		ori.w   #$106,d1
		bsr.w   CreateWindow    
		bra.w   sub_AF66

    ; End of function sub_EA04


; =============== S U B R O U T I N E =======================================

CreateMembersListScreen:
		
		bsr.w   sub_EC28
		bsr.w   sub_ECA6
		bra.w   sub_ED5C

    ; End of function CreateMembersListScreen


; =============== S U B R O U T I N E =======================================

sub_EA72:
		bsr.w   sub_EC28
loc_EA76:
		bsr.w   sub_ECA6
		tst.w   d0
		bmi.w   sub_ED5C
		jsr     j_GetEntityItemsAddress
		movea.l a0,a2
		cmpi.b  #$FF,(a0)
		beq.s   loc_EA76
		move.w  d0,-(sp)
		bsr.w   PickItemSlot
		move.w  (sp)+,d0
		clr.w   d1
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d1
		blt.s   loc_EA76
		bra.w   sub_ED5C

    ; End of function sub_EA72


; =============== S U B R O U T I N E =======================================

PickItemSlot:
		moveq   #$14,d1
		bsr.w   sub_EDCC
		clr.b   ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		bsr.w   sub_EBE0
		move.w  #$A04,d0
		move.l  #$200E090E,d1
		move.w  #6,d2
		bsr.w   MoveWindowWithSfx
		moveq   #$14,d6
loc_EAC4:
		btst    #INPUT_BIT_LEFT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_EAE4
		cmpi.b  #$FF,1(a2)
		beq.s   loc_EAE4
		move.b  #1,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_EB6A
loc_EAE4:
		btst    #INPUT_BIT_RIGHT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_EB04
		cmpi.b  #$FF,2(a2)
		beq.s   loc_EB04
		move.b  #2,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_EB6A
loc_EB04:
		btst    #INPUT_BIT_UP,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_EB1A
		clr.b   ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_EB6A
loc_EB1A:
		btst    #INPUT_BIT_DOWN,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_EB3A
		cmpi.b  #$FF,3(a2)
		beq.s   loc_EB3A
		move.b  #3,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bra.w   loc_EB6A
loc_EB3A:
		btst    #INPUT_BIT_B,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_EB4E
		move.b  #$FF,((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w
		bra.w   loc_EB94
loc_EB4E:
		btst    #INPUT_BIT_C,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_EB5C
		bra.w   loc_EB94
loc_EB5C:
		btst    #INPUT_BIT_A,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_EB80
		bra.w   loc_EB94
loc_EB6A:
		bsr.w   sub_EBE0
		move.w  #$A04,d0
		move.w  #$90E,d1
		bsr.w   CreateWindow    
		bsr.w   sub_AF66
		moveq   #$14,d6
loc_EB80:
		bsr.w   sub_EBB2
		jsr     (j_WaitForVInt).l
		subq.w  #1,d6
		bne.s   loc_EB90
		moveq   #$14,d6
loc_EB90:
		bra.w   loc_EAC4
loc_EB94:
		clr.w   d6
		bsr.w   sub_EBB2
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$A04,d0
		move.l  #$90E200E,d1
		move.w  #6,d2
		bsr.w   MoveWindowWithSfx
		rts

    ; End of function PickItemSlot


; =============== S U B R O U T I N E =======================================

sub_EBB2:
		lea     (SPRITE_00_PROPERTIES).l,a1
		lea     word_EBC0(pc), a0
		bra.w   loc_DA4A

    ; End of function sub_EBB2

word_EBC0:      dc.w $D7
		dc.w $B01
		dc.w $C7DC
		dc.w $9F
		dc.w $E3
		dc.w $B01
		dc.w $C7DC
		dc.w $8F
		dc.w $E3
		dc.w $B01
		dc.w $C7DC
		dc.w $AF
		dc.w $EF
		dc.w $B01
		dc.w $C7DC
		dc.w $9F

; =============== S U B R O U T I N E =======================================

sub_EBE0:
		movem.l d7-a1,-(sp)
		lea     wl_ItemMenuItemName(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		move.w  #$50,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		bsr.w   sub_EE9A
		jsr     j_GetEntityItemsAddress
		move.b  ((CURRENT_DIAMOND_MENU_SELECTION-$1000000)).w,d0
		move.b  (a0,d0.w),d1
		andi.w  #ITEMENTRY_MASK_INDEX,d1
		jsr     j_GetItemNameAddress
		move.w  d1,d7
		lea     ((CURRENT_SPEAKER_NAME_VDPTILES-$1000000)).w,a1
		moveq   #-20,d1
		bsr.w   WriteTilesFromAscii
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		rts

    ; End of function sub_EBE0


; =============== S U B R O U T I N E =======================================

sub_EC28:
		bsr.w   sub_F61E
		tst.b   ((byte_FFC140-$1000000)).w
		bpl.s   loc_EC3E
		clr.w   ((word_FFC1C4-$1000000)).w
		clr.w   ((word_FFC1C6-$1000000)).w
		clr.w   ((byte_FFC140-$1000000)).w
loc_EC3E:
		lea     byte_F4DE(pc), a0
		lea     ($FE00).l,a1
		move.w  #$A0,d0 
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jsr     (j_WaitForDmaQueueProcessing).l
		bsr.w   CreateMembersListWindow
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$150D,d0
		move.l  #$9F30901,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		bsr.w   sub_EE9A
		jsr     j_GetPortrait
		move.w  d1,d0
		bsr.w   OpenPortraitWindow
		clr.b   ((IS_DISPLAYING_PORTRAIT-$1000000)).w
		bsr.w   sub_EE9A
		bsr.w   sub_BE3A
		lea     wl_F3C8(pc), a0
		move.w  #$606,d0
		move.l  #$FA0B020B,d1
		move.w  #4,d2
		bra.w   MoveWindowWithSfx

    ; End of function sub_EC28


; =============== S U B R O U T I N E =======================================

sub_ECA6:
		bsr.w   CreateMembersListWindow
		moveq   #$14,d1
loc_ECAC:
		btst    #INPUT_BIT_UP,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_ECE6
		move.w  ((word_FFC1C4-$1000000)).w,d0
		subq.w  #1,d0
		blt.s   loc_ECE6
		clr.w   d1
		bsr.w   sub_EDCC
		moveq   #$14,d1
		cmp.w   ((word_FFC1C6-$1000000)).w,d0
		bge.s   loc_ECDA
		subq.w  #1,((word_FFC1C6-$1000000)).w
		move.b  #1,((byte_FFB4D8-$1000000)).w
		bsr.w   sub_EEEC
loc_ECDA:
		move.w  d0,((word_FFC1C4-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bsr.w   sub_EEAC
loc_ECE6:
		btst    #INPUT_BIT_DOWN,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_ED26
		move.w  ((word_FFC1C4-$1000000)).w,d0
		addq.w  #1,d0
		cmp.w   ((FORCE_MEMBERS_LIST_LENGTH-$1000000)).w,d0
		bge.s   loc_ED26
		clr.w   d1
		bsr.w   sub_EDCC
		moveq   #$14,d1
		move.w  ((word_FFC1C6-$1000000)).w,d2
		addq.w  #6,d2
		cmp.w   d2,d0
		blt.s   loc_ED1A
		addq.w  #1,((word_FFC1C6-$1000000)).w
		clr.b   ((byte_FFB4D8-$1000000)).w
		bsr.w   sub_EEEC
loc_ED1A:
		move.w  d0,((word_FFC1C4-$1000000)).w
		sndCom  SFX_MENU_SELECTION
		bsr.w   sub_EEAC
loc_ED26:
		btst    #INPUT_BIT_B,(CURRENT_PLAYER_INPUT).l
		bne.w   loc_ED58
		btst    #INPUT_BIT_C,(CURRENT_PLAYER_INPUT).l
		bne.w   sub_EE9A
		btst    #INPUT_BIT_A,(CURRENT_PLAYER_INPUT).l
		bne.w   sub_EE9A
		bsr.w   sub_EDCC
		jsr     (j_WaitForVInt).l
		bra.w   loc_ECAC
loc_ED58:
		moveq   #-1,d0
		rts

    ; End of function sub_ECA6


; =============== S U B R O U T I N E =======================================

sub_ED5C:
		movem.w d0-d1,-(sp)
		clr.w   d1
		bsr.s   sub_EDCC
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$150D,d0
		move.l  #$90109F3,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		bsr.w   ClosePortraitWindow
		lea     wl_F3C8(pc), a0
		move.w  #$606,d0
		move.l  #$20BFA0B,d1
		move.w  #4,d2
		bsr.w   MoveWindowWithSfx
		lea     (FF3000_LOADING_SPACE).l,a0
		move.w  #$17F,d7
loc_ED9E:
		move.l  #$DDDDDDDD,(a0)+
		dbf     d7,loc_ED9E

		lea     (FF3000_LOADING_SPACE).l,a0
		lea     ($F800).l,a1
		move.w  #$400,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jsr     (j_WaitForDmaQueueProcessing).l
		movem.w (sp)+,d0-d1
		rts

    ; End of function sub_ED5C


; =============== S U B R O U T I N E =======================================

sub_EDCC:
		move.w  d0,-(sp)
		lea     (SPRITE_01_PROPERTIES).l,a0
		lea     word_EE72(pc), a1
		cmpi.w  #7,d1
		bge.s   loc_EDE4
		move.w  #$100,d0
		bra.s   loc_EDE6
loc_EDE4:
		clr.w   d0
loc_EDE6:
		move.w  ((word_FFC1C4-$1000000)).w,d2
		sub.w   ((word_FFC1C6-$1000000)).w,d2
		lsl.w   #4,d2
		add.w   d2,d0
		moveq   #4,d7
loc_EDF4:
		move.w  (a1)+,(a0)
		add.w   d0,(a0)
		move.w  (a1)+,d2
		move.w  d2,2(a0)
		move.w  (a1)+,4(a0)
		move.w  (a1)+,6(a0)
		addq.l  #8,a0
		dbf     d7,loc_EDF4

		move.w  #1,(a0)
		move.w  #1,6(a0)
		tst.w   ((word_FFC1C6-$1000000)).w
		beq.s   loc_EE36
		cmpi.w  #7,d1
		blt.s   loc_EE36
		move.w  #$D0,6(a0) 
		move.w  #$90,(a0) 
		clr.b   2(a0)
		move.w  #$D084,4(a0)
loc_EE36:
		addq.l  #8,a0
		move.w  #1,(a0)
		move.w  #1,6(a0)
		move.w  ((word_FFC1C6-$1000000)).w,d0
		addq.w  #6,d0
		cmp.w   ((FORCE_MEMBERS_LIST_LENGTH-$1000000)).w,d0
		bge.s   loc_EE68
		cmpi.w  #7,d1
		blt.s   loc_EE68
		move.w  #$D0,6(a0) 
		move.w  #$E0,(a0) 
		clr.b   2(a0)
		move.w  #$C084,4(a0)
loc_EE68:
		subq.w  #1,d1
		bne.s   loc_EE6E
		moveq   #$14,d1
loc_EE6E:
		move.w  (sp)+,d0
		rts

    ; End of function sub_EDCC

word_EE72:      dc.w $8C
		dc.w $D02
		dc.w $C7F0
		dc.w $D6
		dc.w $8C
		dc.w $D03
		dc.w $C7F2
		dc.w $F4
		dc.w $8C
		dc.w $D04
		dc.w $C7F2
		dc.w $114
		dc.w $8C
		dc.w $D05
		dc.w $C7F2
		dc.w $134
		dc.w $8C
		dc.w $D06
		dc.w $CFF0
		dc.w $14A

; =============== S U B R O U T I N E =======================================

sub_EE9A:
		lea     ((FORCE_MEMBERS_LIST-$1000000)).w,a0
		move.w  ((word_FFC1C4-$1000000)).w,d0
		move.b  (a0,d0.w),d0
		bclr    #6,d0
		rts

    ; End of function sub_EE9A


; =============== S U B R O U T I N E =======================================

sub_EEAC:
		movem.w d0-d1,-(sp)
		bsr.s   sub_EE9A
		move.w  d0,-(sp)
		bsr.w   sub_BE3A
		move.w  (sp)+,d0
		jsr     j_GetPortrait
		move.w  d1,d0
		andi.w  #$FF,d0
		bsr.w   LoadPortrait    
		lea     ((byte_FFB58C-$1000000)).w,a0
		lea     (PALETTE_2_CURRENT).l,a1
		jsr     (j_CopyPalette).l
		jsr     (j_ApplyVIntCramDma).l
		jsr     (j_EnableDmaQueueProcessing).l
		movem.w (sp)+,d0-d1
		rts

    ; End of function sub_EEAC


; =============== S U B R O U T I N E =======================================

sub_EEEC:
		movem.w d0-d1,-(sp)
		tst.b   ((byte_FFB4D8-$1000000)).w
		beq.s   loc_EF2C
		movem.l d7-a1,-(sp)
		lea     ((byte_FFB804-$1000000)).w,a0
		lea     ((byte_FFB82E-$1000000)).w,a1
		move.w  #$1A4,d7
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		movem.l d7-a1,-(sp)
		lea     wl_MembersList2(pc), a0
		lea     ((byte_FFB804-$1000000)).w,a1
		move.w  #$2A,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		bra.s   loc_EF60
loc_EF2C:
		movem.l d7-a1,-(sp)
		lea     ((byte_FFB82E-$1000000)).w,a0
		lea     ((byte_FFB804-$1000000)).w,a1
		move.w  #$1A4,d7
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
		movem.l d7-a1,-(sp)
		lea     wl_MembersList2(pc), a0
		lea     ((byte_FFB9A8-$1000000)).w,a1
		move.w  #$2A,d7 
		jsr     (j_CopyBytes).l
		movem.l (sp)+,d7-a1
loc_EF60:
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$150D,d0
		move.w  #$901,d1
		bsr.w   CreateWindow    
		bsr.w   sub_AF66
		jsr     (j_WaitForVInt).l
		bsr.w   CreateMembersListWindow
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$150D,d0
		move.w  #$901,d1
		bsr.w   CreateWindow    
		bsr.w   sub_AF66
		movem.w (sp)+,d0-d1
		rts

    ; End of function sub_EEEC


; =============== S U B R O U T I N E =======================================

CreateMembersListWindow:
		
		lea     wl_MembersList1(pc), a0
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a1
		movem.l d7,-(sp)
		move.w  #$29,d7 
loc_EFA8:
		move.b  (a0)+,(a1)+
		dbf     d7,loc_EFA8

		movem.l (sp)+,d7
		moveq   #$A,d6
loc_EFB4:
		lea     wl_MembersList2(pc), a0
		movem.l d7,-(sp)
		move.w  #$29,d7 
loc_EFC0:
		move.b  (a0)+,(a1)+
		dbf     d7,loc_EFC0

		movem.l (sp)+,d7
		dbf     d6,loc_EFB4

		lea     wl_MembersList3(pc), a0
		movem.l d7,-(sp)
		move.w  #$29,d7 
loc_EFDA:
		move.b  (a0)+,(a1)+
		dbf     d7,loc_EFDA

		movem.l (sp)+,d7
		lea     ((byte_FFB80A-$1000000)).w,a1
		lea     ((FORCE_MEMBERS_LIST-$1000000)).w,a0
		move.w  ((word_FFC1C6-$1000000)).w,d0
		adda.w  d0,a0
		moveq   #5,d7
loc_EFF4:
		move.b  (a0)+,d0
		bmi.w   return_F068
		bclr    #6,d0
		beq.s   loc_F006
		move.w  ((MEMBERS_LIST_SYMBOL-$1000000)).w,-2(a1)
loc_F006:
		move.w  d7,-(sp)
		movem.l a0-a1,-(sp)
		move.w  d0,-(sp)
		move.l  a1,-(sp)
		jsr     j_GetEntityStatsAddress
		moveq   #-42,d1
		moveq   #8,d7
		bsr.w   WriteTilesFromAscii
		movea.l (sp)+,a1
		lea     $12(a1),a1
		move.w  (sp)+,d0
		move.w  d0,-(sp)
		move.l  a1,-(sp)
		jsr     j_GetClass
		jsr     j_GetClassNameAddress
		move.w  d1,d7
		moveq   #-42,d1
		bsr.w   WriteTilesFromAscii
		movea.l (sp)+,a1
		lea     $A(a1),a1
		move.w  (sp)+,d0
		move.w  #VDPTILE_ASCII_UPPERCASE_L|VDPTILE_PALETTE3|VDPTILE_PRIORITY_BIT,(a1)+
		jsr     j_GetLevel
		move.w  d1,d0
		ext.l   d0
		moveq   #2,d7
		bsr.w   WriteTilesFromNumber
		movem.l (sp)+,a0-a1
		lea     $54(a1),a1
		move.w  (sp)+,d7
		dbf     d7,loc_EFF4
return_F068:
		rts

    ; End of function CreateMembersListWindow

dword_F06A:     dc.l $11DDDDDD
		dc.l $EE1DDDDD
		dc.l $DDD1DDDD
		dc.l $EBBBBBDD
		dc.l $BBBBBBBD
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $DBBBBBEE
		dc.l $DDEEEEED
dword_F0EA:     dc.l $BEEEEEBE
		dc.l $BEBBBEBE
		dc.l $BEBBBEBE
		dc.l $BEEEEEBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BEBBEBBE
		dc.l $BEEEEEBE
		dc.l $BEBBBBBE
		dc.l $BBBBBBBE
		dc.l $BEEEBEBE
		dc.l $BEBEBEBE
		dc.l $BEBEBEBE
		dc.l $BEBEEEBE
		dc.l $BBBBBBBE
		dc.l $BEBBBEBE
		dc.l $BEBEBEBE
		dc.l $BEBEBEBE
		dc.l $BEEEEEBE
		dc.l $BBBBBBBE
		dc.l $BBEEEEBE
		dc.l $BBEBBBBE
		dc.l $BEEEEEBE
		dc.l $BBEBBBBE
		dc.l $BBBBBBBE
		dc.l $BEBEEEBE
		dc.l $BEBEBEBE
		dc.l $BEBEBEBE
		dc.l $BEEEBEBE
		dc.l $BBBBBBBE
		dc.l $BEEEEEBE
		dc.l $BEBEBEBE
		dc.l $BEBEBEBE
		dc.l $BEEEBEBE
		dc.l $BBBBBBBE
		dc.l $BBBEEEBE
		dc.l $BBBBBEBE
		dc.l $BBBBBEBE
		dc.l $BEEEEEBE
		dc.l $BBBBBBBE
		dc.l $BEEEEEBE
		dc.l $BEBEBEBE
		dc.l $BEBEBEBE
		dc.l $BEEEEEBE
		dc.l $BBBBBBBE
		dc.l $BEBEEEBE
		dc.l $BEBEBEBE
		dc.l $BEBEBEBE
		dc.l $BEEEEEBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l $BBBBBBBE
		dc.l 0
wl_ShopInventory:
		dc.w $C080
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C081
		dc.w $C880
		dc.w $C090
		dc.w $C020
		dc.w $C020
		dc.w $C024
		dc.w $C5C6
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C5D0
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C5DA
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C5E4
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C5EE
		dc.w $C020
		dc.w $C020
		dc.w $C020
		dc.w $C5F8
		dc.w $C020
		dc.w $C890
		dc.w $C090
		dc.w $C020
		dc.w $C5C0
		dc.w $C5C1
		dc.w $C5C7
		dc.w $C020
		dc.w $C5CA
		dc.w $C5CB
		dc.w $C5D1
		dc.w $C020
		dc.w $C5D4
		dc.w $C5D5
		dc.w $C5DB
		dc.w $C020
		dc.w $C5DE
		dc.w $C5DF
		dc.w $C5E5
		dc.w $C020
		dc.w $C5E8
		dc.w $C5E9
		dc.w $C5EF
		dc.w $C020
		dc.w $C5F2
		dc.w $C5F3
		dc.w $C5F9
		dc.w $C020
		dc.w $C890
		dc.w $C090
		dc.w $C020
		dc.w $C5C2
		dc.w $C5C3
		dc.w $C5C8
		dc.w $C020
		dc.w $C5CC
		dc.w $C5CD
		dc.w $C5D2
		dc.w $C020
		dc.w $C5D6
		dc.w $C5D7
		dc.w $C5DC
		dc.w $C020
		dc.w $C5E0
		dc.w $C5E1
		dc.w $C5E6
		dc.w $C020
		dc.w $C5EA
		dc.w $C5EB
		dc.w $C5F0
		dc.w $C020
		dc.w $C5F4
		dc.w $C5F5
		dc.w $C5FA
		dc.w $C020
		dc.w $C890
		dc.w $C090
		dc.w $C020
		dc.w $C5C4
		dc.w $C5C5
		dc.w $C5C9
		dc.w $C020
		dc.w $C5CE
		dc.w $C5CF
		dc.w $C5D3
		dc.w $C020
		dc.w $C5D8
		dc.w $C5D9
		dc.w $C5DD
		dc.w $C020
		dc.w $C5E2
		dc.w $C5E3
		dc.w $C5E7
		dc.w $C020
		dc.w $C5EC
		dc.w $C5ED
		dc.w $C5F1
		dc.w $C020
		dc.w $C5F6
		dc.w $C5F7
		dc.w $C5FB
		dc.w $C020
		dc.w $C890
wl_F2D8:        vdpBaseTile WINDOW_CORNER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_HORIZONTAL_BORDER|VDPTILE_FLIPPED_BIT
		vdpBaseTile WINDOW_CORNER|VDPTILE_MIRRORED_BIT|VDPTILE_FLIPPED_BIT
wl_F30E:        vdpBaseTile WINDOW_VERTICAL_BORDER
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile ASCII_SPACE
		vdpBaseTile WINDOW_VERTICAL_BORDER|VDPTILE_MIRRORED_BIT
ShopIconHighlightTiles:
		incbin "data/graphics/tech/menus/shopiconhighlighttiles.bin"
wl_ShopItemNameAndPrice:
		incbin "data/graphics/tech/windowlayouts/wl-shopitemnameandprice.bin"
wl_F3C8:        incbin "data/graphics/tech/windowlayouts/wl-f3c8.bin"
wl_MembersList1:incbin "data/graphics/tech/windowlayouts/wl-memberslist1.bin"
wl_MembersList2:incbin "data/graphics/tech/windowlayouts/wl-memberslist2.bin"
wl_MembersList3:incbin "data/graphics/tech/windowlayouts/wl-memberslist3.bin"
wl_ItemMenuItemName:
		incbin "data/graphics/tech/windowlayouts/wl-itemmenuitemname.bin"
byte_F4DE:      dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b $A
		dc.b $A0
		dc.b 0
		dc.b 0
		dc.b $A
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $A
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $A
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $A
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $A
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $A
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $A
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $A
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $A
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $A
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $A
		dc.b $A0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b $AA
		dc.b 0
		dc.b 0
		dc.b 0
		dc.b 0

; =============== S U B R O U T I N E =======================================

sub_F61E:
		lea     (byte_FFDC86).l,a0
		move.l  #$C020C020,-$50(a0)
		moveq   #$C,d7
loc_F62E:
		move.l  #$C020C020,(a0)+
		dbf     d7,loc_F62E
		rts

    ; End of function sub_F61E


; =============== S U B R O U T I N E =======================================

sub_F63A:
		lea     (PALETTE_1_CURRENT).l,a0
		lea     (PALETTE_2_CURRENT).l,a1
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		jsr     (j_ApplyVIntCramDma).l
		move.b  #9,(FADING_SETTING).l
		clr.b   (FADING_POINTER).l
		move.b  (FADING_COUNTER_MAX).l,(FADING_COUNTER).l
		move.b  #$D,(FADING_PALETTE_FLAGS).l
		move.l  (VINT_CONTEXTUAL_FUNCTION_ADDRESS).l,-(sp)
		clr.l   (VINT_CONTEXTUAL_FUNCTION_ADDRESS).l
		bsr.w   sub_F7CE
		move.l  (sp)+,(VINT_CONTEXTUAL_FUNCTION_ADDRESS).l
loc_F692:
		jsr     (j_WaitForVInt).l
		tst.b   (FADING_SETTING).l
		bne.s   loc_F692
		lea     (PALETTE_3_BASE).l,a0
		lea     (PALETTE_3_CURRENT).l,a1
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		move.l  (a0)+,(a1)+
		jsr     (j_ApplyVIntCramDma).l
		move.l  #sub_9A8C,(VINT_CONTEXTUAL_FUNCTION_ADDRESS).l
		jsr     (j_ClearSpriteTable).l
		move.w  #$3E,(SPRITE_53_SIZE).l 
		bsr.w   sub_FAC6
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		bsr.w   sub_FB38
		andi.l  #$FFFFFF,d1
		ori.l   #$20000000,d1
		move.w  #8,d2
		bsr.w   MoveWindowWithSfx
		jsr     sub_FB68(pc)
		nop
		move.w  #$14,((CURRENT_OBJECT-$1000000)).w
		moveq   #$A,d3
loc_F708:
		move.b  #1,(byte_FF0F03).l
		move.w  d3,-(sp)
		jsr     sub_FBF4(pc)
		nop
		move.w  (sp)+,d3
		jsr     (j_WaitForVInt).l
		subq.w  #1,d3
		bne.s   loc_F726
		moveq   #$14,d3
loc_F726:
		bsr.w   sub_FC94
		move.b  (CURRENT_PLAYER_INPUT).l,d0
		andi.b  #INPUT_B|INPUT_C|INPUT_A,d0
		beq.s   loc_F708
		clr.b   (byte_FF0F03).l
		jsr     (j_ClearSpriteTable).l
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		bsr.w   sub_FB38
		andi.l  #$FFFFFF,d1
		btst    #INPUT_BIT_B,(CURRENT_PLAYER_INPUT).l
		bne.s   loc_F764
		ori.l   #$E0000000,d1
		clr.w   d7
		bra.s   loc_F772
loc_F764:
		ori.l   #$20000000,d1
		bset    #0,((byte_FFB4CA-$1000000)).w
		moveq   #-1,d7
loc_F772:
		move.w  d7,-(sp)
		swap    d1
		move.w  #6,d2
		bsr.w   MoveWindowWithSfx
		lea     (PALETTE_3_CURRENT).l,a1
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		clr.l   (a1)+
		jsr     (j_ApplyVIntCramDma).l
		jsr     sub_98A8
		move.l  #sub_9A8A,(VINT_CONTEXTUAL_FUNCTION_ADDRESS).l
		move.b  #$A,(FADING_SETTING).l
		clr.b   (FADING_POINTER).l
		move.b  (FADING_COUNTER_MAX).l,(FADING_COUNTER).l
		move.b  #$D,(FADING_PALETTE_FLAGS).l
		move.w  (sp)+,d0
		rts

    ; End of function sub_F63A


; =============== S U B R O U T I N E =======================================

sub_F7CE:
		lea     (MAP_SPRITE_POSITION).l,a0
		lea     (FF0FFE_LOADING_SPACE).l,a1
		move.w  ((MAP_WIDTH-$1000000)).w,d5
		move.w  d5,d6
		add.w   d5,d5
		add.w   d6,d5
		add.w   d5,d5
		moveq   #2,d4
		move.w  ((MAP_HEIGHT-$1000000)).w,d6
		subq.w  #1,d6
loc_F7EE:
		jsr     (j_EnableInterrupts).l
		jsr     (j_WaitForVInt).l
		jsr     (j_DisableInterrupts).l
		move.w  ((MAP_WIDTH-$1000000)).w,d7
		lsr.w   #1,d7
		subq.w  #1,d7
loc_F808:
		move.w  ((MAP_HEIGHT-$1000000)).w,d2
		subq.w  #1,d2
		sub.w   d6,d2
		move.w  ((MAP_WIDTH-$1000000)).w,d1
		mulu.w  d1,d2
		move.w  d2,d1
		lsl.w   #3,d2
		add.w   d1,d2
		add.w   d2,d2
		move.w  ((MAP_WIDTH-$1000000)).w,d1
		lsr.w   #1,d1
		subq.w  #1,d1
		sub.w   d7,d1
		lsl.w   #2,d1
		move.w  d1,d0
		add.w   d1,d1
		add.w   d0,d1
		add.w   d1,d2
		add.w   d5,d2
		move.w  2(a0,d2.w),d0
		add.w   d0,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		move.w  d0,d3
		move.w  4(a0,d2.w),d0
		add.w   d0,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		lsr.w   #8,d0
		or.w    d0,d3
		move.w  d3,(a1)
		move.w  4(a0,d2.w),d0
		add.w   d0,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		move.w  d0,d3
		move.w  4(a0,d2.w),d0
		add.w   d0,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		lsr.w   #8,d0
		or.w    d0,d3
		move.w  d3,4(a1)
		add.w   d5,d2
		move.w  2(a0,d2.w),d0
		add.w   d0,d0
		addq.w  #1,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		move.w  d0,d3
		move.w  4(a0,d2.w),d0
		add.w   d0,d0
		addq.w  #1,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		lsr.w   #8,d0
		or.w    d0,d3
		move.w  d3,8(a1)
		move.w  2(a0,d2.w),d0
		add.w   d0,d0
		addq.w  #1,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		move.w  d0,d3
		move.w  4(a0,d2.w),d0
		add.w   d0,d0
		addq.w  #1,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		lsr.w   #8,d0
		or.w    d0,d3
		move.w  d3,$C(a1)
		sub.w   d5,d2
		addq.w  #6,d2
		move.w  2(a0,d2.w),d0
		add.w   d0,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		move.w  d0,d3
		move.w  4(a0,d2.w),d0
		add.w   d0,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		lsr.w   #8,d0
		or.w    d0,d3
		move.w  d3,2(a1)
		move.w  4(a0,d2.w),d0
		add.w   d0,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		move.w  d0,d3
		move.w  4(a0,d2.w),d0
		add.w   d0,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		lsr.w   #8,d0
		or.w    d0,d3
		move.w  d3,6(a1)
		add.w   d5,d2
		move.w  2(a0,d2.w),d0
		add.w   d0,d0
		addq.w  #1,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		move.w  d0,d3
		move.w  4(a0,d2.w),d0
		add.w   d0,d0
		addq.w  #1,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		lsr.w   #8,d0
		or.w    d0,d3
		move.w  d3,$A(a1)
		move.w  2(a0,d2.w),d0
		add.w   d0,d0
		addq.w  #1,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		move.w  d0,d3
		move.w  4(a0,d2.w),d0
		add.w   d0,d0
		addq.w  #1,d0
		bsr.w   sub_FA46
		move.w  d0,d1
		lsl.w   #4,d1
		andi.w  #$F000,d0
		andi.w  #$F00,d1
		or.w    d1,d0
		lsr.w   #8,d0
		or.w    d0,d3
		move.w  d3,$E(a1)
		adda.w  #$20,a1 
		dbf     d7,loc_F808

		subq.w  #1,d4
		beq.s   loc_FA32
		move.w  ((MAP_WIDTH-$1000000)).w,d7
		subq.w  #1,d7
		lsl.w   #4,d7
		suba.w  d7,a1
		bra.s   loc_FA38
loc_FA32:
		suba.w  #$10,a1
		moveq   #2,d4
loc_FA38:
		dbf     d6,loc_F7EE

		jsr     (j_EnableInterrupts).l
		bra.w   loc_FA6C

    ; End of function sub_F7CE


; =============== S U B R O U T I N E =======================================

sub_FA46:
		andi.w  #$FFF,d0
		lsl.w   #4,d0
		move.w  d0,d1
		andi.w  #$3FFF,d1
		move.w  d1,(VDP_Control).l
		rol.w   #2,d0
		andi.w  #3,d0
		move.w  d0,(VDP_Control).l
		move.w  (VDP_Data).l,d0
		rts

    ; End of function sub_FA46


; START OF FUNCTION CHUNK FOR sub_F7CE

loc_FA6C:
		lea     (FF0FFE_LOADING_SPACE).l,a0
		lea     ($B800).l,a1
		move.w  #$400,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		lea     ($D000).l,a1
		move.w  #$400,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jsr     (j_WaitForDmaQueueProcessing).l
		lea     ($D800).l,a1
		move.w  #$400,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		lea     ($F800).l,a1
		move.w  #$400,d0
		moveq   #2,d1
		jsr     (j_ApplyVIntVramDma).l
		jmp     (j_WaitForDmaQueueProcessing).l

; END OF FUNCTION CHUNK FOR sub_F7CE


; =============== S U B R O U T I N E =======================================

sub_FAC6:
		lea     ((WINDOW_LAYOUT_LOADING_SPACE-$1000000)).w,a0
		move.w  #$A5C0,d5
		move.w  ((MAP_WIDTH-$1000000)).w,d7
		lsr.w   #1,d7
		subq.w  #1,d7
		move.w  #$C0F9,(a0)+
loc_FADA:
		move.w  #$C0FA,(a0)+
		dbf     d7,loc_FADA

		move.w  #$C8F9,(a0)+
		move.w  ((MAP_HEIGHT-$1000000)).w,d6
		lsr.w   #1,d6
		subq.w  #1,d6
loc_FAEE:
		move.w  ((MAP_WIDTH-$1000000)).w,d7
		lsr.w   #1,d7
		subq.w  #1,d7
		move.w  #$C0FB,(a0)+
loc_FAFA:
		move.w  d5,(a0)+
		addq.w  #1,d5
		cmpi.w  #$A600,d5
		bne.s   loc_FB08
		move.w  #$A680,d5
loc_FB08:
		cmpi.w  #$A700,d5
		bne.s   loc_FB12
		move.w  #$A7C0,d5
loc_FB12:
		dbf     d7,loc_FAFA

		move.w  #$C8FB,(a0)+
		dbf     d6,loc_FAEE

		move.w  ((MAP_WIDTH-$1000000)).w,d7
		lsr.w   #1,d7
		subq.w  #1,d7
		move.w  #$D0F9,(a0)+
loc_FB2A:
		move.w  #$D0FA,(a0)+
		dbf     d7,loc_FB2A

		move.w  #$D8F9,(a0)+
		rts

    ; End of function sub_FAC6


; =============== S U B R O U T I N E =======================================

sub_FB38:
		move.w  ((MAP_WIDTH-$1000000)).w,d0
		addq.w  #4,d0
		lsl.w   #7,d0
		move.w  ((MAP_HEIGHT-$1000000)).w,d1
		addq.w  #4,d1
		lsr.w   #1,d1
		or.w    d1,d0
		move.w  d0,-(sp)
		moveq   #$3C,d0 
		sub.w   ((MAP_WIDTH-$1000000)).w,d0
		lsl.w   #6,d0
		moveq   #$34,d1 
		sub.w   ((MAP_HEIGHT-$1000000)).w,d1
		lsr.w   #2,d1
		or.w    d0,d1
		move.w  d1,d0
		swap    d0
		or.l    d0,d1
		move.w  (sp)+,d0
		rts

    ; End of function sub_FB38


; =============== S U B R O U T I N E =======================================

sub_FB68:
		bsr.w   sub_FBD6
		lea     (FF0FFE_LOADING_SPACE).l,a1
		clr.w   d0
		moveq   #$1F,d7
loc_FB76:
		jsr     j_GetEntity
		move.w  d1,(a1)+
		jsr     j_GetCombatantX
		lsl.w   #2,d1
		add.w   d2,d1
		move.w  d1,(a1)+
		jsr     j_GetCombatantY
		lsl.w   #2,d1
		add.w   d3,d1
		move.w  d1,(a1)+
		clr.w   (a1)+
		addq.w  #1,d0
		dbf     d7,loc_FB76

		moveq   #$1D,d6
loc_FBA0:
		lea     (FF0FFE_LOADING_SPACE).l,a0
		moveq   #$1E,d7
loc_FBA8:
		move.w  4(a0),d0
		cmp.w   $C(a0),d0
		bge.s   loc_FBCA
		move.l  8(a0),d0
		move.l  (a0),8(a0)
		move.l  d0,(a0)
		move.l  $C(a0),d0
		move.l  4(a0),$C(a0)
		move.l  d0,4(a0)
loc_FBCA:
		addq.w  #8,a0
		dbf     d7,loc_FBA8
		dbf     d6,loc_FBA0
		rts

    ; End of function sub_FB68


; =============== S U B R O U T I N E =======================================

sub_FBD6:
		moveq   #$40,d2 
		sub.w   ((MAP_WIDTH-$1000000)).w,d2
		lsr.w   #2,d2
		lsl.w   #3,d2
		addi.w  #$80,d2 
		moveq   #$38,d3 
		sub.w   ((MAP_HEIGHT-$1000000)).w,d3
		lsr.w   #2,d3
		lsl.w   #3,d3
		addi.w  #$80,d3 
		rts

    ; End of function sub_FBD6


; =============== S U B R O U T I N E =======================================

sub_FBF4:
		subq.w  #1,((CURRENT_OBJECT-$1000000)).w
		bne.s   loc_FC00
		move.w  #20,((CURRENT_OBJECT-$1000000)).w
loc_FC00:
		cmpi.w  #7,((CURRENT_OBJECT-$1000000)).w
		bgt.s   loc_FC10
		move.l  #$100,d6
		bra.s   loc_FC12
loc_FC10:
		clr.w   d6
loc_FC12:
		lea     (FF0FFE_LOADING_SPACE).l,a0
		lea     (SPRITE_22_PROPERTIES).l,a1
		moveq   #$1F,d7
loc_FC20:
		move.w  (a0),d0
		cmpi.b  #$FF,d0
		beq.s   loc_FC48
		move.w  2(a0),6(a1)
		move.w  4(a0),(a1)
		add.w   d6,(a1)
		btst    #7,d0
		beq.s   loc_FC42
		move.w  #VDPTILE_5C|VDPTILE_PALETTE3|VDPTILE_PRIORITY_BIT,4(a1)
		bra.s   loc_FC48
loc_FC42:
		move.w  #VDPTILE_5E|VDPTILE_PALETTE3|VDPTILE_PRIORITY_BIT,4(a1)
loc_FC48:
		addq.l  #8,a0
		addq.l  #8,a1
		dbf     d7,loc_FC20

		lea     (SPRITE_21_PROPERTIES).l,a1
		move.w  d3,-(sp)
		bsr.w   sub_FBD6
		lea     (byte_FF10FE).l,a0
		clr.w   d0
		move.b  ((CURSOR_POSITION_X-$1000000)).w,d0
		lsl.w   #2,d0
		add.w   d2,d0
		move.w  d0,6(a1)
		clr.w   d0
		move.b  ((CURSOR_POSITION_Y-$1000000)).w,d0
		lsl.w   #2,d0
		add.w   d3,d0
		move.w  d0,(a1)
		move.w  (sp)+,d3
		cmpi.w  #7,d3
		bge.s   loc_FC8C
		move.w  #0,4(a1)
		bra.s   return_FC92
loc_FC8C:
		move.w  #VDPTILE_3B|VDPTILE_PALETTE3|VDPTILE_PRIORITY_BIT,4(a1)
return_FC92:
		rts

    ; End of function sub_FBF4


; =============== S U B R O U T I N E =======================================

sub_FC94:
		move.w  d3,-(sp)
		clr.b   ((byte_FFB538-$1000000)).w
		clr.l   ((CAMERA_XSPEED-$1000000)).w
		bsr.w   sub_87AA
		btst    #INPUT_BIT_LEFT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_FCB0
		bsr.w   sub_86DA
loc_FCB0:
		btst    #INPUT_BIT_RIGHT,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_FCBE
		bsr.w   sub_8650
loc_FCBE:
		btst    #INPUT_BIT_UP,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_FCCC
		bsr.w   sub_853E
loc_FCCC:
		btst    #INPUT_BIT_DOWN,(CURRENT_PLAYER_INPUT).l
		beq.s   loc_FCDA
		bsr.w   sub_85C2
loc_FCDA:
		move.w  (sp)+,d3
		tst.l   ((CAMERA_XSPEED-$1000000)).w
		beq.w   return_FD56
		sndCom  SFX_MENU_SELECTION
		moveq   #20,d3
		movem.w d1-d7,-(sp)
		clr.w   d1
		clr.w   d2
		clr.w   d3
		clr.w   d4
		move.b  ((CAMERA_XSPEED-$1000000)).w,d3
		move.b  ((CAMERA_YSPEED-$1000000)).w,d4
		ext.w   d3
		ext.w   d4
		add.w   d3,d3
		add.w   d4,d4
		addi.w  #-16,d3
		addi.w  #20,d4
		moveq   #5,d7
loc_FD10:
		clr.b   ((UPDATE_SCREEN_TOGGLE-$1000000)).w
		move.w  d7,-(sp)
		bsr.w   sub_8A22
		move.w  (sp)+,d7
		move.w  d7,-(sp)
		bsr.w   sub_8A8A
		move.w  (sp)+,d7
		tst.b   ((UPDATE_SCREEN_TOGGLE-$1000000)).w
		beq.w   loc_FD38
		movem.w d1-d7,-(sp)
		bsr.w   UpdateScreenAfterTileChange
		movem.w (sp)+,d1-d7
loc_FD38:
		tst.w   d7
		beq.s   loc_FD4E
		movem.w d0-d7,-(sp)
		bsr.w   sub_FBF4
		movem.w (sp)+,d0-d7
		jsr     (j_WaitForVInt).l
loc_FD4E:
		dbf     d7,loc_FD10

		movem.w (sp)+,d1-d7
return_FD56:
		rts

    ; End of function sub_FC94

		align $8000
